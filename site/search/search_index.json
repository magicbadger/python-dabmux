{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Python DAB Multiplexer","text":"<p>Welcome to the documentation for python-dabmux, a pure Python implementation of a DAB/DAB+ multiplexer that recreates the functionality of ODR-DabMux.</p>"},{"location":"#what-is-python-dabmux","title":"What is python-dabmux?","text":"<p>python-dabmux is a complete DAB (Digital Audio Broadcasting) multiplexer that combines multiple audio streams into a single DAB ensemble for transmission. It supports both traditional DAB (MPEG Layer II) and DAB+ (HE-AAC v2) audio formats, with full EDI (Ensemble Data Interface) network output capabilities.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Complete DAB/DAB+ Support: Full implementation of ETI frame generation, FIG (Fast Information Group) encoding, and ensemble multiplexing</li> <li>Multiple Input Sources: File-based inputs (MPEG, raw), UDP/TCP network streaming, with automatic frame parsing and validation</li> <li>Flexible Output Options: ETI file formats (raw, framed, streamed), EDI network output with UDP/TCP support</li> <li>PFT with FEC: Protection, Fragmentation and Transport layer with Reed-Solomon forward error correction</li> <li>Network Streaming: UDP multicast and TCP server inputs for live audio streaming</li> <li>Configuration Management: YAML-based configuration with validation and comprehensive examples</li> <li>Robust Architecture: Well-tested (389 tests, 71% coverage), type-annotated, and production-ready</li> </ul>"},{"location":"#project-status","title":"Project Status","text":"<p>\ud83c\udf89 python-dabmux is feature-complete!</p> <p>All core functionality has been implemented through 6 development phases:</p> <ul> <li>\u2705 Phase 0: Foundation (ETI frames, CRC, ensemble configuration)</li> <li>\u2705 Phase 1: Input/Output abstractions</li> <li>\u2705 Phase 2: FIG generation and carousel</li> <li>\u2705 Phase 3: Data input and encoding</li> <li>\u2705 Phase 4: Network inputs and timestamps</li> <li>\u2705 Phase 5: EDI protocol and DAB+ support</li> <li>\u2705 Phase 6: Advanced features and usability</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<p>Get started with python-dabmux in under 15 minutes:</p> <pre><code># Install\npip install python-dabmux\n\n# Create your first multiplex\npython -m dabmux.cli -c config.yaml -o output.eti\n\n# Or stream over the network with EDI\npython -m dabmux.cli -c config.yaml --edi udp://239.1.2.3:12000 --pft\n</code></pre> <p>Get Started \u2192</p>"},{"location":"#documentation-structure","title":"Documentation Structure","text":""},{"location":"#for-new-users","title":"\ud83d\udcda For New Users","text":"<ul> <li>Getting Started: Installation, first multiplex, and basic concepts</li> <li>Tutorials: Hands-on guides for common scenarios</li> <li>FAQ: Frequently asked questions</li> </ul>"},{"location":"#for-regular-users","title":"\ud83d\udcd6 For Regular Users","text":"<ul> <li>User Guide: Comprehensive configuration and CLI reference</li> <li>Configuration: Complete parameter reference</li> <li>Troubleshooting: Common errors and solutions</li> </ul>"},{"location":"#for-developers","title":"\ud83c\udfd7\ufe0f For Developers","text":"<ul> <li>Architecture: System design with Mermaid diagrams</li> <li>API Reference: Complete API documentation</li> <li>Advanced Topics: Deep dives into FIG types, FEC, and more</li> <li>Development: Contributing, testing, and roadmap</li> </ul>"},{"location":"#for-standards-implementers","title":"\ud83d\udcd0 For Standards Implementers","text":"<ul> <li>Standards: ETSI compliance and references</li> <li>Glossary: DAB terminology and acronyms</li> </ul>"},{"location":"#key-capabilities","title":"Key Capabilities","text":""},{"location":"#input-sources","title":"Input Sources","text":"<ul> <li>File Inputs: MPEG Layer II files, raw audio, packet data</li> <li>Network Inputs: UDP unicast/multicast, TCP server connections</li> <li>Audio Formats: MPEG Layer II (DAB), HE-AAC v2 (DAB+)</li> </ul>"},{"location":"#output-formats","title":"Output Formats","text":"<ul> <li>ETI Files: Raw ETI, streamed ETI (with timestamps), framed ETI</li> <li>EDI Network: UDP/TCP with TAG items, AF packets, optional PFT with FEC</li> <li>Multiple Outputs: Simultaneous file and network output</li> </ul>"},{"location":"#configuration","title":"Configuration","text":"<ul> <li>YAML Configuration: Human-readable configuration files</li> <li>Validation: Automatic validation with helpful error messages</li> <li>Examples: Comprehensive examples for common scenarios</li> </ul>"},{"location":"#advanced-features","title":"Advanced Features","text":"<ul> <li>FIG Carousel: Automatic rotation of FIG types with configurable timing</li> <li>Character Encoding: Full EBU Latin to UTF-8 conversion</li> <li>Timestamps: TIST (Time-Stamp) support for synchronization</li> <li>Statistics: Input buffer monitoring, underrun/overrun detection</li> <li>Error Protection: Configurable protection levels (0-4) with shortform/longform</li> </ul>"},{"location":"#why-python-dabmux","title":"Why python-dabmux?","text":"<ul> <li>Pure Python: Easy to install, modify, and integrate</li> <li>Educational: Clear code structure for learning DAB standards</li> <li>Well-Tested: 389 unit tests with 71% code coverage</li> <li>Type-Safe: Full type annotations with mypy validation</li> <li>Standards-Compliant: Follows ETSI EN 300 799 and related specifications</li> <li>Production-Ready: Feature-complete with robust error handling</li> </ul>"},{"location":"#example-usage","title":"Example Usage","text":""},{"location":"#basic-single-service","title":"Basic Single Service","text":"<pre><code>ensemble:\n  id: '0xCE15'\n  ecc: '0xE1'\n  transmission_mode: 'I'\n  label:\n    text: 'Test Ensemble'\n    short: 'Test'\n\nsubchannels:\n  - uid: 'audio1'\n    id: 0\n    type: 'audio'\n    bitrate: 128\n    protection:\n      level: 2\n    input: 'file://audio.mp2'\n\nservices:\n  - uid: 'service1'\n    id: '0x5001'\n    label:\n      text: 'Radio One'\n      short: 'Radio1'\n\ncomponents:\n  - uid: 'comp1'\n    service_id: '0x5001'\n    subchannel_id: 0\n</code></pre> <p>Run it:</p> <pre><code>python -m dabmux.cli -c config.yaml -o output.eti\n</code></pre> <p>More Examples \u2192</p>"},{"location":"#community-and-support","title":"Community and Support","text":"<ul> <li>GitHub: Report issues</li> <li>Documentation: You're reading it!</li> <li>Examples: Check the <code>examples/</code> directory in the repository</li> </ul>"},{"location":"#license","title":"License","text":"<p>python-dabmux is open source software. See the repository for license details.</p> <p>Ready to get started? Head to the Installation Guide or dive into Your First Multiplex!</p>"},{"location":"faq/","title":"Frequently Asked Questions","text":"<p>Common questions about python-dabmux and DAB multiplexing.</p>"},{"location":"faq/#general-questions","title":"General Questions","text":""},{"location":"faq/#what-is-python-dabmux","title":"What is python-dabmux?","text":"<p>python-dabmux is a pure Python implementation of a DAB/DAB+ multiplexer. It combines multiple audio streams into a single DAB ensemble for transmission, similar to ODR-DabMux but written in Python.</p> <p>Key features: - Complete ETI frame generation - File and network inputs (UDP/TCP) - ETI file and EDI network outputs - PFT with Reed-Solomon FEC - YAML configuration files - 389 unit tests, 71% coverage</p>"},{"location":"faq/#why-use-python-dabmux-instead-of-odr-dabmux","title":"Why use python-dabmux instead of ODR-DabMux?","text":"<p>Choose python-dabmux if you want: - Pure Python implementation (easy to modify and integrate) - Clear, readable code for learning DAB standards - Easy installation with pip - Python-based tooling and workflows</p> <p>Choose ODR-DabMux if you need: - Production-proven C++ implementation - Maximum performance - Lower resource usage - Established ecosystem</p> <p>Both are great options! python-dabmux is feature-complete and production-ready, but ODR-DabMux has been used in broadcast environments for years.</p>"},{"location":"faq/#is-python-dabmux-production-ready","title":"Is python-dabmux production-ready?","text":"<p>Yes! python-dabmux is feature-complete with: - All core features implemented (Phases 0-6 complete) - 389 unit tests with 71% code coverage - Full type annotations with mypy validation - Standards-compliant (ETSI EN 300 799)</p> <p>Use cases: - \u2705 Development and testing - \u2705 Small to medium deployments - \u2705 Educational purposes - \u2705 Integration with Python tools - \u26a0\ufe0f Large-scale production (consider ODR-DabMux for maximum performance)</p>"},{"location":"faq/#what-python-version-is-required","title":"What Python version is required?","text":"<p>Python 3.11 or later is required.</p> <p>python-dabmux uses modern Python features like: - Type annotations with <code>|</code> union syntax - Structural pattern matching - Improved type hints</p> <p>Check your version: <pre><code>python --version\n</code></pre></p> <p>Install Python 3.11+: <pre><code># Ubuntu/Debian\nsudo apt install python3.11\n\n# macOS (Homebrew)\nbrew install python@3.11\n</code></pre></p>"},{"location":"faq/#configuration-questions","title":"Configuration Questions","text":""},{"location":"faq/#how-do-i-create-a-configuration-file","title":"How do I create a configuration file?","text":"<p>Create a YAML file with four main sections:</p> <ol> <li>ensemble: Top-level parameters (ID, label, mode)</li> <li>subchannels: Audio/data streams (bitrate, protection, input)</li> <li>services: Radio stations (ID, labels, metadata)</li> <li>components: Links between services and subchannels</li> </ol> <p>Minimal example: <pre><code>ensemble:\n  id: '0xCE15'\n  ecc: '0xE1'\n  transmission_mode: 'I'\n  label:\n    text: 'My DAB'\n\nsubchannels:\n  - uid: 'audio1'\n    id: 0\n    bitrate: 128\n    input: 'file://audio.mp2'\n\nservices:\n  - uid: 'service1'\n    id: '0x5001'\n    label:\n      text: 'Radio One'\n\ncomponents:\n  - service_id: '0x5001'\n    subchannel_id: 0\n</code></pre></p> <p>See: Configuration Reference</p>"},{"location":"faq/#whats-the-difference-between-service-and-subchannel","title":"What's the difference between service and subchannel?","text":"<p>Services are what listeners see (radio stations): - Have names and labels - Have programme type (News, Music, etc.) - Multiple services per ensemble</p> <p>Subchannels are the actual data streams: - Carry audio or data - Have bitrates and protection levels - Connect to input sources</p> <p>Components link services to subchannels: - One service can have multiple components - Most commonly: one audio component per service</p> <p>Think of it like this: - Service = \"BBC Radio 1\" (what you tune to) - Subchannel = 128 kbps MPEG audio stream (the data) - Component = Link between them</p>"},{"location":"faq/#why-do-i-need-to-quote-hex-values","title":"Why do I need to quote hex values?","text":"<p>YAML interprets unquoted hex values as regular numbers.</p> <p>Wrong: <pre><code>id: 0xCE15    # YAML sees this as number 52757\n</code></pre></p> <p>Correct: <pre><code>id: '0xCE15'  # YAML sees this as string, parser converts to hex\n</code></pre></p> <p>Rule: Always quote hex values in YAML configuration files.</p>"},{"location":"faq/#can-i-use-the-same-audio-file-for-multiple-services","title":"Can I use the same audio file for multiple services?","text":"<p>Yes! You can point multiple subchannels to the same input file:</p> <pre><code>subchannels:\n  - uid: 'sub1'\n    id: 0\n    input: 'file://audio.mp2'  # Same file\n  - uid: 'sub2'\n    id: 1\n    input: 'file://audio.mp2'  # Same file\n</code></pre> <p>Each subchannel will independently read the file. This is useful for: - Testing with one audio source - Simulcasting the same content - Different protection levels for same content</p>"},{"location":"faq/#how-many-services-can-i-have-in-one-ensemble","title":"How many services can I have in one ensemble?","text":"<p>Theoretical limit: 64 subchannels (6-bit subchannel ID)</p> <p>Practical limit: Depends on capacity units available: - Mode I: 864 CU total - Each service uses CUs based on bitrate and protection level</p> <p>Example (Mode I): - 6-7 services at 128 kbps each (moderate protection) - 10-12 services at 64 kbps each (DAB+) - Fewer services at higher bitrates</p> <p>Calculation: Use a capacity calculator or let python-dabmux warn you if you exceed capacity.</p>"},{"location":"faq/#audio-and-input-questions","title":"Audio and Input Questions","text":""},{"location":"faq/#what-audio-formats-are-supported","title":"What audio formats are supported?","text":"<p>DAB (traditional): - MPEG-1 Audio Layer II (<code>.mp2</code> files) - Bitrates: 32-384 kbps (typical: 128-192 kbps)</p> <p>DAB+ (modern): - HE-AAC v2 (<code>.aac</code> files) - Bitrates: 32-192 kbps (typical: 48-72 kbps)</p> <p>Input methods: - File: <code>file://audio.mp2</code> - UDP: <code>udp://239.1.2.3:5001</code> - TCP: <code>tcp://192.168.1.100:5001</code></p>"},{"location":"faq/#how-do-i-convert-audio-to-mpeg-layer-ii","title":"How do I convert audio to MPEG Layer II?","text":"<p>Use ffmpeg to convert any audio to MPEG Layer II:</p> <pre><code># From WAV\nffmpeg -i input.wav -codec:a mp2 -b:a 128k output.mp2\n\n# From MP3\nffmpeg -i input.mp3 -codec:a mp2 -b:a 128k output.mp2\n\n# From AAC\nffmpeg -i input.m4a -codec:a mp2 -b:a 128k output.mp2\n\n# Specify sample rate (48 kHz recommended)\nffmpeg -i input.wav -codec:a mp2 -b:a 128k -ar 48000 output.mp2\n</code></pre> <p>Parameters: - <code>-codec:a mp2</code>: MPEG-1 Audio Layer II - <code>-b:a 128k</code>: Bitrate (match your configuration) - <code>-ar 48000</code>: Sample rate (24000, 32000, or 48000 Hz)</p>"},{"location":"faq/#should-i-use-dab-or-dab","title":"Should I use DAB or DAB+?","text":"<p>Use DAB (MPEG Layer II) if: - You need compatibility with older receivers - You want higher bitrates (192+ kbps) - You have existing MPEG equipment</p> <p>Use DAB+ (HE-AAC v2) if: - You want better quality at lower bitrates - You need more services per ensemble - Modern receivers (post-2010)</p> <p>Comparison:</p> Feature DAB (MPEG Layer II) DAB+ (HE-AAC v2) Quality at 64 kbps Fair Good Quality at 128 kbps Excellent Excellent Bitrate range 32-384 kbps 32-192 kbps Efficiency Lower Higher Compatibility Universal Modern only <p>Recommendation: Use DAB+ at 48-72 kbps for music, 32-48 kbps for speech/talk.</p>"},{"location":"faq/#can-i-stream-live-audio-into-python-dabmux","title":"Can I stream live audio into python-dabmux?","text":"<p>Yes! Use UDP or TCP network inputs:</p> <pre><code>subchannels:\n  - uid: 'live1'\n    id: 0\n    type: 'audio'\n    bitrate: 128\n    input: 'udp://239.1.2.3:5001'  # Listen for UDP stream\n</code></pre> <p>Stream audio with ffmpeg: <pre><code># Encode and stream to UDP\nffmpeg -re -i live_input.wav \\\n  -codec:a mp2 -b:a 128k -ar 48000 \\\n  -f rtp udp://239.1.2.3:5001\n</code></pre></p> <p>Or use gstreamer, VLC, or any tool that outputs MPEG Layer II to UDP/TCP.</p>"},{"location":"faq/#output-questions","title":"Output Questions","text":""},{"location":"faq/#whats-the-difference-between-eti-and-edi","title":"What's the difference between ETI and EDI?","text":"<p>ETI (Ensemble Transport Interface): - Raw frame format - File-based or stream-based - No built-in network protocol - Used for: recording, testing, file-based transmission</p> <p>EDI (Ensemble Data Interface): - Network protocol for transmitting ETI - Built on UDP or TCP - Optional PFT (fragmentation and FEC) - Used for: network transmission, multi-transmitter setups</p> <p>When to use: - ETI files: Testing, recording, file exchange - EDI network: Live transmission, distributed systems</p>"},{"location":"faq/#what-eti-file-format-should-i-use","title":"What ETI file format should I use?","text":"<p>Three formats available:</p> <ol> <li>Raw ETI (<code>-f raw</code>):</li> <li>Plain frames, no additional structure</li> <li>Smallest file size</li> <li>Compatible with most tools</li> <li> <p>Use for: General purpose, maximum compatibility</p> </li> <li> <p>Streamed ETI (<code>-f streamed</code>):</p> </li> <li>Frames with timing information</li> <li>Used for timed playback</li> <li> <p>Use for: Synchronized replay, timestamped archives</p> </li> <li> <p>Framed ETI (<code>-f framed</code>, default):</p> </li> <li>8-byte aligned frames with delimiters</li> <li>Easy to parse and process</li> <li>Use for: Processing, analysis, development</li> </ol> <p>Recommendation: Use framed (default) unless you need specific compatibility.</p>"},{"location":"faq/#when-should-i-use-pft","title":"When should I use PFT?","text":"<p>Use PFT (Protection, Fragmentation and Transport) when: - Transmitting over unreliable networks - MTU limitations require fragmentation - Packet loss is expected - Running distributed transmitter network (SFN)</p> <p>PFT provides: - Fragmentation (split large packets to fit MTU) - Sequence numbers (detect missing packets) - Reed-Solomon FEC (recover lost packets)</p> <p>Enable with: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --pft-fec\n</code></pre></p> <p>Without PFT: Use for reliable networks (wired, local)</p> <p>With PFT: Use for lossy networks (wireless, WAN, Internet)</p>"},{"location":"faq/#can-i-output-to-both-file-and-network-simultaneously","title":"Can I output to both file and network simultaneously?","text":"<p>Not directly. python-dabmux outputs to one destination at a time.</p> <p>Workarounds:</p> <ol> <li> <p>Run two instances: <pre><code># Terminal 1: File output\ndabmux -c config.yaml -o output.eti --continuous\n\n# Terminal 2: Network output (different config)\ndabmux -c config.yaml --edi udp://239.1.2.3:12000 --continuous\n</code></pre></p> </li> <li> <p>Use tee for UDP: <pre><code># Output to file, use external tools to multicast\ndabmux -c config.yaml -o output.eti\n# Then use separate tool to transmit file over network\n</code></pre></p> </li> <li> <p>Post-process: <pre><code># Generate file first\ndabmux -c config.yaml -o output.eti\n\n# Then transmit file\ncat output.eti | socat - UDP4-DATAGRAM:239.1.2.3:12000\n</code></pre></p> </li> </ol>"},{"location":"faq/#performance-questions","title":"Performance Questions","text":""},{"location":"faq/#how-much-cpu-does-python-dabmux-use","title":"How much CPU does python-dabmux use?","text":"<p>Typical usage: - Mode I: 10-20% of one CPU core at 10.4 frames/second - Multiple services: Scales linearly with number of services - PFT with FEC: +10-15% overhead</p> <p>Factors affecting performance: - Number of services - FIG types enabled - PFT and FEC - Input sources (network inputs have lower overhead than files)</p> <p>Optimization: - Use raw ETI format for output (smaller files) - Disable unnecessary FIG types - Use <code>-q</code> quiet mode (less logging overhead)</p>"},{"location":"faq/#can-python-dabmux-run-on-a-raspberry-pi","title":"Can python-dabmux run on a Raspberry Pi?","text":"<p>Yes! python-dabmux runs on Raspberry Pi 3 and later.</p> <p>Requirements: - Raspberry Pi 3 or newer (ARM processor) - Python 3.11+ - 512 MB RAM minimum - Recommended: Raspberry Pi 4 with 2+ GB RAM</p> <p>Performance: - RPi 3: 1-2 services comfortably - RPi 4: 4-6 services</p> <p>Tips: - Use Raspberry Pi OS Lite (no GUI) for lower overhead - Use file outputs or local network only (avoid Wi-Fi for streaming) - Use <code>-q</code> quiet mode to reduce logging</p>"},{"location":"faq/#how-much-bandwidth-does-edi-use","title":"How much bandwidth does EDI use?","text":"<p>Without PFT: - Approximately bitrate \u00d7 1.15 (15% overhead for headers) - Example: 6 services \u00d7 128 kbps = 768 kbps \u2192 ~880 kbps network traffic</p> <p>With PFT (no FEC): - Approximately bitrate \u00d7 1.25 (25% overhead) - Example: 768 kbps \u2192 ~960 kbps</p> <p>With PFT + FEC: - Depends on <code>--pft-fec-m</code> parameter - Add ~10-20% more for FEC redundancy - Example: 768 kbps \u2192 ~1100 kbps (with m=2)</p> <p>Calculate for your setup: <pre><code>Total bitrate = sum of all subchannel bitrates\nNetwork bandwidth = Total bitrate \u00d7 (1.15 to 1.35)\n</code></pre></p>"},{"location":"faq/#transmission-questions","title":"Transmission Questions","text":""},{"location":"faq/#whats-the-next-step-after-generating-eti","title":"What's the next step after generating ETI?","text":"<p>ETI is just the multiplex data. To broadcast, you need:</p> <ol> <li>Modulator: Converts ETI to RF signal</li> <li>Hardware: Professional DAB modulators</li> <li> <p>Software: ODR-DabMod (open source)</p> </li> <li> <p>Transmitter: Amplifies and transmits RF signal</p> </li> <li>RF power amplifier</li> <li>Antenna tuned for DAB frequencies</li> </ol> <p>Typical chain: <pre><code>python-dabmux \u2192 ETI \u2192 ODR-DabMod \u2192 RF \u2192 Transmitter \u2192 Antenna\n</code></pre></p> <p>For testing: - Use SDR (Software-Defined Radio) with ODR-DabMod - Desktop DAB radios can decode test transmissions</p>"},{"location":"faq/#what-dab-frequencies-can-i-use","title":"What DAB frequencies can I use?","text":"<p>Depends on your country and license!</p> <p>DAB Band III (most common): - 174-240 MHz - Channels 5A-13F - Used in Europe, Asia, Australia</p> <p>DAB L-Band: - 1452-1492 MHz - Used in some countries for local/mobile services</p> <p>Important: - Broadcasting requires a license in most countries - Unlicensed transmission is illegal and interferes with licensed services - For testing: Use very low power (&lt;1 mW) in a shielded environment - For production: Obtain proper broadcast license from your regulatory authority</p>"},{"location":"faq/#can-i-receive-python-dabmux-output-with-a-regular-dab-radio","title":"Can I receive python-dabmux output with a regular DAB radio?","text":"<p>Yes, but you need a modulator!</p> <ol> <li> <p>Generate ETI: <pre><code>dabmux -c config.yaml -o output.eti\n</code></pre></p> </li> <li> <p>Modulate with ODR-DabMod: <pre><code>odr-dabmod output.eti -o output.iq\n</code></pre></p> </li> <li> <p>Transmit with SDR:</p> </li> <li>HackRF, LimeSDR, USRP, etc.</li> <li> <p>Use very low power for testing</p> </li> <li> <p>Tune your DAB radio to the configured frequency</p> </li> </ol> <p>Warning: Only transmit in a shielded environment or with proper license.</p>"},{"location":"faq/#troubleshooting-questions","title":"Troubleshooting Questions","text":""},{"location":"faq/#why-am-i-getting-invalid-mpeg-frame-header","title":"Why am I getting \"Invalid MPEG frame header\"?","text":"<p>Common causes:</p> <ol> <li>Wrong file format:</li> <li>File is not MPEG Layer II</li> <li> <p>Use <code>file</code> and <code>ffprobe</code> to check format</p> </li> <li> <p>Corrupted file:</p> </li> <li>Re-encode the audio file</li> <li> <p>Check disk integrity</p> </li> <li> <p>Wrong subchannel type:</p> </li> <li>Type is <code>dabplus</code> but file is MPEG Layer II</li> <li> <p>Change type to <code>audio</code></p> </li> <li> <p>Network stream issues:</p> </li> <li>UDP packets arriving out of order</li> <li>Incomplete frames</li> <li>Try TCP instead of UDP</li> </ol> <p>Solution: <pre><code># Verify file format\nffprobe audio.mp2\n\n# Re-encode if needed\nffmpeg -i audio.mp2 -codec:a mp2 -b:a 128k audio_fixed.mp2\n</code></pre></p>"},{"location":"faq/#why-cant-python-dabmux-find-my-configuration-file","title":"Why can't python-dabmux find my configuration file?","text":"<p>Common causes:</p> <ol> <li> <p>Wrong path: <pre><code># Check current directory\npwd\nls -l config.yaml\n</code></pre></p> </li> <li> <p>Wrong filename: <pre><code># Maybe it's config.yml not config.yaml?\nls -l *.yaml *.yml\n</code></pre></p> </li> <li> <p>File in different directory: <pre><code># Use absolute path\ndabmux -c /full/path/to/config.yaml -o output.eti\n</code></pre></p> </li> </ol> <p>Solution: Use absolute paths for production: <pre><code>dabmux -c /etc/dabmux/config.yaml -o /var/dabmux/output.eti\n</code></pre></p>"},{"location":"faq/#how-do-i-debug-configuration-problems","title":"How do I debug configuration problems?","text":"<p>Enable maximum verbosity: <pre><code>dabmux -c config.yaml -o test.eti -n 1 -vvv\n</code></pre></p> <p>Check YAML syntax: - Use online YAML validators - Check indentation (spaces, not tabs) - Verify quotes around hex values</p> <p>Test with minimal config: <pre><code># Simplest possible config\nensemble:\n  id: '0xCE15'\n  label:\n    text: 'Test'\n\nsubchannels:\n  - uid: 'sub1'\n    id: 0\n    bitrate: 128\n    input: 'file://audio.mp2'\n\nservices:\n  - uid: 'svc1'\n    id: '0x5001'\n    label:\n      text: 'Test'\n\ncomponents:\n  - service_id: '0x5001'\n    subchannel_id: 0\n</code></pre></p> <p>See: Troubleshooting Guide</p>"},{"location":"faq/#getting-help","title":"Getting Help","text":""},{"location":"faq/#where-can-i-get-more-help","title":"Where can I get more help?","text":"<ol> <li>Documentation:</li> <li>User Guide</li> <li>Tutorials</li> <li> <p>Troubleshooting</p> </li> <li> <p>GitHub:</p> </li> <li>Issues</li> <li> <p>Discussions</p> </li> <li> <p>Community:</p> </li> <li>OpenDigitalRadio community</li> <li>DAB forums and mailing lists</li> </ol>"},{"location":"faq/#how-can-i-contribute","title":"How can I contribute?","text":"<p>Contributions welcome!</p> <ol> <li>Report bugs: GitHub Issues</li> <li>Suggest features: GitHub Discussions</li> <li>Submit code: Pull Requests</li> <li>Improve documentation: This documentation is in the <code>docs/</code> directory</li> </ol> <p>See: Contributing Guide</p>"},{"location":"faq/#see-also","title":"See Also","text":"<ul> <li>Getting Started: Installation and first multiplex</li> <li>User Guide: Complete usage documentation</li> <li>Tutorials: Hands-on guides</li> <li>Troubleshooting: Problem solving</li> <li>Glossary: DAB terminology</li> </ul>"},{"location":"architecture/","title":"Architecture Overview","text":"<p>This section explains the internal architecture of python-dabmux with detailed diagrams showing how the system works.</p>"},{"location":"architecture/#key-components","title":"Key Components","text":"<p>python-dabmux is organized into layers:</p> <ol> <li>Configuration Layer: Parses YAML and creates ensemble structure</li> <li>Input Layer: Handles file and network audio sources</li> <li>Core Layer: Multiplexes audio and generates FIGs</li> <li>Output Layer: Writes ETI files or sends EDI over network</li> </ol>"},{"location":"architecture/#architecture-diagrams","title":"Architecture Diagrams","text":""},{"location":"architecture/#system-design","title":"System Design","text":"<p>High-level architecture showing module structure and data flow:</p> <ul> <li>Configuration \u2192 Inputs \u2192 Multiplexer \u2192 FIG Generation \u2192 Outputs</li> <li>Module responsibilities</li> <li>Interface boundaries</li> </ul> <p>Mermaid diagram included</p> <p>View System Design \u2192</p>"},{"location":"architecture/#eti-frame-structure","title":"ETI Frame Structure","text":"<p>Detailed byte layout of ETI frames:</p> <ul> <li>SYNC, FC, STC headers</li> <li>FIC (Fast Information Channel)</li> <li>MST (Main Service Transport)</li> <li>EOF, TIST</li> </ul> <p>Mermaid diagram included</p> <p>View ETI Frames \u2192</p>"},{"location":"architecture/#fig-carousel","title":"FIG Carousel","text":"<p>How FIG types rotate based on repetition rates:</p> <ul> <li>FIG priority system</li> <li>Timing (96ms, 1s, etc.)</li> <li>Buffer management</li> <li>Sequence diagram</li> </ul> <p>Mermaid diagram included</p> <p>View FIG Carousel \u2192</p>"},{"location":"architecture/#data-flow","title":"Data Flow","text":"<p>Complete pipeline from inputs to outputs:</p> <ul> <li>Input buffers \u2192 Multiplexer</li> <li>FIG generation (parallel)</li> <li>Frame assembly</li> <li>Output formatting</li> </ul> <p>Mermaid diagram included</p> <p>View Data Flow \u2192</p>"},{"location":"architecture/#edi-protocol-stack","title":"EDI Protocol Stack","text":"<p>Layer-by-layer EDI protocol:</p> <ul> <li>TAG items (*ptr, deti, estN)</li> <li>AF packets</li> <li>PFT fragmentation</li> <li>UDP/TCP transport</li> </ul> <p>Mermaid diagram included</p> <p>View EDI Protocol \u2192</p>"},{"location":"architecture/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<p>Relationship between configuration elements:</p> <ul> <li>Ensemble \u2192 Services \u2192 Components \u2192 Subchannels \u2192 Inputs</li> <li>ID linkages</li> <li>Tree structure</li> </ul> <p>Mermaid diagram included</p> <p>View Configuration Hierarchy \u2192</p>"},{"location":"architecture/#module-breakdown","title":"Module Breakdown","text":"<p>Detailed description of each Python module:</p> <ul> <li>Purpose and responsibilities</li> <li>Key classes and functions</li> <li>Dependencies</li> <li>Usage patterns</li> </ul> <p>View Module Breakdown \u2192</p>"},{"location":"architecture/#design-principles","title":"Design Principles","text":""},{"location":"architecture/#separation-of-concerns","title":"Separation of Concerns","text":"<p>Each module has a clear responsibility:</p> <ul> <li>core/: Data structures only (no business logic)</li> <li>input/: Input handling only (no multiplexing)</li> <li>output/: Output handling only (no frame generation)</li> <li>mux.py: Orchestrates everything</li> </ul>"},{"location":"architecture/#type-safety","title":"Type Safety","text":"<ul> <li>Full type annotations on all public APIs</li> <li>mypy validation for type correctness</li> <li>Clear interfaces between modules</li> </ul>"},{"location":"architecture/#testability","title":"Testability","text":"<ul> <li>Unit tests for each module (389 tests total)</li> <li>Mocking for external dependencies</li> <li>Test coverage: 71%</li> </ul>"},{"location":"architecture/#extensibility","title":"Extensibility","text":"<ul> <li>Abstract base classes for inputs/outputs</li> <li>Plugin-style architecture for FIG types</li> <li>Easy to add new features</li> </ul>"},{"location":"architecture/#data-structures","title":"Data Structures","text":""},{"location":"architecture/#core-types","title":"Core Types","text":"<pre><code># Ensemble configuration\nDabEnsemble\n  \u251c\u2500 DabService[]\n  \u251c\u2500 DabSubchannel[]\n  \u2514\u2500 DabComponent[]\n\n# ETI frame structures\nEtiFrame\n  \u251c\u2500 Sync\n  \u251c\u2500 FrameCharacterization\n  \u251c\u2500 SubChannelStreamChar[]\n  \u251c\u2500 EndOfHeader\n  \u251c\u2500 FastInformationChannel\n  \u251c\u2500 MainServiceTransport\n  \u251c\u2500 EndOfFrame\n  \u2514\u2500 TimeStamp (optional)\n</code></pre>"},{"location":"architecture/#inputoutput-abstractions","title":"Input/Output Abstractions","text":"<pre><code># Input abstraction\nclass InputBase(ABC):\n    def open() -&gt; None\n    def read() -&gt; bytes\n    def close() -&gt; None\n\n# Output abstraction\nclass DabOutput(ABC):\n    def open() -&gt; None\n    def write(data: bytes) -&gt; None\n    def close() -&gt; None\n</code></pre>"},{"location":"architecture/#processing-flow","title":"Processing Flow","text":""},{"location":"architecture/#initialization","title":"Initialization","text":"<ol> <li>Load YAML configuration</li> <li>Parse into DabEnsemble</li> <li>Create DabMultiplexer</li> <li>Initialize inputs and outputs</li> <li>Validate configuration</li> </ol>"},{"location":"architecture/#frame-generation","title":"Frame Generation","text":"<ol> <li>Read audio data from all inputs</li> <li>Generate FIGs for current frame</li> <li>Encode FIC (Fast Information Channel)</li> <li>Populate MST (Main Service Transport)</li> <li>Calculate CRCs for headers and frame</li> <li>Add TIST (timestamp) if enabled</li> <li>Pack frame to binary</li> </ol>"},{"location":"architecture/#output-writing","title":"Output Writing","text":"<ol> <li>Serialize frame to bytes</li> <li>For file output: Write to file</li> <li>For EDI output: Convert to TAG items \u2192 AF packet \u2192 PFT (optional) \u2192 UDP/TCP</li> </ol>"},{"location":"architecture/#key-algorithms","title":"Key Algorithms","text":""},{"location":"architecture/#fig-carousel-scheduling","title":"FIG Carousel Scheduling","text":"<p>FIGs repeat at different rates: - FIG 0/0: Every 96ms (10 frames) - FIG 0/1, 0/2: Every 1 second (~10 frames) - FIG 1/0, 1/1: Every 1 second - Other FIGs: Every 10 seconds</p> <p>Algorithm: 1. Each FIG has a counter 2. Decrement counter each frame 3. When counter reaches 0, FIG is included 4. Reset counter to repetition interval</p>"},{"location":"architecture/#capacity-unit-allocation","title":"Capacity Unit Allocation","text":"<p>Subchannels use Capacity Units (CUs) based on bitrate and protection:</p> <p>Formula: <pre><code>CUs = f(bitrate, protection_level, form)\n</code></pre></p> <p>Allocation: 1. Sort subchannels by start_address 2. Assign contiguous CU ranges 3. Verify total doesn't exceed mode capacity (864 CUs for Mode I)</p>"},{"location":"architecture/#reed-solomon-fec","title":"Reed-Solomon FEC","text":"<p>For PFT error correction:</p> <p>GF(2^8) arithmetic: - Generator polynomial construction - Systematic encoding - Parity calculation</p> <p>Parameters: - (N, K) = (N, K-2M) where M is error recovery capability - Example: (255, 251) can recover 2 errors</p>"},{"location":"architecture/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"architecture/#cpu-usage","title":"CPU Usage","text":"<ul> <li>Frame generation: O(N) where N = number of services</li> <li>FIG encoding: O(F) where F = number of FIG types</li> <li>CRC calculation: O(L) where L = frame length</li> <li>Overall: ~10-20% of one core for typical ensemble</li> </ul>"},{"location":"architecture/#memory-usage","title":"Memory Usage","text":"<ul> <li>Ensemble config: ~10 KB</li> <li>Frame buffer: ~6 KB per frame</li> <li>Input buffers: Configurable (default: 10 frames per input)</li> <li>Total: ~5-10 MB for typical operation</li> </ul>"},{"location":"architecture/#io-performance","title":"I/O Performance","text":"<ul> <li>File I/O: Limited by disk speed</li> <li>Network I/O: Limited by network bandwidth</li> <li>Bottleneck: Usually input sources, not python-dabmux</li> </ul>"},{"location":"architecture/#thread-safety","title":"Thread Safety","text":"<p>python-dabmux is single-threaded by design:</p> <ul> <li>No locks or mutexes needed</li> <li>Simpler code and debugging</li> <li>Sufficient performance for DAB multiplexing</li> </ul> <p>For multi-core: Run multiple instances with different configurations.</p>"},{"location":"architecture/#error-handling","title":"Error Handling","text":""},{"location":"architecture/#validation-layers","title":"Validation Layers","text":"<ol> <li>Configuration parsing: YAML syntax, required fields</li> <li>Ensemble validation: ID uniqueness, capacity limits</li> <li>Input validation: File existence, format checks</li> <li>Runtime validation: Buffer underruns, CRC errors</li> </ol>"},{"location":"architecture/#graceful-degradation","title":"Graceful Degradation","text":"<ul> <li>Missing input: Zero-filled frames</li> <li>Network error: Retry with exponential backoff</li> <li>Buffer underrun: Warning logged, continue with available data</li> </ul>"},{"location":"architecture/#see-also","title":"See Also","text":"<ul> <li>System Design: High-level architecture</li> <li>Data Flow: Complete processing pipeline</li> <li>Module Breakdown: Detailed module descriptions</li> <li>API Reference: Code documentation</li> </ul>"},{"location":"architecture/configuration-hierarchy/","title":"Configuration Hierarchy","text":"<p>Tree diagram showing the relationship between configuration elements and how they link together.</p>"},{"location":"architecture/configuration-hierarchy/#configuration-hierarchy-diagram","title":"Configuration Hierarchy Diagram","text":"<pre><code>graph TB\n    subgraph \"Ensemble Level\"\n        ENS[EnsembleID: 0xCE15ECC: 0xE1Mode: ILabel: 'DAB Multiplex']\n    end\n\n    subgraph \"Service Level (What Listeners See)\"\n        SVC1[Service 1ID: 0x5001Label: 'Radio One'PTY: NewsLanguage: English]\n        SVC2[Service 2ID: 0x5002Label: 'Radio Two'PTY: Pop MusicLanguage: English]\n        SVC3[Service 3ID: 0x5003Label: 'Radio Three'PTY: ClassicalLanguage: English]\n    end\n\n    subgraph \"Component Level (Links)\"\n        COMP1[Component 1Links 0x5001to subchannel 0]\n        COMP2[Component 2Links 0x5002to subchannel 1]\n        COMP3[Component 3Links 0x5003to subchannel 2]\n    end\n\n    subgraph \"Subchannel Level (Data Streams)\"\n        SUB0[Subchannel 0ID: 0Type: DAB AudioBitrate: 128 kbpsProtection: Level 2Start Address: 0 CU]\n        SUB1[Subchannel 1ID: 1Type: DAB+ AudioBitrate: 80 kbpsProtection: Level 2Start Address: 128 CU]\n        SUB2[Subchannel 2ID: 2Type: DAB+ AudioBitrate: 96 kbpsProtection: Level 3Start Address: 256 CU]\n    end\n\n    subgraph \"Input Level (Audio Sources)\"\n        IN0[File Inputfile://audio1.mp2MPEG Layer II128 kbps]\n        IN1[UDP Inputudp://239.1.2.3:5001HE-AAC80 kbps]\n        IN2[TCP Inputtcp://192.168.1.100:5002HE-AAC96 kbps]\n    end\n\n    ENS --&gt; SVC1\n    ENS --&gt; SVC2\n    ENS --&gt; SVC3\n\n    SVC1 --&gt; COMP1\n    SVC2 --&gt; COMP2\n    SVC3 --&gt; COMP3\n\n    COMP1 --&gt; SUB0\n    COMP2 --&gt; SUB1\n    COMP3 --&gt; SUB2\n\n    SUB0 --&gt; IN0\n    SUB1 --&gt; IN1\n    SUB2 --&gt; IN2\n\n    style ENS fill:#ffcccc,stroke:#333,stroke-width:3px\n    style SVC1 fill:#ccffcc,stroke:#333,stroke-width:2px\n    style SVC2 fill:#ccffcc,stroke:#333,stroke-width:2px\n    style SVC3 fill:#ccffcc,stroke:#333,stroke-width:2px\n    style COMP1 fill:#ccccff,stroke:#333,stroke-width:2px\n    style COMP2 fill:#ccccff,stroke:#333,stroke-width:2px\n    style COMP3 fill:#ccccff,stroke:#333,stroke-width:2px\n    style SUB0 fill:#ffffcc,stroke:#333,stroke-width:2px\n    style SUB1 fill:#ffffcc,stroke:#333,stroke-width:2px\n    style SUB2 fill:#ffffcc,stroke:#333,stroke-width:2px\n    style IN0 fill:#ffccff,stroke:#333,stroke-width:2px\n    style IN1 fill:#ffccff,stroke:#333,stroke-width:2px\n    style IN2 fill:#ffccff,stroke:#333,stroke-width:2px\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#alternative-view-yaml-configuration-structure","title":"Alternative View: YAML Configuration Structure","text":"<pre><code>graph LR\n    subgraph \"YAML File: config.yaml\"\n        ROOT[Configuration Root]\n\n        subgraph \"ensemble:\"\n            E_ID[id: '0xCE15']\n            E_ECC[ecc: '0xE1']\n            E_MODE[transmission_mode: 'I']\n            E_LABEL[label:text: 'DAB Multiplex'short: 'DAB']\n        end\n\n        subgraph \"subchannels:\"\n            SC1[- uid: 'audio1'id: 0bitrate: 128input: 'file://...' ]\n            SC2[- uid: 'audio2'id: 1bitrate: 80input: 'udp://...']\n            SC3[- uid: 'audio3'id: 2bitrate: 96input: 'tcp://...']\n        end\n\n        subgraph \"services:\"\n            S1[- uid: 'svc1'id: '0x5001'label: 'Radio One']\n            S2[- uid: 'svc2'id: '0x5002'label: 'Radio Two']\n            S3[- uid: 'svc3'id: '0x5003'label: 'Radio Three']\n        end\n\n        subgraph \"components:\"\n            C1[- uid: 'comp1'service_id: '0x5001'subchannel_id: 0]\n            C2[- uid: 'comp2'service_id: '0x5002'subchannel_id: 1]\n            C3[- uid: 'comp3'service_id: '0x5003'subchannel_id: 2]\n        end\n\n        ROOT --&gt; E_ID\n        ROOT --&gt; E_ECC\n        ROOT --&gt; E_MODE\n        ROOT --&gt; E_LABEL\n\n        ROOT --&gt; SC1\n        ROOT --&gt; SC2\n        ROOT --&gt; SC3\n\n        ROOT --&gt; S1\n        ROOT --&gt; S2\n        ROOT --&gt; S3\n\n        ROOT --&gt; C1\n        ROOT --&gt; C2\n        ROOT --&gt; C3\n\n        C1 -.service_id.-&gt; S1\n        C1 -.subchannel_id.-&gt; SC1\n\n        C2 -.service_id.-&gt; S2\n        C2 -.subchannel_id.-&gt; SC2\n\n        C3 -.service_id.-&gt; S3\n        C3 -.subchannel_id.-&gt; SC3\n    end\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#hierarchy-levels-explained","title":"Hierarchy Levels Explained","text":""},{"location":"architecture/configuration-hierarchy/#level-1-ensemble-top-level","title":"Level 1: Ensemble (Top Level)","text":"<p>Purpose: Container for entire DAB multiplex</p> <p>Key Properties: - Ensemble ID (<code>id</code>): Unique 16-bit identifier (e.g., <code>0xCE15</code>) - Extended Country Code (<code>ecc</code>): Country identifier (e.g., <code>0xE1</code> for Germany) - Transmission Mode (<code>transmission_mode</code>): RF characteristics (I, II, III, or IV) - Label: Ensemble name displayed to listeners - LTO: Local Time Offset</p> <p>One per configuration file</p> <p>YAML Example: <pre><code>ensemble:\n  id: '0xCE15'\n  ecc: '0xE1'\n  transmission_mode: 'I'\n  label:\n    text: 'DAB Multiplex'\n    short: 'DAB'\n  lto_auto: true\n</code></pre></p> <p>Role: Defines the overall broadcast parameters that apply to all services.</p>"},{"location":"architecture/configuration-hierarchy/#level-2-services-radio-stations","title":"Level 2: Services (Radio Stations)","text":"<p>Purpose: Define radio stations that listeners can tune to</p> <p>Key Properties: - Service ID (<code>id</code>): Unique identifier for this service (e.g., <code>0x5001</code>) - Label: Station name (max 16 characters) - Short Label: Abbreviated name (max 8 characters) - PTY (Programme Type): Genre/category (News, Music, etc.) - Language: Language code</p> <p>Multiple services per ensemble (typically 3-10)</p> <p>YAML Example: <pre><code>services:\n  - uid: 'radio_one'\n    id: '0x5001'\n    label:\n      text: 'Radio One'\n      short: 'Radio1'\n    pty: 1       # News\n    language: 9  # English\n\n  - uid: 'radio_two'\n    id: '0x5002'\n    label:\n      text: 'Radio Two'\n      short: 'Radio2'\n    pty: 10      # Pop Music\n    language: 9\n</code></pre></p> <p>Role: Represents what listeners see in their radio's station list.</p>"},{"location":"architecture/configuration-hierarchy/#level-3-components-links","title":"Level 3: Components (Links)","text":"<p>Purpose: Link services to subchannels</p> <p>Key Properties: - Service ID (<code>service_id</code>): Which service this belongs to - Subchannel ID (<code>subchannel_id</code>): Which subchannel carries the data - Type: Component type (0=Audio, 60=PAD, etc.)</p> <p>One or more components per service</p> <p>YAML Example: <pre><code>components:\n  - uid: 'comp1'\n    service_id: '0x5001'    # Links to Radio One\n    subchannel_id: 0        # Uses subchannel 0\n    type: 0                 # Audio component\n\n  - uid: 'comp2'\n    service_id: '0x5002'    # Links to Radio Two\n    subchannel_id: 1        # Uses subchannel 1\n    type: 0\n</code></pre></p> <p>Role: Creates the mapping between what listeners see (services) and the actual data streams (subchannels).</p> <p>Important: <code>service_id</code> must match a service's <code>id</code>, and <code>subchannel_id</code> must match a subchannel's <code>id</code>.</p>"},{"location":"architecture/configuration-hierarchy/#level-4-subchannels-data-streams","title":"Level 4: Subchannels (Data Streams)","text":"<p>Purpose: Define the actual audio/data streams</p> <p>Key Properties: - Subchannel ID (<code>id</code>): Unique identifier (0-63) - Type: Stream type (audio, dabplus, packet, data) - Bitrate: Data rate in kbps - Start Address: Position in Capacity Units (CU) - Protection: Error protection configuration - Input URI: Source of audio data</p> <p>One per audio stream</p> <p>YAML Example: <pre><code>subchannels:\n  - uid: 'audio1'\n    id: 0\n    type: 'audio'           # DAB (MPEG Layer II)\n    bitrate: 128            # 128 kbps\n    start_address: 0        # Starts at CU 0\n    protection:\n      level: 2              # Moderate protection\n      shortform: true\n    input: 'file://audio1.mp2'\n\n  - uid: 'audio2'\n    id: 1\n    type: 'dabplus'         # DAB+ (HE-AAC)\n    bitrate: 80\n    start_address: 128      # Starts at CU 128\n    protection:\n      level: 2\n    input: 'udp://239.1.2.3:5001'\n</code></pre></p> <p>Role: Describes the actual data streams that carry audio, including where they start in the multiplex and how they're protected.</p>"},{"location":"architecture/configuration-hierarchy/#level-5-inputs-audio-sources","title":"Level 5: Inputs (Audio Sources)","text":"<p>Purpose: Define where audio data comes from</p> <p>Types: - File: <code>file://path/to/audio.mp2</code> - UDP: <code>udp://host:port</code> - TCP: <code>tcp://host:port</code></p> <p>One input per subchannel (specified in subchannel's <code>input</code> field)</p> <p>Examples: <pre><code># File input (local or absolute path)\ninput: 'file://audio.mp2'\ninput: 'file:///absolute/path/audio.mp2'\n\n# UDP unicast\ninput: 'udp://192.168.1.100:5001'\n\n# UDP multicast\ninput: 'udp://239.1.2.3:5001'\n\n# TCP\ninput: 'tcp://192.168.1.100:5002'\n</code></pre></p> <p>Role: Provides the actual audio data to feed into the subchannels.</p>"},{"location":"architecture/configuration-hierarchy/#id-relationships","title":"ID Relationships","text":""},{"location":"architecture/configuration-hierarchy/#how-ids-link-together","title":"How IDs Link Together","text":"<pre><code>Service ID (0x5001)\n    \u2193 (referenced by component)\nComponent: service_id = 0x5001, subchannel_id = 0\n    \u2193 (links to subchannel)\nSubchannel ID (0)\n    \u2193 (has input)\nInput URI\n</code></pre> <p>Example: 1. Service <code>0x5001</code> is \"Radio One\" 2. Component links service <code>0x5001</code> to subchannel <code>0</code> 3. Subchannel <code>0</code> is 128 kbps DAB audio 4. Input <code>file://audio.mp2</code> provides data</p> <p>Result: When listener tunes to \"Radio One\" (0x5001), receiver knows to decode subchannel 0, which gets data from audio.mp2.</p>"},{"location":"architecture/configuration-hierarchy/#id-validation","title":"ID Validation","text":"<p>python-dabmux validates:</p> <ol> <li>Unique service IDs: No two services can have same ID</li> <li>Unique subchannel IDs: No two subchannels can have same ID</li> <li>Valid component references:</li> <li><code>service_id</code> must exist in services</li> <li><code>subchannel_id</code> must exist in subchannels</li> <li>Capacity limits: Total subchannels fit in available bandwidth</li> </ol>"},{"location":"architecture/configuration-hierarchy/#complete-example-configuration","title":"Complete Example Configuration","text":"<pre><code># Ensemble configuration\nensemble:\n  id: '0xCE15'              # Ensemble ID\n  ecc: '0xE1'               # Germany\n  transmission_mode: 'I'     # Mode I (standard)\n  label:\n    text: 'My DAB'\n    short: 'DAB'\n  lto_auto: true            # Auto local time offset\n\n# Subchannels (data streams)\nsubchannels:\n  # Classical station: high quality DAB\n  - uid: 'classical_audio'\n    id: 0\n    type: 'audio'\n    bitrate: 192\n    start_address: 0\n    protection:\n      level: 3\n    input: 'file://classical.mp2'\n\n  # News station: speech, lower bitrate DAB+\n  - uid: 'news_audio'\n    id: 1\n    type: 'dabplus'\n    bitrate: 64\n    start_address: 200\n    protection:\n      level: 2\n    input: 'udp://239.1.2.3:5001'\n\n  # Pop station: DAB+\n  - uid: 'pop_audio'\n    id: 2\n    type: 'dabplus'\n    bitrate: 80\n    start_address: 300\n    protection:\n      level: 2\n    input: 'tcp://192.168.1.100:5002'\n\n# Services (radio stations)\nservices:\n  # Classical music station\n  - uid: 'classical_svc'\n    id: '0x5001'\n    label:\n      text: 'Classical FM'\n      short: 'Classic'\n    pty: 6      # Classical Music\n    language: 9  # English\n\n  # News station\n  - uid: 'news_svc'\n    id: '0x5002'\n    label:\n      text: 'News 24/7'\n      short: 'News24'\n    pty: 1      # News\n    language: 9\n\n  # Pop music station\n  - uid: 'pop_svc'\n    id: '0x5003'\n    label:\n      text: 'Pop Hits Radio'\n      short: 'PopHits'\n    pty: 10     # Pop Music\n    language: 9\n\n# Components (links)\ncomponents:\n  # Link Classical FM (0x5001) to subchannel 0\n  - uid: 'classical_comp'\n    service_id: '0x5001'\n    subchannel_id: 0\n    type: 0\n\n  # Link News 24/7 (0x5002) to subchannel 1\n  - uid: 'news_comp'\n    service_id: '0x5002'\n    subchannel_id: 1\n    type: 0\n\n  # Link Pop Hits Radio (0x5003) to subchannel 2\n  - uid: 'pop_comp'\n    service_id: '0x5003'\n    subchannel_id: 2\n    type: 0\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#data-structure-in-memory","title":"Data Structure in Memory","text":""},{"location":"architecture/configuration-hierarchy/#python-object-hierarchy","title":"Python Object Hierarchy","text":"<p>When python-dabmux loads configuration, it creates:</p> <pre><code>DabEnsemble\n  \u251c\u2500 id: 0xCE15\n  \u251c\u2500 ecc: 0xE1\n  \u251c\u2500 label: DabLabel(\"My DAB\")\n  \u251c\u2500 services: List[DabService]\n  \u2502   \u251c\u2500 DabService(id=0x5001, label=\"Classical FM\")\n  \u2502   \u251c\u2500 DabService(id=0x5002, label=\"News 24/7\")\n  \u2502   \u2514\u2500 DabService(id=0x5003, label=\"Pop Hits Radio\")\n  \u251c\u2500 subchannels: List[DabSubchannel]\n  \u2502   \u251c\u2500 DabSubchannel(id=0, bitrate=192, input=\"file://...\")\n  \u2502   \u251c\u2500 DabSubchannel(id=1, bitrate=64, input=\"udp://...\")\n  \u2502   \u2514\u2500 DabSubchannel(id=2, bitrate=80, input=\"tcp://...\")\n  \u2514\u2500 components: List[DabComponent]\n      \u251c\u2500 DabComponent(service_id=0x5001, subchannel_id=0)\n      \u251c\u2500 DabComponent(service_id=0x5002, subchannel_id=1)\n      \u2514\u2500 DabComponent(service_id=0x5003, subchannel_id=2)\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#lookup-operations","title":"Lookup Operations","text":"<p>Find service by ID: <pre><code>def get_service(ensemble: DabEnsemble, service_id: int) -&gt; DabService:\n    for service in ensemble.services:\n        if service.id == service_id:\n            return service\n    raise ValueError(f\"Service {service_id:04X} not found\")\n</code></pre></p> <p>Find subchannel for service: <pre><code>def get_subchannel_for_service(ensemble: DabEnsemble,\n                                 service_id: int) -&gt; DabSubchannel:\n    # Find component linking service to subchannel\n    for component in ensemble.components:\n        if component.service_id == service_id:\n            subchannel_id = component.subchannel_id\n            break\n    else:\n        raise ValueError(f\"No component for service {service_id:04X}\")\n\n    # Find subchannel\n    for subchannel in ensemble.subchannels:\n        if subchannel.id == subchannel_id:\n            return subchannel\n\n    raise ValueError(f\"Subchannel {subchannel_id} not found\")\n</code></pre></p>"},{"location":"architecture/configuration-hierarchy/#configuration-flow","title":"Configuration Flow","text":""},{"location":"architecture/configuration-hierarchy/#1-parse-yaml","title":"1. Parse YAML","text":"<pre><code>with open('config.yaml') as f:\n    config_dict = yaml.safe_load(f)\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#2-create-ensemble","title":"2. Create Ensemble","text":"<pre><code>ensemble = DabEnsemble(\n    id=config_dict['ensemble']['id'],\n    ecc=config_dict['ensemble']['ecc'],\n    # ...\n)\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#3-add-subchannels","title":"3. Add Subchannels","text":"<pre><code>for sub_cfg in config_dict['subchannels']:\n    subchannel = DabSubchannel(\n        id=sub_cfg['id'],\n        bitrate=sub_cfg['bitrate'],\n        input_uri=sub_cfg['input'],\n        # ...\n    )\n    ensemble.subchannels.append(subchannel)\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#4-add-services","title":"4. Add Services","text":"<pre><code>for svc_cfg in config_dict['services']:\n    service = DabService(\n        id=svc_cfg['id'],\n        label=DabLabel(svc_cfg['label']['text']),\n        # ...\n    )\n    ensemble.services.append(service)\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#5-add-components-links","title":"5. Add Components (Links)","text":"<pre><code>for comp_cfg in config_dict['components']:\n    component = DabComponent(\n        service_id=comp_cfg['service_id'],\n        subchannel_id=comp_cfg['subchannel_id'],\n        # ...\n    )\n    ensemble.components.append(component)\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#6-validate","title":"6. Validate","text":"<pre><code># Check all service_ids in components exist\nfor component in ensemble.components:\n    if not any(s.id == component.service_id for s in ensemble.services):\n        raise ValueError(f\"Unknown service_id: {component.service_id:04X}\")\n\n# Check all subchannel_ids in components exist\nfor component in ensemble.components:\n    if not any(s.id == component.subchannel_id for s in ensemble.subchannels):\n        raise ValueError(f\"Unknown subchannel_id: {component.subchannel_id}\")\n</code></pre>"},{"location":"architecture/configuration-hierarchy/#common-mistakes","title":"Common Mistakes","text":""},{"location":"architecture/configuration-hierarchy/#1-mismatched-service-ids","title":"1. Mismatched Service IDs","text":"<p>Wrong: <pre><code>services:\n  - id: '0x5001'  # Service ID\ncomponents:\n  - service_id: '0x5002'  # Different ID!\n</code></pre></p> <p>Error: <code>Unknown service_id: 0x5002</code></p>"},{"location":"architecture/configuration-hierarchy/#2-mismatched-subchannel-ids","title":"2. Mismatched Subchannel IDs","text":"<p>Wrong: <pre><code>subchannels:\n  - id: 0  # Subchannel ID\ncomponents:\n  - subchannel_id: 1  # Different ID!\n</code></pre></p> <p>Error: <code>Unknown subchannel_id: 1</code></p>"},{"location":"architecture/configuration-hierarchy/#3-duplicate-ids","title":"3. Duplicate IDs","text":"<p>Wrong: <pre><code>services:\n  - id: '0x5001'\n  - id: '0x5001'  # Duplicate!\n</code></pre></p> <p>Error: <code>Duplicate service ID: 0x5001</code></p>"},{"location":"architecture/configuration-hierarchy/#4-missing-component","title":"4. Missing Component","text":"<p>Wrong: <pre><code>services:\n  - id: '0x5001'\nsubchannels:\n  - id: 0\n# Missing component to link them!\n</code></pre></p> <p>Result: Service defined but no audio stream assigned.</p>"},{"location":"architecture/configuration-hierarchy/#see-also","title":"See Also","text":"<ul> <li>System Design: Overall architecture</li> <li>Configuration Reference: Complete YAML reference</li> <li>Configuration Examples: Working examples</li> <li>Basic Concepts: DAB terminology</li> </ul>"},{"location":"architecture/data-flow/","title":"Data Flow","text":"<p>Complete pipeline showing how data flows from inputs to outputs in python-dabmux.</p>"},{"location":"architecture/data-flow/#complete-data-flow-diagram","title":"Complete Data Flow Diagram","text":"<pre><code>flowchart TD\n    subgraph \"Input Sources\"\n        FILE1[Audio File 1audio1.mp2]\n        FILE2[Audio File 2audio2.mp2]\n        UDP[UDP Stream239.1.2.3:5001]\n        TCP[TCP Stream192.168.1.100:5002]\n    end\n\n    subgraph \"Input Layer\"\n        FINPUT1[FileInput 1]\n        FINPUT2[FileInput 2]\n        UINPUT[UDPInput]\n        TINPUT[TCPInput]\n    end\n\n    subgraph \"Input Buffers\"\n        BUF1[Buffer 110 frames]\n        BUF2[Buffer 210 frames]\n        BUF3[Buffer 310 frames]\n        BUF4[Buffer 410 frames]\n    end\n\n    subgraph \"Core Processing\"\n        MUX[DabMultiplexer]\n        AUDIO_PARSE[Audio ParserMPEG FrameDetection]\n    end\n\n    subgraph \"FIG Generation (Parallel)\"\n        CAROUSEL[FIG CarouselSchedule FIGs]\n        FIG0_0[FIG 0/0Ensemble Info]\n        FIG0_1[FIG 0/1Subchannel Org]\n        FIG0_2[FIG 0/2Service Org]\n        FIG1_0[FIG 1/0Ensemble Label]\n        FIG1_1[FIG 1/1Service Labels]\n        FIC[FIC Encoder32 FIBs]\n    end\n\n    subgraph \"Frame Assembly\"\n        ETI_BUILD[ETI Frame Builder]\n        SYNC_GEN[Generate SYNC]\n        FC_GEN[Generate FC]\n        STC_GEN[Generate STCs]\n        MST_POP[Populate MST]\n        CRC_CALC[Calculate CRCs]\n        PACK[Pack to Bytes]\n    end\n\n    subgraph \"Output Layer\"\n        FILE_OUT[FileOutput]\n        EDI_ENC[EDI Encoder]\n        PFT_FRAG[PFT Fragmenter]\n        UDP_OUT[UDP Output]\n    end\n\n    subgraph \"Output Destinations\"\n        ETI_FILE[output.eti]\n        NETWORK[239.1.2.3:12000]\n    end\n\n    FILE1 --&gt; FINPUT1\n    FILE2 --&gt; FINPUT2\n    UDP --&gt; UINPUT\n    TCP --&gt; TINPUT\n\n    FINPUT1 --&gt; BUF1\n    FINPUT2 --&gt; BUF2\n    UINPUT --&gt; BUF3\n    TINPUT --&gt; BUF4\n\n    BUF1 --&gt; MUX\n    BUF2 --&gt; MUX\n    BUF3 --&gt; MUX\n    BUF4 --&gt; MUX\n\n    MUX --&gt; AUDIO_PARSE\n    AUDIO_PARSE --&gt; ETI_BUILD\n\n    MUX --&gt; CAROUSEL\n    CAROUSEL --&gt; FIG0_0\n    CAROUSEL --&gt; FIG0_1\n    CAROUSEL --&gt; FIG0_2\n    CAROUSEL --&gt; FIG1_0\n    CAROUSEL --&gt; FIG1_1\n\n    FIG0_0 --&gt; FIC\n    FIG0_1 --&gt; FIC\n    FIG0_2 --&gt; FIC\n    FIG1_0 --&gt; FIC\n    FIG1_1 --&gt; FIC\n\n    FIC --&gt; ETI_BUILD\n\n    ETI_BUILD --&gt; SYNC_GEN\n    ETI_BUILD --&gt; FC_GEN\n    ETI_BUILD --&gt; STC_GEN\n    ETI_BUILD --&gt; MST_POP\n    ETI_BUILD --&gt; CRC_CALC\n    ETI_BUILD --&gt; PACK\n\n    PACK --&gt; FILE_OUT\n    PACK --&gt; EDI_ENC\n\n    FILE_OUT --&gt; ETI_FILE\n\n    EDI_ENC --&gt; PFT_FRAG\n    PFT_FRAG --&gt; UDP_OUT\n    UDP_OUT --&gt; NETWORK\n\n    style MUX fill:#f9f,stroke:#333,stroke-width:3px\n    style FIC fill:#bbf,stroke:#333,stroke-width:2px\n    style ETI_BUILD fill:#bfb,stroke:#333,stroke-width:2px\n    style PACK fill:#fbb,stroke:#333,stroke-width:2px\n</code></pre>"},{"location":"architecture/data-flow/#detailed-flow-description","title":"Detailed Flow Description","text":""},{"location":"architecture/data-flow/#stage-1-input-reading","title":"Stage 1: Input Reading","text":"<p>Purpose: Read audio data from various sources into buffers</p> <p>Process: <pre><code>1. For each subchannel:\n   a. Identify input type (file/UDP/TCP)\n   b. Open input source\n   c. Read audio frames\n   d. Store in circular buffer\n   e. Track buffer status (full/empty/underrun)\n</code></pre></p> <p>Input Classes:</p> <ul> <li> <p>FileInput: Sequential file reading   <pre><code>def read(self, size: int) -&gt; bytes:\n    data = self.file.read(size)\n    if len(data) &lt; size:  # EOF\n        if self.loop:\n            self.file.seek(0)  # Loop\n        else:\n            data += b'\\x00' * (size - len(data))  # Pad\n    return data\n</code></pre></p> </li> <li> <p>UDPInput: Non-blocking UDP receive   <pre><code>def read(self, size: int) -&gt; bytes:\n    data = b''\n    while len(data) &lt; size:\n        packet = self.socket.recv(4096)\n        data += packet\n    return data[:size]\n</code></pre></p> </li> <li> <p>TCPInput: Blocking TCP receive   <pre><code>def read(self, size: int) -&gt; bytes:\n    data = b''\n    while len(data) &lt; size:\n        chunk = self.socket.recv(size - len(data))\n        data += chunk\n    return data\n</code></pre></p> </li> </ul> <p>Buffering: - Default: 10 frames per input - Underrun detection: Log warning, fill with zeros - Overrun detection: Drop oldest data</p>"},{"location":"architecture/data-flow/#stage-2-audio-parsing","title":"Stage 2: Audio Parsing","text":"<p>Purpose: Parse MPEG frames and validate format</p> <p>Process: <pre><code>1. Scan for MPEG sync word (0xFFE, 0xFFF)\n2. Parse frame header:\n   - MPEG version (1 or 2)\n   - Layer (II)\n   - Bitrate\n   - Sample rate\n3. Validate frame size\n4. Extract frame data\n5. Update statistics\n</code></pre></p> <p>MPEG Frame Structure: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Header (4 bytes)                     \u2502\n\u2502  \u251c\u2500 Sync (11 bits): 0xFFE           \u2502\n\u2502  \u251c\u2500 Version (2 bits): MPEG-1        \u2502\n\u2502  \u251c\u2500 Layer (2 bits): Layer II        \u2502\n\u2502  \u251c\u2500 Bitrate (4 bits)                \u2502\n\u2502  \u251c\u2500 Sample rate (2 bits)            \u2502\n\u2502  \u2514\u2500 ...                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Audio Data (variable)                \u2502\n\u2502  (depends on bitrate)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Validation: <pre><code>def parse_mpeg_frame(data: bytes) -&gt; MpegFrame:\n    # Check sync word\n    if (data[0] &amp; 0xFF) != 0xFF or (data[1] &amp; 0xE0) != 0xE0:\n        raise ValueError(\"Invalid MPEG sync\")\n\n    # Parse header bits\n    version = (data[1] &gt;&gt; 3) &amp; 0x03\n    layer = (data[1] &gt;&gt; 1) &amp; 0x03\n    bitrate_idx = (data[2] &gt;&gt; 4) &amp; 0x0F\n\n    # Validate\n    if layer != 0x02:  # Layer II\n        raise ValueError(f\"Expected Layer II, got {layer}\")\n\n    return MpegFrame(...)\n</code></pre></p>"},{"location":"architecture/data-flow/#stage-3-fig-generation","title":"Stage 3: FIG Generation","text":"<p>Purpose: Generate Fast Information Groups describing the ensemble</p> <p>Process: <pre><code>1. Check FIG carousel timers\n2. Select FIGs to include this frame\n3. Generate each FIG:\n   - FIG 0/0: Ensemble ID, ECC\n   - FIG 0/1: Subchannel table\n   - FIG 0/2: Service-component mapping\n   - FIG 1/0: Ensemble label\n   - FIG 1/1: Service labels\n4. Encode FIGs into FIBs (Fast Information Blocks)\n5. Calculate CRC-8 for each FIB\n6. Pad with 0xFF if needed\n</code></pre></p> <p>FIG Carousel Timing:</p> FIG Type Repetition Frames 0/0 96 ms Every 1 frame 0/1 ~1 sec Every 10 frames 0/2 ~1 sec Every 10 frames 1/0 ~1 sec Every 10 frames 1/1 ~1 sec Every 10 frames Others ~10 sec Every 100 frames <p>FIG 0/0 Example (Ensemble Information): <pre><code>Byte 0: 0x00 (FIG type 0, extension 0)\nByte 1: 0xCE (Ensemble ID high byte)\nByte 2: 0x15 (Ensemble ID low byte)\nByte 3: 0xE1 (ECC)\n...\n</code></pre></p> <p>FIC Encoding: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 FIB 0 (3 bytes)     \u2502 \u2190 FIG 0/0 data + CRC-8\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 FIB 1 (3 bytes)     \u2502 \u2190 FIG 0/1 data + CRC-8\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 ...                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 FIB 31 (3 bytes)    \u2502 \u2190 Padding (0xFFFF) + CRC-8\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  Total: 96 bytes\n</code></pre></p>"},{"location":"architecture/data-flow/#stage-4-frame-assembly","title":"Stage 4: Frame Assembly","text":"<p>Purpose: Combine all components into complete ETI frame</p> <p>Process: <pre><code>1. Create SYNC field (ERR + 0x073AB6)\n2. Generate FC (Frame Characterization):\n   - FCT (frame count)\n   - NST (number of streams)\n   - MID (mode ID)\n3. Generate STC for each subchannel:\n   - SCID (subchannel ID)\n   - SAD (start address)\n   - STL (stream length)\n4. Calculate EOH CRC (FC + all STCs)\n5. Insert FIC data (96 bytes)\n6. Populate MST with audio data\n7. Calculate EOF CRC (MST)\n8. Add TIST if enabled\n</code></pre></p> <p>Assembly Order: <pre><code>def assemble_frame(self) -&gt; EtiFrame:\n    frame = EtiFrame()\n\n    # 1. SYNC\n    frame.sync.err = 0x00\n    frame.sync.fsync = 0x073AB6\n\n    # 2. FC\n    frame.fc.fct = self.frame_count % 250\n    frame.fc.nst = len(self.subchannels) - 1\n    frame.fc.mid = 0x01  # Mode I\n\n    # 3. STCs\n    for i, subchan in enumerate(self.subchannels):\n        stc = SubChannelStreamChar()\n        stc.scid = subchan.id\n        stc.sad = subchan.start_address\n        stc.stl = calculate_stream_length(subchan)\n        frame.stc.append(stc)\n\n    # 4. EOH with CRC\n    frame.eoh.crc = calculate_crc16(frame.fc, frame.stc)\n\n    # 5. FIC\n    frame.fic = self.fic_encoder.encode()\n\n    # 6. MST\n    frame.mst = self.populate_mst()\n\n    # 7. EOF with CRC\n    frame.eof.crc = calculate_crc16(frame.mst)\n\n    # 8. TIST (optional)\n    if self.enable_tist:\n        frame.tist = self.calculate_tist()\n\n    return frame\n</code></pre></p>"},{"location":"architecture/data-flow/#stage-5-output-writing","title":"Stage 5: Output Writing","text":"<p>Purpose: Serialize frame and write to destination</p>"},{"location":"architecture/data-flow/#file-output","title":"File Output","text":"<p>Raw ETI: <pre><code>def write(self, frame: EtiFrame) -&gt; None:\n    data = frame.pack()  # Serialize to bytes\n    self.file.write(data)\n</code></pre></p> <p>Framed ETI: <pre><code>def write(self, frame: EtiFrame) -&gt; None:\n    data = frame.pack()\n    # Add frame delimiter\n    self.file.write(b'FR')\n    self.file.write(struct.pack('&gt;H', len(data)))\n    self.file.write(data)\n</code></pre></p> <p>Streamed ETI: <pre><code>def write(self, frame: EtiFrame) -&gt; None:\n    data = frame.pack()\n    # Add timestamp\n    self.file.write(struct.pack('&gt;Q', frame.tist or 0))\n    self.file.write(data)\n</code></pre></p>"},{"location":"architecture/data-flow/#edi-output","title":"EDI Output","text":"<p>Conversion to EDI: <pre><code>ETI Frame\n  \u2193\nTAG Items (*ptr, deti, estN)\n  \u2193\nAF Packet (8-byte aligned, CRC)\n  \u2193\nPFT Fragmentation (optional)\n  \u2193\nPF Fragments with FEC (optional)\n  \u2193\nUDP/TCP Output\n</code></pre></p> <p>EDI Encoding: <pre><code>def encode_edi(self, frame: EtiFrame) -&gt; bytes:\n    # 1. Create TAG items\n    tags = []\n    tags.append(create_ptr_tag())       # Protocol tag\n    tags.append(create_deti_tag(frame)) # ETI data\n    for i, subchan in enumerate(frame.subchannels):\n        tags.append(create_est_tag(i, subchan))\n\n    # 2. Create AF packet\n    af_packet = create_af_packet(tags)\n\n    # 3. Optionally fragment with PFT\n    if self.enable_pft:\n        fragments = self.pft.fragment(af_packet)\n        return fragments\n    else:\n        return af_packet\n</code></pre></p> <p>PFT Fragmentation: <pre><code>Large AF Packet (e.g., 6000 bytes)\n  \u2193\nFragment 1 (1400 bytes)\nFragment 2 (1400 bytes)\nFragment 3 (1400 bytes)\nFragment 4 (1400 bytes)\nFragment 5 (1400 bytes)\n  \u2193\nAdd RS-FEC (2 parity fragments)\n  \u2193\nFragment 1, 2, 3, 4, 5, P1, P2\n</code></pre></p>"},{"location":"architecture/data-flow/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"architecture/data-flow/#throughput","title":"Throughput","text":"<p>Mode I (typical): - Frame rate: 10.42 frames/second - Frame size: ~6000 bytes - Throughput: ~62 KB/s (500 kbps) - CPU: 10-20% of one core</p>"},{"location":"architecture/data-flow/#latency","title":"Latency","text":"<p>End-to-end latency: <pre><code>Input read:       ~10 ms (buffering)\nAudio parsing:    ~1 ms\nFIG generation:   ~1 ms\nFrame assembly:   ~2 ms\nCRC calculation:  ~1 ms\nOutput write:     ~1 ms (file) or ~5 ms (network)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTotal:            ~16-20 ms\n</code></pre></p>"},{"location":"architecture/data-flow/#memory-usage","title":"Memory Usage","text":"<p>Per-frame memory: <pre><code>Input buffers:    ~60 KB (10 frames \u00d7 6 KB)\nFrame structure:  ~6 KB\nFIG cache:        ~2 KB\nOutput buffer:    ~6 KB\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTotal:            ~75 KB per active multiplex\n</code></pre></p>"},{"location":"architecture/data-flow/#data-transformations","title":"Data Transformations","text":""},{"location":"architecture/data-flow/#input-mst","title":"Input \u2192 MST","text":"<p>Transformation: <pre><code>MPEG File (audio.mp2)\n  \u2193 [FileInput.read()]\nRaw bytes\n  \u2193 [Audio parser]\nMPEG frames\n  \u2193 [Extract payload]\nAudio data\n  \u2193 [Populate MST]\nMain Service Transport\n</code></pre></p>"},{"location":"architecture/data-flow/#fig-fic","title":"FIG \u2192 FIC","text":"<p>Transformation: <pre><code>Ensemble Config\n  \u2193 [FIG generators]\nFIG 0/0, 0/1, 0/2, 1/0, 1/1\n  \u2193 [FIG Carousel]\nSelected FIGs for this frame\n  \u2193 [FIC Encoder]\n32 FIBs (3 bytes each)\n  \u2193 [CRC-8]\n96 bytes FIC\n</code></pre></p>"},{"location":"architecture/data-flow/#eti-edi","title":"ETI \u2192 EDI","text":"<p>Transformation: <pre><code>ETI Frame\n  \u2193 [EDI Encoder]\nTAG Items (*ptr, deti, estN)\n  \u2193 [AF Packet]\nAF packet (aligned, CRC'd)\n  \u2193 [PFT Fragmenter]\nPF fragments\n  \u2193 [RS-FEC]\nPF fragments + parity\n  \u2193 [UDP Output]\nNetwork packets\n</code></pre></p>"},{"location":"architecture/data-flow/#error-handling-in-pipeline","title":"Error Handling in Pipeline","text":""},{"location":"architecture/data-flow/#input-stage","title":"Input Stage","text":"<p>Error: File not found Action: Raise FileNotFoundError at startup</p> <p>Error: Network timeout Action: Log warning, retry 3 times, then fail</p> <p>Error: Invalid MPEG frame Action: Log warning, skip frame, continue</p>"},{"location":"architecture/data-flow/#processing-stage","title":"Processing Stage","text":"<p>Error: Capacity exceeded Action: Raise ConfigurationError at startup</p> <p>Error: Invalid FIG Action: Log error, skip FIG, continue</p>"},{"location":"architecture/data-flow/#output-stage","title":"Output Stage","text":"<p>Error: Can't write file Action: Raise IOError, stop multiplexer</p> <p>Error: Network unreachable Action: Log error, retry with exponential backoff</p>"},{"location":"architecture/data-flow/#optimization-points","title":"Optimization Points","text":""},{"location":"architecture/data-flow/#hot-paths","title":"Hot Paths","text":"<ol> <li>MPEG frame parsing (per frame, per subchannel)</li> <li>CRC calculation (per frame, multiple times)</li> <li>FIG encoding (per frame)</li> <li>Byte packing (per frame)</li> </ol>"},{"location":"architecture/data-flow/#optimizations","title":"Optimizations","text":"<p>Caching: - Cache FIG bytes (many don't change) - Cache CRC tables - Cache character set mappings</p> <p>Pre-allocation: - Reuse frame buffers - Pre-allocate output buffers</p> <p>Batch operations: - Read multiple frames from inputs - Write buffered output</p>"},{"location":"architecture/data-flow/#see-also","title":"See Also","text":"<ul> <li>System Design: Overall architecture</li> <li>ETI Frames: Frame structure details</li> <li>FIG Carousel: FIG scheduling</li> <li>EDI Protocol: Network output protocol</li> </ul>"},{"location":"architecture/edi-protocol/","title":"EDI Protocol Stack","text":"<p>Layer-by-layer breakdown of the EDI (Ensemble Data Interface) protocol for transmitting ETI over IP networks.</p>"},{"location":"architecture/edi-protocol/#edi-protocol-stack-diagram","title":"EDI Protocol Stack Diagram","text":"<pre><code>graph TB\n    subgraph \"Application Layer\"\n        ETI[ETI Frame~6000 bytesAudio + Metadata]\n    end\n\n    subgraph \"EDI TAG Layer\"\n        PTR[*ptr TAGProtocol Type]\n        DETI[deti TAGETI Data]\n        EST[est TAGStream DataestN for each stream]\n    end\n\n    subgraph \"TAG Packet Layer\"\n        TAGPKT[TAG Packet8-byte alignedAll TAGs concatenated]\n    end\n\n    subgraph \"AF Packet Layer\"\n        AFSYNC[SYNC: 'AF'2 bytes]\n        AFLEN[LEN4 bytesPacket length]\n        AFSEQ[SEQ2 bytesSequence number]\n        AFCRC[CRC-324 bytes]\n        AFPAYLOAD[PayloadTAG Packet]\n    end\n\n    subgraph \"PFT Layer (Optional)\"\n        PFTSYNC[SYNC: 'PF'2 bytes]\n        PFTSEQ[SEQ2 bytes]\n        PFTFEC[FEC InfoFEC params]\n        PFTADDR[AddressingFrag info]\n        PFTPAYLOAD[PayloadAF fragment]\n        PFTRS[RS ParityOptionalReed-Solomon]\n    end\n\n    subgraph \"Transport Layer\"\n        UDP[UDP DatagramorTCP Stream]\n    end\n\n    subgraph \"Network Layer\"\n        IP[IP PacketUnicast/Multicast]\n    end\n\n    ETI --&gt; PTR\n    ETI --&gt; DETI\n    ETI --&gt; EST\n\n    PTR --&gt; TAGPKT\n    DETI --&gt; TAGPKT\n    EST --&gt; TAGPKT\n\n    TAGPKT --&gt; AFSYNC\n    TAGPKT --&gt; AFLEN\n    TAGPKT --&gt; AFSEQ\n    TAGPKT --&gt; AFPAYLOAD\n    TAGPKT --&gt; AFCRC\n\n    AFSYNC --&gt; PFTSYNC\n    AFLEN --&gt; PFTSEQ\n    AFSEQ --&gt; PFTFEC\n    AFPAYLOAD --&gt; PFTADDR\n    AFCRC --&gt; PFTPAYLOAD\n\n    PFTPAYLOAD --&gt; PFTRS\n    PFTRS --&gt; UDP\n    UDP --&gt; IP\n\n    style ETI fill:#ffcccc,stroke:#333,stroke-width:2px\n    style TAGPKT fill:#ccffcc,stroke:#333,stroke-width:2px\n    style AFPAYLOAD fill:#ccccff,stroke:#333,stroke-width:2px\n    style PFTPAYLOAD fill:#ffffcc,stroke:#333,stroke-width:2px\n    style UDP fill:#ffccff,stroke:#333,stroke-width:2px\n</code></pre>"},{"location":"architecture/edi-protocol/#protocol-layers-overview","title":"Protocol Layers Overview","text":""},{"location":"architecture/edi-protocol/#1-application-layer-eti-frame","title":"1. Application Layer: ETI Frame","text":"<p>Purpose: Raw ETI data to be transmitted</p> <p>Contents: - Complete ETI frame (SYNC, FC, STC, FIC, MST, EOF, TIST) - Size: Variable, typically ~6000 bytes for Mode I</p> <p>Example: <pre><code>ETI Frame (5604 bytes):\n  SYNC (4) + FC (4) + STC (12) + EOH (4) +\n  FIC (96) + MST (5472) + EOF (4) + TIST (4)\n</code></pre></p>"},{"location":"architecture/edi-protocol/#2-edi-tag-layer","title":"2. EDI TAG Layer","text":"<p>Purpose: Structure ETI data into TAG items</p> <p>TAG items are TLV (Type-Length-Value) structures that encapsulate different parts of the ETI frame.</p>"},{"location":"architecture/edi-protocol/#tag-structure","title":"TAG Structure","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Name \u2502 Len  \u2502   Value      \u2502\n\u2502 4B   \u2502 4B   \u2502  variable    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Fields: - Name: 4-character ASCII identifier - Length: 32-bit big-endian length (of Value) - Value: TAG-specific data</p>"},{"location":"architecture/edi-protocol/#tag-types","title":"TAG Types","text":"<p>*ptr - Protocol Type and Revision</p> <pre><code>TAG Name: '*ptr'\nLength: 4 bytes\nValue:\n  Byte 0-1: Protocol type (\"TA\", \"ET\", \"ED\")\n  Byte 2-3: Revision (0x0001)\n</code></pre> <p>Example: <pre><code>2A 70 74 72  # \"*ptr\"\n00 00 00 04  # Length = 4\n45 54 00 01  # \"ET\" + revision 0x0001\n</code></pre></p> <p>deti - DAB ETI Data</p> <pre><code>TAG Name: 'deti'\nLength: Variable (depends on frame)\nValue:\n  Complete ETI frame (all fields)\n</code></pre> <p>Example: <pre><code>64 65 74 69  # \"deti\"\n00 00 15 E4  # Length = 5604\n[ETI frame bytes...]\n</code></pre></p> <p>estN - Ensemble Stream Data (N = stream number)</p> <pre><code>TAG Name: 'est0', 'est1', 'est2', etc.\nLength: Variable\nValue:\n  Audio/data for specific stream\n</code></pre> <p>Example for stream 0: <pre><code>65 73 74 30  # \"est0\"\n00 00 01 40  # Length = 320\n[Stream 0 audio data...]\n</code></pre></p>"},{"location":"architecture/edi-protocol/#3-tag-packet-layer","title":"3. TAG Packet Layer","text":"<p>Purpose: Concatenate all TAGs into a single packet with 8-byte alignment</p> <p>Structure: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 *ptr TAG        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 deti TAG        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 est0 TAG        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 est1 TAG        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 ...             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Padding (align) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Alignment: - Total packet size must be multiple of 8 bytes - Pad with 0x00 bytes if needed</p> <p>Example: <pre><code>def create_tag_packet(tags: List[bytes]) -&gt; bytes:\n    packet = b''.join(tags)\n\n    # Align to 8 bytes\n    padding = (8 - (len(packet) % 8)) % 8\n    packet += b'\\x00' * padding\n\n    return packet\n</code></pre></p>"},{"location":"architecture/edi-protocol/#4-af-packet-layer-application-framing","title":"4. AF Packet Layer (Application Framing)","text":"<p>Purpose: Frame TAG packets with sync, length, sequence, and CRC</p>"},{"location":"architecture/edi-protocol/#af-packet-structure","title":"AF Packet Structure","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SYNC: \"AF\"  (2 bytes)\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 LEN         (4 bytes)\u2502  Length of entire AF packet\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 SEQ         (2 bytes)\u2502  Sequence number\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 AR          (1 byte) \u2502  Address type (0=unicast)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 PT          (1 byte) \u2502  Protocol type (0x02=TAG)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Payload   (variable) \u2502  TAG Packet\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 CRC-32      (4 bytes)\u2502  CRC of entire packet\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/edi-protocol/#field-descriptions","title":"Field Descriptions","text":"<p>SYNC (2 bytes): - Fixed value: <code>0x4146</code> (\"AF\" in ASCII) - Used for packet synchronization</p> <p>LEN (4 bytes, big-endian): - Total AF packet length including header and CRC - Example: <code>0x000015F4</code> = 5620 bytes</p> <p>SEQ (2 bytes, big-endian): - Sequence number (0-65535, wraps) - Increments for each AF packet - Used to detect missing packets</p> <p>AR (1 byte): - Address type - <code>0x00</code>: Not used (unicast) - <code>0x01</code>: Multicast group address</p> <p>PT (1 byte): - Protocol type - <code>0x02</code>: TAG packet (most common)</p> <p>Payload (variable): - TAG packet data (8-byte aligned)</p> <p>CRC-32 (4 bytes): - CRC-32 of entire AF packet (SYNC through Payload) - Polynomial: 0x04C11DB7 - Initial: 0xFFFFFFFF - Final XOR: 0xFFFFFFFF</p>"},{"location":"architecture/edi-protocol/#af-packet-creation","title":"AF Packet Creation","text":"<pre><code>def create_af_packet(tag_packet: bytes, seq: int) -&gt; bytes:\n    # Header\n    sync = b'AF'\n    ar = 0x00  # Not used\n    pt = 0x02  # TAG packet\n\n    # Length (will be calculated)\n    payload = tag_packet\n    total_len = 2 + 4 + 2 + 1 + 1 + len(payload) + 4\n\n    # Assemble packet\n    packet = bytearray()\n    packet += sync\n    packet += struct.pack('&gt;I', total_len)  # LEN\n    packet += struct.pack('&gt;H', seq &amp; 0xFFFF)  # SEQ\n    packet += bytes([ar, pt])\n    packet += payload\n\n    # Calculate CRC-32\n    crc = calculate_crc32(packet)\n    packet += struct.pack('&gt;I', crc)\n\n    return bytes(packet)\n</code></pre>"},{"location":"architecture/edi-protocol/#5-pft-layer-protection-fragmentation-transport","title":"5. PFT Layer (Protection, Fragmentation, Transport)","text":"<p>Purpose: Fragment large AF packets and add FEC for error recovery</p>"},{"location":"architecture/edi-protocol/#when-to-use-pft","title":"When to Use PFT","text":"<p>Use PFT when: - AF packet exceeds network MTU (~1500 bytes) - Network is lossy (wireless, WAN) - Error recovery needed (Reed-Solomon FEC)</p> <p>Skip PFT when: - AF packet fits in single UDP datagram - Network is reliable (wired LAN) - Low latency required</p>"},{"location":"architecture/edi-protocol/#pft-fragment-structure","title":"PFT Fragment Structure","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SYNC: \"PF\"  (2 bytes)\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 PSEQ        (2 bytes)\u2502  PFT sequence number\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Findex      (3 bytes)\u2502  Fragment index (24-bit)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Fcount      (3 bytes)\u2502  Total fragments (24-bit)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 FEC         (1 byte) \u2502  FEC parameters\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Addr        (1 byte) \u2502  Addressing\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Plen        (2 bytes)\u2502  Payload length\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 RSk         (1 byte) \u2502  RS data blocks\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 RSz         (1 byte) \u2502  RS redundancy\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Payload   (variable) \u2502  AF fragment\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 RS Parity (optional) \u2502  Reed-Solomon FEC\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/edi-protocol/#field-descriptions_1","title":"Field Descriptions","text":"<p>SYNC (2 bytes): - Fixed value: <code>0x5046</code> (\"PF\" in ASCII)</p> <p>PSEQ (2 bytes): - PFT sequence number - Increments for each AF packet (not per fragment) - All fragments of same AF packet have same PSEQ</p> <p>Findex (3 bytes): - Fragment index (0-based) - Which fragment this is (0, 1, 2, ...)</p> <p>Fcount (3 bytes): - Total number of fragments - Includes data fragments + parity fragments</p> <p>FEC (1 byte): - Bit 7: FEC enabled (1=yes, 0=no) - Bits 6-0: Reserved</p> <p>Addr (1 byte): - Addressing information</p> <p>Plen (2 bytes): - Payload length for this fragment</p> <p>RSk (1 byte): - Number of RS data blocks (k) - Only if FEC enabled</p> <p>RSz (1 byte): - Number of RS parity blocks (m) - Only if FEC enabled</p> <p>Payload (variable): - Fragment of AF packet</p> <p>RS Parity (optional): - Reed-Solomon parity data - Only on parity fragments when FEC enabled</p>"},{"location":"architecture/edi-protocol/#fragmentation-algorithm","title":"Fragmentation Algorithm","text":"<pre><code>def fragment_af_packet(af_packet: bytes, max_frag_size: int,\n                       fec_enabled: bool, fec_m: int) -&gt; List[bytes]:\n    \"\"\"\n    Fragment AF packet into PFT fragments.\n\n    Args:\n        af_packet: Complete AF packet\n        max_frag_size: Maximum fragment payload size\n        fec_enabled: Enable Reed-Solomon FEC\n        fec_m: Number of parity fragments (if FEC enabled)\n\n    Returns:\n        List of PFT fragments\n    \"\"\"\n    # Calculate data fragments\n    num_data_frags = (len(af_packet) + max_frag_size - 1) // max_frag_size\n\n    # Total fragments (data + parity)\n    if fec_enabled:\n        num_total_frags = num_data_frags + fec_m\n    else:\n        num_total_frags = num_data_frags\n\n    fragments = []\n    pseq = get_next_pseq()\n\n    # Create data fragments\n    for i in range(num_data_frags):\n        start = i * max_frag_size\n        end = min(start + max_frag_size, len(af_packet))\n        payload = af_packet[start:end]\n\n        frag = create_pft_fragment(\n            pseq=pseq,\n            findex=i,\n            fcount=num_total_frags,\n            payload=payload,\n            fec_enabled=fec_enabled,\n            rsk=num_data_frags if fec_enabled else 0,\n            rsz=fec_m if fec_enabled else 0\n        )\n        fragments.append(frag)\n\n    # Create parity fragments (if FEC enabled)\n    if fec_enabled:\n        parity_data = calculate_rs_parity(af_packet, num_data_frags, fec_m)\n        parity_frag_size = len(parity_data) // fec_m\n\n        for i in range(fec_m):\n            start = i * parity_frag_size\n            end = start + parity_frag_size\n            payload = parity_data[start:end]\n\n            frag = create_pft_fragment(\n                pseq=pseq,\n                findex=num_data_frags + i,\n                fcount=num_total_frags,\n                payload=payload,\n                fec_enabled=True,\n                rsk=num_data_frags,\n                rsz=fec_m\n            )\n            fragments.append(frag)\n\n    return fragments\n</code></pre>"},{"location":"architecture/edi-protocol/#reed-solomon-fec","title":"Reed-Solomon FEC","text":"<p>Parameters: - k: Number of data fragments - m: Number of parity fragments - n = k + m: Total fragments</p> <p>Recovery capability: - Can recover up to m lost fragments - Example: (k=5, m=2) \u2192 Can lose any 2 of 7 fragments</p> <p>RS(255, k) encoding: - Operates over GF(2^8) (Galois Field) - Generator polynomial with roots at \u03b1^1, \u03b1^2, ..., \u03b1^(n-k)</p> <p>Example: <pre><code># Fragment AF packet (6000 bytes, 1400-byte fragments)\n# \u2192 5 data fragments (1400, 1400, 1400, 1400, 1400)\n\n# Add 2 parity fragments with RS FEC\n# \u2192 7 total fragments\n\n# Can lose any 2 fragments and still reconstruct:\n# Lost fragments 2 and 4? Reconstruct from 1,3,5,P1,P2\n</code></pre></p>"},{"location":"architecture/edi-protocol/#6-transport-layer-udptcp","title":"6. Transport Layer: UDP/TCP","text":"<p>UDP (User Datagram Protocol):</p> <p>Use cases: - Low latency - Multicast support - Stateless</p> <p>Characteristics: - Connectionless - No guaranteed delivery - No ordering guarantee - Suitable with PFT+FEC</p> <p>Example: <pre><code># Send PFT fragment over UDP\nsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\nsock.sendto(pft_fragment, (dest_ip, dest_port))\n</code></pre></p> <p>TCP (Transmission Control Protocol):</p> <p>Use cases: - Reliable delivery required - Unicast only - Stateful connection</p> <p>Characteristics: - Connection-oriented - Guaranteed delivery - In-order delivery - PFT optional (less needed)</p> <p>Example: <pre><code># Send AF packet over TCP\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nsock.connect((dest_ip, dest_port))\nsock.sendall(af_packet)\n</code></pre></p>"},{"location":"architecture/edi-protocol/#7-network-layer-ip","title":"7. Network Layer: IP","text":"<p>IPv4: - Unicast: Point-to-point - Multicast: 224.0.0.0 - 239.255.255.255</p> <p>IPv6: - Unicast: Point-to-point - Multicast: ff00::/8</p> <p>Multicast routing: - IGMP (IPv4) or MLD (IPv6) - Router configuration required - Efficient for one-to-many transmission</p>"},{"location":"architecture/edi-protocol/#complete-example","title":"Complete Example","text":""},{"location":"architecture/edi-protocol/#sending-eti-over-edi-with-pft","title":"Sending ETI over EDI with PFT","text":"<pre><code># 1. Start with ETI frame\neti_frame = generate_eti_frame()  # 5604 bytes\n\n# 2. Create TAG items\nptr_tag = create_ptr_tag()           # 12 bytes\ndeti_tag = create_deti_tag(eti_frame)  # 5612 bytes\nest0_tag = create_est_tag(0, stream0_data)  # Variable\n\n# 3. Create TAG packet (8-byte aligned)\ntags = [ptr_tag, deti_tag, est0_tag]\ntag_packet = create_tag_packet(tags)  # ~6000 bytes\n\n# 4. Create AF packet\naf_packet = create_af_packet(tag_packet, seq=123)  # ~6014 bytes\n\n# 5. Fragment with PFT (if needed)\nif enable_pft:\n    fragments = fragment_af_packet(\n        af_packet,\n        max_frag_size=1400,\n        fec_enabled=True,\n        fec_m=2\n    )  # 7 fragments (5 data + 2 parity)\n\n    # 6. Send each fragment over UDP\n    for frag in fragments:\n        sock.sendto(frag, (dest_ip, dest_port))\nelse:\n    # Send AF packet directly (if it fits)\n    sock.sendto(af_packet, (dest_ip, dest_port))\n</code></pre>"},{"location":"architecture/edi-protocol/#bandwidth-calculation","title":"Bandwidth Calculation","text":""},{"location":"architecture/edi-protocol/#without-pft","title":"Without PFT","text":"<pre><code>ETI frame:    5604 bytes\nTAG overhead: ~50 bytes (headers)\nAF overhead:  14 bytes (header + CRC)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTotal:        ~5668 bytes per frame\n\nMode I: 10.42 frames/second\nBandwidth: 5668 \u00d7 10.42 = 59 KB/s \u2248 472 kbps\n</code></pre>"},{"location":"architecture/edi-protocol/#with-pft-5-data-2-parity-fragments","title":"With PFT (5 data + 2 parity fragments)","text":"<pre><code>AF packet:    5668 bytes\nFragmented:   5 \u00d7 1400 = 7000 bytes (padded)\nPFT overhead: 7 \u00d7 16 = 112 bytes (headers)\nRS parity:    2 \u00d7 1400 = 2800 bytes\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTotal:        9912 bytes per frame\n\nMode I: 10.42 frames/second\nBandwidth: 9912 \u00d7 10.42 = 103 KB/s \u2248 824 kbps\n</code></pre>"},{"location":"architecture/edi-protocol/#see-also","title":"See Also","text":"<ul> <li>System Design: Overall architecture</li> <li>Data Flow: EDI output in pipeline</li> <li>PFT Fragmentation: User guide for PFT</li> <li>Reed-Solomon FEC: FEC mathematics</li> </ul>"},{"location":"architecture/eti-frames/","title":"ETI Frame Structure","text":"<p>Detailed byte-level layout of ETI (Ensemble Transport Interface) frames.</p>"},{"location":"architecture/eti-frames/#frame-layout-diagram","title":"Frame Layout Diagram","text":"<pre><code>graph TD\n    subgraph \"ETI Frame Structure\"\n        SYNC[\"SYNC (4 bytes)ERR + FSYNC\"]\n        FC[\"FC (4 bytes)Frame Characterization\"]\n        STC[\"STC (4\u00d7N bytes)Stream Characterization(N = subchannels)\"]\n        EOH[\"EOH (4 bytes)End of Header + CRC\"]\n        FIC[\"FIC (96 bytes Mode I)Fast Information Channel(32 FIBs \u00d7 3 bytes)\"]\n        MST[\"MST (variable)Main Service Transport(Audio/Data)\"]\n        EOF[\"EOF (4 bytes)End of Frame + CRC\"]\n        TIST[\"TIST (4 bytes, optional)Time Stamp\"]\n    end\n\n    SYNC --&gt; FC\n    FC --&gt; STC\n    STC --&gt; EOH\n    EOH --&gt; FIC\n    FIC --&gt; MST\n    MST --&gt; EOF\n    EOF --&gt; TIST\n\n    style SYNC fill:#ffcccc\n    style FC fill:#ccffcc\n    style STC fill:#ccccff\n    style EOH fill:#ffffcc\n    style FIC fill:#ffccff\n    style MST fill:#ccffff\n    style EOF fill:#ffdddd\n    style TIST fill:#ddffdd\n</code></pre>"},{"location":"architecture/eti-frames/#complete-frame-structure","title":"Complete Frame Structure","text":"<p>Total size: Variable, typically ~6000 bytes for Mode I</p> <pre><code>Byte Offset | Field | Size | Description\n------------|-------|------|-------------\n0           | SYNC  | 4    | Synchronization\n4           | FC    | 4    | Frame Characterization\n8           | STC   | 4\u00d7N  | Sub-channel Stream Characterization (N channels)\n8+4N        | EOH   | 4    | End of Header (with CRC)\n12+4N       | FIC   | 96   | Fast Information Channel (Mode I)\n108+4N      | MST   | var  | Main Service Transport\n108+4N+M    | EOF   | 4    | End of Frame (with CRC)\n112+4N+M    | TIST  | 4    | Time Stamp (optional)\n</code></pre> <p>Where: - N = number of subchannels (0-64) - M = MST length in bytes (depends on subchannels and mode)</p>"},{"location":"architecture/eti-frames/#field-descriptions","title":"Field Descriptions","text":""},{"location":"architecture/eti-frames/#sync-4-bytes","title":"SYNC (4 bytes)","text":"<p>Purpose: Frame synchronization and error indication</p> <p>Structure: <pre><code>Byte 0: ERR (Error indicator)\nByte 1-3: FSYNC = 0x073AB6 (fixed sync pattern)\n</code></pre></p> <p>ERR byte bits: <pre><code>Bit 7: Frame synchronization error\nBit 6: FIC CRC error\nBit 5-0: Reserved (0)\n</code></pre></p> <p>Example: <pre><code>00 07 3A B6\n\u2502  \u2514\u2500\u2500\u2534\u2500\u2500\u2534\u2500 FSYNC (0x073AB6)\n\u2514\u2500 ERR = 0x00 (no errors)\n</code></pre></p>"},{"location":"architecture/eti-frames/#fc-frame-characterization-4-bytes","title":"FC (Frame Characterization, 4 bytes)","text":"<p>Purpose: Describes frame structure and timing</p> <p>Bit layout: <pre><code>Bits 31-24: FCT (Frame Count, 0-249)\nBits 23-22: FICF (FIC Flag, always 1 for DAB)\nBits 21-20: NST (Number of Streams, N-1)\nBits 19-17: FP (Frame Phase, 0-7)\nBits 16-14: MID (Mode Identity: 001=I, 010=II, 011=III, 100=IV)\nBits 13-11: FL (Frame Length in 24ms units)\nBits 10-0: Reserved\n</code></pre></p> <p>Example for Mode I, 2 subchannels: <pre><code>C8 14 00 00\n\u2502  \u2502  \u2514\u2500\u2500\u2534\u2500 Reserved\n\u2502  \u2514\u2500 NST=1 (2 streams), FP=0, MID=001 (Mode I)\n\u2514\u2500 FCT=200 (frame count)\n</code></pre></p> <p>Frame Count (FCT): - Increments from 0 to 249 - Wraps to 0 after 249 - Used for frame sequencing - Period: 250 frames = 24 seconds (Mode I)</p>"},{"location":"architecture/eti-frames/#stc-sub-channel-stream-characterization-4-bytes-each","title":"STC (Sub-channel Stream Characterization, 4 bytes each)","text":"<p>Purpose: Describes each subchannel's characteristics</p> <p>One STC per subchannel, in order of subchannel ID.</p> <p>Bit layout: <pre><code>Bits 31-26: SCID (Sub-Channel ID, 0-63)\nBits 25-16: SAD (Start Address in CUs)\nBits 15-14: TPL (Time Position Location, 00=MSC)\nBits 13-8: STL (Stream Length in units of 64 bits)\nBits 7-0: Reserved\n</code></pre></p> <p>Example: <pre><code>00 00 05 40\n\u2502  \u2502  \u2502  \u2514\u2500 Reserved\n\u2502  \u2502  \u2514\u2500 STL=5 (5\u00d764 bits = 320 bits = 40 bytes)\n\u2502  \u2514\u2500 SAD=0 (start address 0)\n\u2514\u2500 SCID=0 (subchannel 0)\n</code></pre></p> <p>Stream Length (STL): - In units of 64 bits (8 bytes) - <code>Length in bytes = STL \u00d7 8</code> - Includes all data for this subchannel in MST</p>"},{"location":"architecture/eti-frames/#eoh-end-of-header-4-bytes","title":"EOH (End of Header, 4 bytes)","text":"<p>Purpose: Marks end of header and provides CRC</p> <p>Structure: <pre><code>Bytes 0-1: CRC-16-CCITT of FC + all STCs\nBytes 2-3: Reserved (usually 0xFFFF)\n</code></pre></p> <p>CRC Calculation: <pre><code># CRC-16-CCITT (polynomial 0x1021, init 0xFFFF)\ncrc = crc16(fc_bytes + all_stc_bytes)\n</code></pre></p> <p>Example: <pre><code>E3 8F FF FF\n\u2502  \u2502  \u2514\u2500\u2500\u2534\u2500 Reserved\n\u2514\u2500\u2500\u2534\u2500 CRC = 0xE38F\n</code></pre></p>"},{"location":"architecture/eti-frames/#fic-fast-information-channel-96-bytes-for-mode-i","title":"FIC (Fast Information Channel, 96 bytes for Mode I)","text":"<p>Purpose: Carries FIG (Fast Information Group) metadata</p> <p>Structure: - 32 FIBs (Fast Information Blocks) of 3 bytes each - Each FIB can contain multiple FIGs - Ends with padding (0xFF) if FIGs don't fill all FIBs</p> <p>FIB Format: <pre><code>Byte 0-1: FIG data or 0xFFFF (padding)\nByte 2: CRC-8 of bytes 0-1\n</code></pre></p> <p>Example FIC (first 12 bytes): <pre><code>21 02 CE 15 00 E1 ... (FIG 0/0 data)\nC0 80 50 01 ...       (FIG 0/2 data)\n...\nFF FF 00              (Padding FIB)\n</code></pre></p> <p>FIG types commonly in FIC: - FIG 0/0: Ensemble information - FIG 0/1: Sub-channel organization - FIG 0/2: Service organization - FIG 1/0: Ensemble label - FIG 1/1: Service labels</p>"},{"location":"architecture/eti-frames/#mst-main-service-transport-variable-size","title":"MST (Main Service Transport, variable size)","text":"<p>Purpose: Carries audio/data for all subchannels</p> <p>Structure: - Concatenated audio/data streams - Each stream occupies <code>STL \u00d7 8</code> bytes - Streams in order of subchannel ID</p> <p>Example with 2 subchannels: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Subchannel 0 data       \u2502 (STL\u2080 \u00d7 8 bytes)\n\u2502 (MPEG audio frames)     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Subchannel 1 data       \u2502 (STL\u2081 \u00d7 8 bytes)\n\u2502 (MPEG audio frames)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Mode I MST size: - 864 Capacity Units available - 1 CU = 8 bits (in Mode I) - Total: 864 bytes raw capacity - Actual size depends on subchannel bitrates and protection</p> <p>Data alignment: - Each subchannel's data is byte-aligned - No padding between subchannels</p>"},{"location":"architecture/eti-frames/#eof-end-of-frame-4-bytes","title":"EOF (End of Frame, 4 bytes)","text":"<p>Purpose: Marks end of frame and provides CRC</p> <p>Structure: <pre><code>Bytes 0-1: CRC-16-CCITT of MST\nBytes 2-3: Reserved (usually 0xFFFF)\n</code></pre></p> <p>CRC Calculation: <pre><code># CRC-16-CCITT of entire MST\ncrc = crc16(mst_bytes)\n</code></pre></p> <p>Example: <pre><code>7A 2B FF FF\n\u2502  \u2502  \u2514\u2500\u2500\u2534\u2500 Reserved\n\u2514\u2500\u2500\u2534\u2500 CRC = 0x7A2B\n</code></pre></p>"},{"location":"architecture/eti-frames/#tist-time-stamp-4-bytes-optional","title":"TIST (Time Stamp, 4 bytes, optional)","text":"<p>Purpose: Provides precise frame timing for synchronized transmission</p> <p>Structure: <pre><code>32-bit unsigned integer\nMilliseconds since EDI epoch (2000-01-01 00:00:00 UTC)\n</code></pre></p> <p>Calculation: <pre><code>edi_epoch = datetime(2000, 1, 1, 0, 0, 0, tzinfo=timezone.utc)\nnow = datetime.now(timezone.utc)\ntist_ms = int((now - edi_epoch).total_seconds() * 1000)\n</code></pre></p> <p>Example: <pre><code>5A 3C 1F 80\n\u2514\u2500\u2500\u2534\u2500\u2500\u2534\u2500\u2500\u2534\u2500 TIST = 0x5A3C1F80 (1514135424 ms)\n           = ~48 years after 2000\n           = ~2048-01-01\n</code></pre></p> <p>Use cases: - Single Frequency Networks (SFN) synchronization - Timed playout - Multi-transmitter coordination</p>"},{"location":"architecture/eti-frames/#frame-size-calculation","title":"Frame Size Calculation","text":""},{"location":"architecture/eti-frames/#mode-i-frame-size","title":"Mode I Frame Size","text":"<p>Formula: <pre><code>Size = 12 + 4\u00d7N + 96 + MST_size + 4 + (4 if TIST)\n\nWhere:\n  N = number of subchannels\n  MST_size = sum of (STL \u00d7 8) for all subchannels\n</code></pre></p> <p>Example with 3 subchannels (128 kbps each, protection level 2): <pre><code>SYNC:  4 bytes\nFC:    4 bytes\nSTC:   12 bytes (3 \u00d7 4)\nEOH:   4 bytes\nFIC:   96 bytes\nMST:   5472 bytes (calculated from bitrates)\nEOF:   4 bytes\nTIST:  4 bytes (optional)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTotal: 5600 bytes (without TIST)\n       5604 bytes (with TIST)\n</code></pre></p>"},{"location":"architecture/eti-frames/#mst-size-calculation","title":"MST Size Calculation","text":"<p>For Mode I:</p> <ol> <li>Calculate required bitrate including protection overhead</li> <li>Convert to Capacity Units (CUs)</li> <li>Convert CUs to bytes: <code>bytes = CUs</code> (in Mode I, 1 CU = 8 bits)</li> </ol> <p>Protection overhead: - Depends on protection level and form (short/long) - Higher protection = more CUs needed</p>"},{"location":"architecture/eti-frames/#hexdump-example","title":"Hexdump Example","text":"<p>Minimal Mode I frame (1 subchannel, 128 kbps):</p> <pre><code>Offset   Hex                                          ASCII\n000000   00 07 3a b6 c8 14 00 00 00 00 05 40 e3 8f   ..:.........@..\n         \u2514\u2500SYNC\u2500\u2518 \u2514\u2500\u2500\u2500FC\u2500\u2500\u2518 \u2514\u2500\u2500\u2500STC\u2500\u2500\u2518 \u2514\u2500\u2500EOH\u2500\u2518\n\n000010   ff ff 21 02 ce 15 00 e1 c0 80 50 01 00 00   ..!.......P...\n         \u2514FIC (96 bytes)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500...\n\n000070   ...                                          ...\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n0015b0   [MST data continues]                         ...\n\n0015c0   7a 2b ff ff 5a 3c 1f 80                      z+..Z&lt;..\n         \u2514\u2500\u2500EOF\u2500\u2500\u2518 \u2514\u2500\u2500TIST\u2500\u2518\n</code></pre>"},{"location":"architecture/eti-frames/#crc-polynomials","title":"CRC Polynomials","text":""},{"location":"architecture/eti-frames/#crc-16-ccitt","title":"CRC-16-CCITT","text":"<p>Used for: EOH, EOF</p> <p>Polynomial: <code>0x1021</code> Initial value: <code>0xFFFF</code> Final XOR: <code>0xFFFF</code></p> <pre><code>def crc16(data: bytes) -&gt; int:\n    crc = 0xFFFF\n    for byte in data:\n        crc ^= (byte &lt;&lt; 8)\n        for _ in range(8):\n            if crc &amp; 0x8000:\n                crc = (crc &lt;&lt; 1) ^ 0x1021\n            else:\n                crc = crc &lt;&lt; 1\n            crc &amp;= 0xFFFF\n    return crc ^ 0xFFFF\n</code></pre>"},{"location":"architecture/eti-frames/#crc-8","title":"CRC-8","text":"<p>Used for: FIB checksums in FIC</p> <p>Polynomial: <code>0x1D</code> Initial value: <code>0xFF</code> Final XOR: <code>0x00</code></p> <pre><code>def crc8(data: bytes) -&gt; int:\n    crc = 0xFF\n    for byte in data:\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = (crc &lt;&lt; 1) ^ 0x1D\n            else:\n                crc = crc &lt;&lt; 1\n            crc &amp;= 0xFF\n    return crc\n</code></pre>"},{"location":"architecture/eti-frames/#frame-timing","title":"Frame Timing","text":""},{"location":"architecture/eti-frames/#mode-i","title":"Mode I","text":"<ul> <li>Frame duration: 96 ms</li> <li>Frame rate: 10.41667 frames/second</li> <li>FCT period: 250 frames = 24 seconds</li> </ul>"},{"location":"architecture/eti-frames/#other-modes","title":"Other Modes","text":"Mode Duration Rate (fps) FCT Period I 96 ms 10.42 24 s II 24 ms 41.67 6 s III 24 ms 41.67 6 s IV 48 ms 20.83 12 s"},{"location":"architecture/eti-frames/#validation","title":"Validation","text":""},{"location":"architecture/eti-frames/#sanity-checks","title":"Sanity Checks","text":"<ol> <li>SYNC pattern: Must be <code>0x073AB6</code></li> <li>FCT range: 0-249</li> <li>MID validity: 001, 010, 011, or 100</li> <li>NST consistency: Must match number of STCs</li> <li>CRC validity: EOH and EOF CRCs must be correct</li> <li>FIC size: Must be 96 bytes for Mode I</li> <li>MST size: Must match sum of STL values</li> </ol>"},{"location":"architecture/eti-frames/#python-dabmux-validation","title":"python-dabmux Validation","text":"<pre><code>def validate_frame(frame: EtiFrame) -&gt; bool:\n    # Check sync\n    if frame.sync.fsync != 0x073AB6:\n        return False\n\n    # Check FCT range\n    if frame.fc.fct &gt; 249:\n        return False\n\n    # Validate CRCs\n    if not frame.validate_eoh_crc():\n        return False\n    if not frame.validate_eof_crc():\n        return False\n\n    return True\n</code></pre>"},{"location":"architecture/eti-frames/#see-also","title":"See Also","text":"<ul> <li>System Design: Overall architecture</li> <li>Data Flow: How frames are generated</li> <li>FIG Carousel: FIG generation for FIC</li> <li>ETSI EN 300 799: ETI specification</li> </ul>"},{"location":"architecture/fig-carousel/","title":"FIG Carousel Operation","text":"<p>How the FIG (Fast Information Group) carousel rotates through different FIG types based on their repetition rates.</p>"},{"location":"architecture/fig-carousel/#fig-carousel-sequence-diagram","title":"FIG Carousel Sequence Diagram","text":"<pre><code>sequenceDiagram\n    participant Mux as DabMultiplexer\n    participant FIC as FICEncoder\n    participant Car as Carousel\n    participant F00 as FIG 0/0\n    participant F01 as FIG 0/1\n    participant F02 as FIG 0/2\n    participant F10 as FIG 1/0\n    participant F11 as FIG 1/1\n\n    Note over Mux: Frame 1 (t=0ms)\n    Mux-&gt;&gt;FIC: encode_fic()\n    FIC-&gt;&gt;Car: get_figs()\n\n    Car-&gt;&gt;Car: Check timers\n    Note over Car: FIG 0/0: counter=0 \u2713FIG 0/1: counter=0 \u2713FIG 0/2: counter=0 \u2713\n\n    Car-&gt;&gt;F00: generate()\n    F00--&gt;&gt;Car: 8 bytes\n    Car-&gt;&gt;F01: generate()\n    F01--&gt;&gt;Car: 24 bytes\n    Car-&gt;&gt;F02: generate()\n    F02--&gt;&gt;Car: 16 bytes\n\n    Car-&gt;&gt;Car: Reset counters:0/0\u21921, 0/1\u219210, 0/2\u219210\n    Car--&gt;&gt;FIC: [FIG 0/0, 0/1, 0/2]\n    FIC--&gt;&gt;Mux: 96 bytes FIC\n\n    Note over Mux: Frame 2 (t=96ms)\n    Mux-&gt;&gt;FIC: encode_fic()\n    FIC-&gt;&gt;Car: get_figs()\n\n    Car-&gt;&gt;Car: Check timers\n    Note over Car: FIG 0/0: counter=0 \u2713FIG 0/1: counter=9FIG 1/0: counter=0 \u2713\n\n    Car-&gt;&gt;F00: generate()\n    F00--&gt;&gt;Car: 8 bytes\n    Car-&gt;&gt;F10: generate()\n    F10--&gt;&gt;Car: 20 bytes\n\n    Car-&gt;&gt;Car: Reset counters:0/0\u21921, 1/0\u219210\n    Car--&gt;&gt;FIC: [FIG 0/0, 1/0]\n    FIC--&gt;&gt;Mux: 96 bytes FIC\n\n    Note over Mux: Frame 3 (t=192ms)\n    Mux-&gt;&gt;FIC: encode_fic()\n    FIC-&gt;&gt;Car: get_figs()\n\n    Car-&gt;&gt;Car: Check timers\n    Note over Car: FIG 0/0: counter=0 \u2713FIG 1/1: counter=0 \u2713\n\n    Car-&gt;&gt;F00: generate()\n    F00--&gt;&gt;Car: 8 bytes\n    Car-&gt;&gt;F11: generate()\n    F11--&gt;&gt;Car: 18 bytes\n\n    Car--&gt;&gt;FIC: [FIG 0/0, 1/1]\n    FIC--&gt;&gt;Mux: 96 bytes FIC\n</code></pre>"},{"location":"architecture/fig-carousel/#fig-carousel-timing-diagram","title":"FIG Carousel Timing Diagram","text":"<pre><code>gantt\n    title FIG Repetition Schedule\n    dateFormat X\n    axisFormat %L ms\n\n    section FIG 0/0\n    Frame 1   :0, 96\n    Frame 2   :96, 96\n    Frame 3   :192, 96\n    Frame 4   :288, 96\n    Frame 5   :384, 96\n\n    section FIG 0/1\n    Frame 1   :0, 96\n    Frame 11  :960, 96\n    Frame 21  :1920, 96\n\n    section FIG 0/2\n    Frame 1   :0, 96\n    Frame 11  :960, 96\n    Frame 21  :1920, 96\n\n    section FIG 1/0\n    Frame 2   :96, 96\n    Frame 12  :1056, 96\n    Frame 22  :2016, 96\n\n    section FIG 1/1\n    Frame 3   :192, 96\n    Frame 13  :1152, 96\n    Frame 23  :2112, 96\n</code></pre>"},{"location":"architecture/fig-carousel/#overview","title":"Overview","text":"<p>The FIG Carousel is a scheduling system that determines which FIGs (Fast Information Groups) are included in each frame. Different FIG types have different repetition rates based on their importance and how often receivers need to see them.</p> <p>Key concepts:</p> <ul> <li>FIG Priority: Critical FIGs repeat more frequently</li> <li>Timers: Each FIG has a countdown timer</li> <li>Buffer Management: FIGs must fit in 96-byte FIC</li> <li>Round-Robin: FIGs rotate in a predictable pattern</li> </ul>"},{"location":"architecture/fig-carousel/#fig-types-and-repetition-rates","title":"FIG Types and Repetition Rates","text":""},{"location":"architecture/fig-carousel/#high-priority-every-frame","title":"High Priority (Every Frame)","text":"<p>FIG 0/0 - Ensemble Information</p> <ul> <li>Repetition: 96 ms (every 1 frame in Mode I)</li> <li>Purpose: Ensemble ID, country code, alarm flag</li> <li>Size: 6-8 bytes</li> <li>Why frequent: Receivers need this to identify the ensemble immediately</li> </ul> <p>Example: <pre><code>class Fig0_0:\n    def __init__(self):\n        self.repetition_ms = 96  # Every frame\n        self.counter = 1\n</code></pre></p>"},{"location":"architecture/fig-carousel/#medium-priority-every-1-second","title":"Medium Priority (Every ~1 Second)","text":"<p>FIG 0/1 - Sub-channel Organization</p> <ul> <li>Repetition: ~1 second (~10 frames in Mode I)</li> <li>Purpose: Subchannel IDs, start addresses, sizes</li> <li>Size: 4 bytes per subchannel + header</li> <li>Why frequent: Needed to find audio data in MST</li> </ul> <p>FIG 0/2 - Service Organization</p> <ul> <li>Repetition: ~1 second (~10 frames)</li> <li>Purpose: Links services to components</li> <li>Size: 3-4 bytes per service + header</li> <li>Why frequent: Needed to map service names to audio</li> </ul> <p>FIG 1/0 - Ensemble Label</p> <ul> <li>Repetition: ~1 second (~10 frames)</li> <li>Purpose: Ensemble name (text label)</li> <li>Size: 16-20 bytes</li> <li>Why frequent: Displayed prominently on receivers</li> </ul> <p>FIG 1/1 - Service Labels</p> <ul> <li>Repetition: ~1 second (~10 frames)</li> <li>Purpose: Service names (station labels)</li> <li>Size: 16-20 bytes per service</li> <li>Why frequent: Displayed in station lists</li> </ul>"},{"location":"architecture/fig-carousel/#low-priority-every-10-seconds","title":"Low Priority (Every 10+ Seconds)","text":"<p>FIG 0/5 - Service Component Language</p> <ul> <li>Repetition: 10 seconds (~100 frames)</li> <li>Purpose: Language codes for components</li> <li>Size: 2-3 bytes per component</li> </ul> <p>FIG 0/8 - Service Component Global Definition</p> <ul> <li>Repetition: 10 seconds</li> <li>Purpose: Global service IDs</li> <li>Size: Variable</li> </ul> <p>FIG 0/13 - User Application Information</p> <ul> <li>Repetition: 10 seconds</li> <li>Purpose: EPG, slideshow, etc.</li> <li>Size: Variable</li> </ul> <p>FIG 0/17 - Programme Type</p> <ul> <li>Repetition: 10 seconds</li> <li>Purpose: Programme type codes</li> <li>Size: 2-3 bytes per service</li> </ul>"},{"location":"architecture/fig-carousel/#carousel-algorithm","title":"Carousel Algorithm","text":""},{"location":"architecture/fig-carousel/#initialization","title":"Initialization","text":"<pre><code>class FigCarousel:\n    def __init__(self, ensemble: DabEnsemble):\n        self.ensemble = ensemble\n        self.fig_generators = {\n            '0/0': Fig0_0(ensemble),\n            '0/1': Fig0_1(ensemble),\n            '0/2': Fig0_2(ensemble),\n            '1/0': Fig1_0(ensemble),\n            '1/1': Fig1_1(ensemble),\n            # ... more FIG types\n        }\n\n        # Initialize counters (in frames)\n        self.counters = {\n            '0/0': 1,    # Every frame\n            '0/1': 10,   # Every ~1 second\n            '0/2': 10,\n            '1/0': 10,\n            '1/1': 10,\n            '0/5': 100,  # Every ~10 seconds\n            '0/8': 100,\n            '0/13': 100,\n            '0/17': 100,\n        }\n</code></pre>"},{"location":"architecture/fig-carousel/#frame-by-frame-operation","title":"Frame-by-Frame Operation","text":"<pre><code>def get_figs_for_frame(self) -&gt; List[bytes]:\n    \"\"\"\n    Get FIGs to include in this frame.\n\n    Returns:\n        List of FIG byte arrays\n    \"\"\"\n    figs = []\n    total_size = 0\n    max_size = 90  # Leave room for padding and CRC\n\n    # Priority order\n    fig_order = ['0/0', '0/1', '0/2', '1/0', '1/1', '0/5', '0/8', '0/13', '0/17']\n\n    for fig_type in fig_order:\n        # Check if this FIG should be included\n        if self.counters[fig_type] &lt;= 0:\n            # Generate FIG\n            fig_data = self.fig_generators[fig_type].generate()\n\n            # Check if it fits\n            if total_size + len(fig_data) &lt;= max_size:\n                figs.append(fig_data)\n                total_size += len(fig_data)\n\n                # Reset counter based on repetition rate\n                self.counters[fig_type] = self._get_repetition(fig_type)\n            else:\n                # Doesn't fit, defer to next frame\n                break\n        else:\n            # Not yet time for this FIG\n            pass\n\n    # Decrement all counters\n    for fig_type in self.counters:\n        self.counters[fig_type] -= 1\n\n    return figs\n</code></pre>"},{"location":"architecture/fig-carousel/#repetition-rate-calculation","title":"Repetition Rate Calculation","text":"<pre><code>def _get_repetition(self, fig_type: str) -&gt; int:\n    \"\"\"\n    Get repetition interval in frames.\n\n    For Mode I: 96ms per frame, so:\n    - Every frame = 1\n    - Every ~1 second = 10 frames\n    - Every ~10 seconds = 100 frames\n    \"\"\"\n    repetition_map = {\n        '0/0': 1,     # 96 ms\n        '0/1': 10,    # ~960 ms\n        '0/2': 10,\n        '1/0': 10,\n        '1/1': 10,\n        '0/5': 100,   # ~9.6 seconds\n        '0/8': 100,\n        '0/13': 100,\n        '0/17': 100,\n    }\n    return repetition_map.get(fig_type, 10)\n</code></pre>"},{"location":"architecture/fig-carousel/#fic-encoding","title":"FIC Encoding","text":""},{"location":"architecture/fig-carousel/#fib-structure","title":"FIB Structure","text":"<p>The FIC (Fast Information Channel) is encoded as 32 FIBs (Fast Information Blocks):</p> <pre><code>FIB = Fast Information Block (3 bytes)\n  Byte 0-1: Data (or 0xFFFF for padding)\n  Byte 2: CRC-8 of bytes 0-1\n</code></pre> <p>Total FIC size: 32 FIBs \u00d7 3 bytes = 96 bytes</p>"},{"location":"architecture/fig-carousel/#encoding-process","title":"Encoding Process","text":"<pre><code>def encode_fic(self, figs: List[bytes]) -&gt; bytes:\n    \"\"\"\n    Encode FIGs into 96-byte FIC.\n\n    Args:\n        figs: List of FIG byte arrays\n\n    Returns:\n        96-byte FIC data\n    \"\"\"\n    fic_buffer = bytearray(96)\n    pos = 0\n\n    # Pack FIGs into FIBs\n    for fig in figs:\n        # Each FIG goes into FIBs\n        fig_len = len(fig)\n\n        for i in range(0, fig_len, 2):\n            if pos &gt;= 96:\n                break  # FIC full\n\n            # Get 2 bytes of data\n            if i + 1 &lt; fig_len:\n                data = fig[i:i+2]\n            else:\n                # Last byte, pad with 0xFF\n                data = fig[i:i+1] + b'\\xFF'\n\n            # Calculate CRC-8\n            crc = self.calculate_crc8(data)\n\n            # Write FIB\n            fic_buffer[pos:pos+2] = data\n            fic_buffer[pos+2] = crc\n            pos += 3\n\n    # Pad remaining FIBs\n    while pos &lt; 96:\n        fic_buffer[pos:pos+2] = b'\\xFF\\xFF'\n        fic_buffer[pos+2] = self.calculate_crc8(b'\\xFF\\xFF')\n        pos += 3\n\n    return bytes(fic_buffer)\n</code></pre>"},{"location":"architecture/fig-carousel/#crc-8-calculation","title":"CRC-8 Calculation","text":"<pre><code>def calculate_crc8(self, data: bytes) -&gt; int:\n    \"\"\"\n    Calculate CRC-8 for FIB.\n\n    Polynomial: 0x1D (x^8 + x^4 + x^3 + x^2 + 1)\n    Initial: 0xFF\n    Final XOR: 0x00\n    \"\"\"\n    crc = 0xFF\n    for byte in data:\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = (crc &lt;&lt; 1) ^ 0x1D\n            else:\n                crc = crc &lt;&lt; 1\n            crc &amp;= 0xFF\n    return crc\n</code></pre>"},{"location":"architecture/fig-carousel/#example-frame-sequences","title":"Example Frame Sequences","text":""},{"location":"architecture/fig-carousel/#frame-1-t0ms","title":"Frame 1 (t=0ms)","text":"<p>Counters: - FIG 0/0: 0 \u2713 (include) - FIG 0/1: 0 \u2713 (include) - FIG 0/2: 0 \u2713 (include) - FIG 1/0: 5 - FIG 1/1: 7</p> <p>FIGs included: - FIG 0/0: 8 bytes (Ensemble info) - FIG 0/1: 24 bytes (3 subchannels) - FIG 0/2: 16 bytes (3 services)</p> <p>Total: 48 bytes (fits easily in 90-byte limit)</p> <p>Counter reset: - FIG 0/0: 1 - FIG 0/1: 10 - FIG 0/2: 10</p>"},{"location":"architecture/fig-carousel/#frame-2-t96ms","title":"Frame 2 (t=96ms)","text":"<p>Counters: - FIG 0/0: 0 \u2713 (include) - FIG 0/1: 9 - FIG 0/2: 9 - FIG 1/0: 4 - FIG 1/1: 6</p> <p>FIGs included: - FIG 0/0: 8 bytes</p> <p>Total: 8 bytes</p> <p>Counter reset: - FIG 0/0: 1</p>"},{"location":"architecture/fig-carousel/#frame-10-t864ms","title":"Frame 10 (t=864ms)","text":"<p>Counters: - FIG 0/0: 0 \u2713 (include) - FIG 0/1: 1 - FIG 0/2: 1 - FIG 1/0: 0 \u2713 (include) - FIG 1/1: 0 \u2713 (include)</p> <p>FIGs included: - FIG 0/0: 8 bytes - FIG 1/0: 20 bytes (Ensemble label) - FIG 1/1: 60 bytes (3 service labels)</p> <p>Total: 88 bytes (fits in 90-byte limit)</p> <p>Counter reset: - FIG 0/0: 1 - FIG 1/0: 10 - FIG 1/1: 10</p>"},{"location":"architecture/fig-carousel/#buffer-management","title":"Buffer Management","text":""},{"location":"architecture/fig-carousel/#size-constraints","title":"Size Constraints","text":"<p>FIC capacity: 96 bytes total</p> <p>Usable for FIGs: - 32 FIBs \u00d7 3 bytes = 96 bytes - CRC overhead: 1 byte per FIB = 32 bytes - Net data capacity: ~90 bytes per frame</p>"},{"location":"architecture/fig-carousel/#priority-handling","title":"Priority Handling","text":"<p>When FIGs don't fit:</p> <ol> <li>Always include FIG 0/0 (8 bytes, critical)</li> <li>Add other FIGs by priority until buffer full</li> <li>Defer low-priority FIGs to next frame</li> <li>Never split a FIG across frames</li> </ol> <p>Example overflow: <pre><code># Frame has 90 bytes available\n# FIG 0/0: 8 bytes (included, 82 left)\n# FIG 0/1: 24 bytes (included, 58 left)\n# FIG 0/2: 16 bytes (included, 42 left)\n# FIG 1/1: 60 bytes (doesn't fit, defer)\n</code></pre></p>"},{"location":"architecture/fig-carousel/#padding","title":"Padding","text":"<p>If FIGs don't fill FIC:</p> <pre><code># FIGs total: 48 bytes\n# FIC size: 96 bytes\n# Padding needed: 48 bytes\n\n# Fill with 0xFFFF FIBs:\nwhile pos &lt; 96:\n    fib = b'\\xFF\\xFF' + crc8(b'\\xFF\\xFF')\n    fic_buffer[pos:pos+3] = fib\n    pos += 3\n</code></pre>"},{"location":"architecture/fig-carousel/#performance-optimization","title":"Performance Optimization","text":""},{"location":"architecture/fig-carousel/#caching","title":"Caching","text":"<p>Problem: Many FIGs don't change frame-to-frame</p> <p>Solution: Cache generated FIG bytes</p> <pre><code>class FigCarousel:\n    def __init__(self):\n        self.fig_cache = {}\n        self.cache_valid = {}\n\n    def get_fig(self, fig_type: str) -&gt; bytes:\n        # Check cache\n        if self.cache_valid.get(fig_type, False):\n            return self.fig_cache[fig_type]\n\n        # Generate and cache\n        fig_data = self.fig_generators[fig_type].generate()\n        self.fig_cache[fig_type] = fig_data\n        self.cache_valid[fig_type] = True\n\n        return fig_data\n\n    def invalidate_cache(self, fig_type: str):\n        \"\"\"Invalidate cache when ensemble config changes\"\"\"\n        self.cache_valid[fig_type] = False\n</code></pre> <p>Cache invalidation: - Service added/removed \u2192 Invalidate FIG 0/2, 1/1 - Subchannel changed \u2192 Invalidate FIG 0/1 - Label changed \u2192 Invalidate FIG 1/0 or 1/1</p>"},{"location":"architecture/fig-carousel/#pre-computation","title":"Pre-computation","text":"<p>Pre-compute static FIGs at startup:</p> <pre><code>class FigCarousel:\n    def __init__(self, ensemble: DabEnsemble):\n        # Generate all FIGs once\n        self._precompute_figs()\n\n    def _precompute_figs(self):\n        for fig_type in self.fig_generators:\n            self.get_fig(fig_type)  # Populate cache\n</code></pre>"},{"location":"architecture/fig-carousel/#debugging","title":"Debugging","text":""},{"location":"architecture/fig-carousel/#fig-carousel-state","title":"FIG Carousel State","text":"<pre><code>def debug_state(self) -&gt; str:\n    \"\"\"Print carousel state for debugging\"\"\"\n    lines = [\"FIG Carousel State:\"]\n    for fig_type, counter in self.counters.items():\n        status = \"DUE\" if counter &lt;= 0 else f\"in {counter} frames\"\n        lines.append(f\"  {fig_type}: {status}\")\n    return \"\\n\".join(lines)\n</code></pre> <p>Example output: <pre><code>FIG Carousel State:\n  0/0: DUE\n  0/1: in 5 frames\n  0/2: in 5 frames\n  1/0: in 2 frames\n  1/1: in 8 frames\n  0/5: in 87 frames\n</code></pre></p>"},{"location":"architecture/fig-carousel/#fig-content-inspection","title":"FIG Content Inspection","text":"<pre><code>def inspect_fig(self, fig_data: bytes) -&gt; str:\n    \"\"\"Inspect FIG contents\"\"\"\n    fig_type = (fig_data[0] &gt;&gt; 5) &amp; 0x07\n    extension = fig_data[0] &amp; 0x1F\n\n    return f\"FIG {fig_type}/{extension}: {len(fig_data)} bytes\"\n</code></pre>"},{"location":"architecture/fig-carousel/#see-also","title":"See Also","text":"<ul> <li>System Design: Overall architecture</li> <li>ETI Frames: Where FIC fits in frames</li> <li>Data Flow: FIG generation in pipeline</li> <li>FIG Types: Complete FIG specifications</li> </ul>"},{"location":"architecture/system-design/","title":"System Design","text":"<p>High-level architecture of python-dabmux showing module structure and data flow.</p>"},{"location":"architecture/system-design/#architecture-diagram","title":"Architecture Diagram","text":"<pre><code>graph TB\n    subgraph \"Configuration Layer\"\n        YAML[YAML Config File]\n        Parser[ConfigParser]\n        Ensemble[DabEnsemble]\n    end\n\n    subgraph \"Input Layer\"\n        FileInput[FileInputMPEG/Raw]\n        UDPInput[UDPInputNetwork]\n        TCPInput[TCPInputNetwork]\n        InputBase[InputBaseAbstract]\n    end\n\n    subgraph \"Core Layer\"\n        Mux[DabMultiplexer]\n        FICEnc[FICEncoder]\n        Carousel[FIG Carousel]\n        FIG0[FIG Type 0Ensemble Info]\n        FIG1[FIG Type 1Labels]\n        ETI[ETI FrameStructures]\n    end\n\n    subgraph \"Output Layer\"\n        FileOut[FileOutputETI Files]\n        EDIOut[EdiOutputNetwork]\n        EDIEnc[EdiEncoderTAG Items]\n        PFT[PFT LayerFragmentation+FEC]\n    end\n\n    subgraph \"Utilities\"\n        CRC[CRC Utils]\n        Charset[Character Set]\n        Audio[Audio Parsing]\n        FEC[Reed-Solomon FEC]\n    end\n\n    YAML --&gt; Parser\n    Parser --&gt; Ensemble\n    Ensemble --&gt; Mux\n\n    FileInput --&gt; InputBase\n    UDPInput --&gt; InputBase\n    TCPInput --&gt; InputBase\n    InputBase --&gt; Mux\n\n    Mux --&gt; FICEnc\n    FICEnc --&gt; Carousel\n    Carousel --&gt; FIG0\n    Carousel --&gt; FIG1\n    FIG0 --&gt; FICEnc\n    FIG1 --&gt; FICEnc\n\n    Mux --&gt; ETI\n    ETI --&gt; FileOut\n    ETI --&gt; EDIEnc\n    EDIEnc --&gt; EDIOut\n    EDIOut --&gt; PFT\n\n    CRC --&gt; ETI\n    Charset --&gt; FIG1\n    Audio --&gt; Mux\n    FEC --&gt; PFT\n\n    style Mux fill:#f9f,stroke:#333,stroke-width:3px\n    style FICEnc fill:#bbf,stroke:#333,stroke-width:2px\n    style ETI fill:#bfb,stroke:#333,stroke-width:2px\n</code></pre>"},{"location":"architecture/system-design/#layer-descriptions","title":"Layer Descriptions","text":""},{"location":"architecture/system-design/#configuration-layer","title":"Configuration Layer","text":"<p>Purpose: Parse YAML configuration and create ensemble structure</p> <p>Components:</p> <ul> <li>ConfigParser: Reads YAML files and creates DabEnsemble</li> <li>DabEnsemble: Container for all ensemble data (services, subchannels, components)</li> </ul> <p>Data Flow: <pre><code>YAML file \u2192 ConfigParser \u2192 DabEnsemble \u2192 DabMultiplexer\n</code></pre></p> <p>Key Responsibilities:</p> <ul> <li>YAML parsing and validation</li> <li>ID type conversion (hex strings to integers)</li> <li>Label validation</li> <li>Ensemble structure creation</li> </ul>"},{"location":"architecture/system-design/#input-layer","title":"Input Layer","text":"<p>Purpose: Abstract audio input sources (files and network)</p> <p>Components:</p> <ul> <li>InputBase: Abstract base class defining input interface</li> <li>FileInput: Read MPEG Layer II files</li> <li>UDPInput: Receive audio over UDP (unicast/multicast)</li> <li>TCPInput: Receive audio over TCP</li> </ul> <p>Data Flow: <pre><code>Audio Source \u2192 Input Class \u2192 Buffer \u2192 DabMultiplexer\n</code></pre></p> <p>Key Responsibilities:</p> <ul> <li>Open/close input sources</li> <li>Read audio frames</li> <li>Buffer management</li> <li>Format validation</li> <li>Statistics tracking</li> </ul> <p>Interface: <pre><code>class InputBase(ABC):\n    def open(self) -&gt; None: ...\n    def read(self, size: int) -&gt; bytes: ...\n    def close(self) -&gt; None: ...\n    def get_stats(self) -&gt; Dict: ...\n</code></pre></p>"},{"location":"architecture/system-design/#core-layer","title":"Core Layer","text":"<p>Purpose: Multiplex audio streams and generate FIG metadata</p> <p>Components:</p> <ul> <li>DabMultiplexer: Main orchestrator, generates ETI frames</li> <li>FICEncoder: Encodes Fast Information Channel</li> <li>FIG Carousel: Schedules FIG repetition</li> <li>FIG Type 0: Ensemble information FIGs</li> <li>FIG Type 1: Label FIGs</li> <li>ETI Structures: Frame data structures</li> </ul> <p>Data Flow: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 DabMultiplexer  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1. Read inputs  \u2502\n\u2502 2. Generate FIGs\u2502\n\u2502 3. Encode FIC   \u2502\n\u2502 4. Populate MST \u2502\n\u2502 5. Calculate CRC\u2502\n\u2502 6. Pack frame   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Key Responsibilities:</p> <ul> <li>Frame timing and sequencing</li> <li>FIG generation and carousel management</li> <li>Audio data multiplexing</li> <li>CRC calculation</li> <li>Frame assembly</li> </ul> <p>Main Algorithm: <pre><code>def generate_frame(self) -&gt; EtiFrame:\n    # 1. Read audio from all inputs\n    audio_data = self._read_inputs()\n\n    # 2. Generate FIGs for this frame\n    figs = self.carousel.get_figs_for_frame()\n\n    # 3. Encode FIC\n    fic_data = self.fic_encoder.encode(figs)\n\n    # 4. Create frame\n    frame = EtiFrame()\n    frame.fic = fic_data\n    frame.mst = audio_data\n\n    # 5. Calculate CRCs\n    frame.calculate_crcs()\n\n    return frame\n</code></pre></p>"},{"location":"architecture/system-design/#output-layer","title":"Output Layer","text":"<p>Purpose: Write ETI frames to files or send over network</p> <p>Components:</p> <ul> <li>FileOutput: Write ETI to files (raw/streamed/framed)</li> <li>EdiOutput: Send EDI over network (UDP/TCP)</li> <li>EdiEncoder: Convert ETI to EDI TAG items</li> <li>PFT Layer: Fragmentation and FEC for EDI</li> </ul> <p>Data Flow:</p> <p>File Output: <pre><code>ETI Frame \u2192 Serialize \u2192 FileOutput \u2192 File\n</code></pre></p> <p>EDI Output: <pre><code>ETI Frame \u2192 EdiEncoder \u2192 TAG Items \u2192 AF Packet \u2192 PFT \u2192 UDP/TCP\n</code></pre></p> <p>Key Responsibilities:</p> <ul> <li>ETI serialization</li> <li>File format handling (raw/streamed/framed)</li> <li>EDI protocol encoding</li> <li>PFT fragmentation and FEC</li> <li>Network transmission</li> </ul>"},{"location":"architecture/system-design/#utilities-layer","title":"Utilities Layer","text":"<p>Purpose: Shared utilities used by multiple components</p> <p>Components:</p> <ul> <li>CRC Utils: CRC-8, CRC-16-CCITT, CRC-32 calculations</li> <li>Character Set: UTF-8 \u2194 EBU Latin conversion</li> <li>Audio Parsing: MPEG frame parsing</li> <li>Reed-Solomon FEC: Galois Field arithmetic and encoding</li> </ul> <p>Usage:</p> <ul> <li>CRC: Used by ETI frames (EOH, EOF), EDI packets</li> <li>Character Set: Used by FIG 1 (labels)</li> <li>Audio Parsing: Used by input layer for frame detection</li> <li>Reed-Solomon: Used by PFT layer for error correction</li> </ul>"},{"location":"architecture/system-design/#module-interactions","title":"Module Interactions","text":""},{"location":"architecture/system-design/#initialization-sequence","title":"Initialization Sequence","text":"<pre><code>sequenceDiagram\n    participant CLI\n    participant ConfigParser\n    participant Ensemble\n    participant Multiplexer\n    participant Inputs\n    participant Outputs\n\n    CLI-&gt;&gt;ConfigParser: load_config(\"config.yaml\")\n    ConfigParser-&gt;&gt;Ensemble: Create DabEnsemble\n    ConfigParser--&gt;&gt;CLI: Return ensemble\n\n    CLI-&gt;&gt;Multiplexer: DabMultiplexer(ensemble)\n    Multiplexer-&gt;&gt;Inputs: Initialize inputs\n    Inputs-&gt;&gt;Inputs: open()\n\n    CLI-&gt;&gt;Outputs: Create output\n    Outputs-&gt;&gt;Outputs: open()\n\n    Note over Multiplexer: Ready to generate frames\n</code></pre>"},{"location":"architecture/system-design/#frame-generation-sequence","title":"Frame Generation Sequence","text":"<pre><code>sequenceDiagram\n    participant Mux as DabMultiplexer\n    participant Inputs\n    participant FIC as FICEncoder\n    participant Carousel\n    participant CRC\n    participant Output\n\n    Mux-&gt;&gt;Inputs: read() for each subchannel\n    Inputs--&gt;&gt;Mux: Audio data\n\n    Mux-&gt;&gt;FIC: encode_fic()\n    FIC-&gt;&gt;Carousel: get_figs()\n    Carousel--&gt;&gt;FIC: List of FIGs\n    FIC--&gt;&gt;Mux: FIC bytes (96 bytes)\n\n    Mux-&gt;&gt;Mux: Assemble frame (SYNC, FC, STC, FIC, MST, EOF)\n    Mux-&gt;&gt;CRC: calculate_crc() for EOH, EOF\n    CRC--&gt;&gt;Mux: CRC values\n\n    Mux-&gt;&gt;Output: write(frame_bytes)\n    Output-&gt;&gt;Output: Serialize and output\n</code></pre>"},{"location":"architecture/system-design/#design-patterns","title":"Design Patterns","text":""},{"location":"architecture/system-design/#factory-pattern","title":"Factory Pattern","text":"<p>Used for creating inputs and outputs:</p> <pre><code>def create_input(uri: str) -&gt; InputBase:\n    if uri.startswith('file://'):\n        return FileInput(uri)\n    elif uri.startswith('udp://'):\n        return UDPInput(uri)\n    elif uri.startswith('tcp://'):\n        return TCPInput(uri)\n</code></pre>"},{"location":"architecture/system-design/#strategy-pattern","title":"Strategy Pattern","text":"<p>Used for FIG generation:</p> <pre><code>class FigGenerator(ABC):\n    @abstractmethod\n    def generate(self, ensemble: DabEnsemble) -&gt; bytes:\n        pass\n\nclass Fig0_0(FigGenerator):\n    def generate(self, ensemble: DabEnsemble) -&gt; bytes:\n        # Generate FIG 0/0\n        ...\n\nclass Fig1_0(FigGenerator):\n    def generate(self, ensemble: DabEnsemble) -&gt; bytes:\n        # Generate FIG 1/0\n        ...\n</code></pre>"},{"location":"architecture/system-design/#composite-pattern","title":"Composite Pattern","text":"<p>Used for ETI frame structure:</p> <pre><code>class EtiFrame:\n    sync: Sync\n    fc: FrameCharacterization\n    stc: List[SubChannelStreamChar]\n    eoh: EndOfHeader\n    fic: FastInformationChannel\n    mst: MainServiceTransport\n    eof: EndOfFrame\n    tist: Optional[TimeStamp]\n</code></pre>"},{"location":"architecture/system-design/#template-method-pattern","title":"Template Method Pattern","text":"<p>Used in InputBase:</p> <pre><code>class InputBase(ABC):\n    def open(self) -&gt; None:\n        self._pre_open()\n        self._do_open()  # Abstract\n        self._post_open()\n\n    @abstractmethod\n    def _do_open(self) -&gt; None:\n        pass\n</code></pre>"},{"location":"architecture/system-design/#concurrency-model","title":"Concurrency Model","text":""},{"location":"architecture/system-design/#single-threaded-design","title":"Single-Threaded Design","text":"<p>python-dabmux uses a single-threaded, synchronous model:</p> <p>Rationale: - Simpler code and debugging - No race conditions or deadlocks - Sufficient performance for DAB multiplexing - Easier to reason about execution flow</p> <p>Processing: <pre><code>Loop:\n  1. Read inputs (blocking)\n  2. Generate FIGs\n  3. Assemble frame\n  4. Write output (blocking)\n  5. Sleep if needed for frame timing\n</code></pre></p> <p>For multi-core usage: Run multiple independent instances.</p>"},{"location":"architecture/system-design/#error-handling-strategy","title":"Error Handling Strategy","text":""},{"location":"architecture/system-design/#validation-at-boundaries","title":"Validation at Boundaries","text":"<ol> <li>Configuration: Validate at parse time</li> <li>Inputs: Validate format on read</li> <li>Outputs: Check write success</li> </ol>"},{"location":"architecture/system-design/#exception-hierarchy","title":"Exception Hierarchy","text":"<pre><code>DabMuxError (base exception)\n  \u251c\u2500 ConfigurationError\n  \u2502   \u251c\u2500 InvalidYamlError\n  \u2502   \u251c\u2500 ValidationError\n  \u2502   \u2514\u2500 MissingFieldError\n  \u251c\u2500 InputError\n  \u2502   \u251c\u2500 FileNotFoundError\n  \u2502   \u251c\u2500 InvalidFormatError\n  \u2502   \u2514\u2500 NetworkError\n  \u2514\u2500 OutputError\n      \u251c\u2500 WriteError\n      \u2514\u2500 NetworkError\n</code></pre>"},{"location":"architecture/system-design/#recovery-strategies","title":"Recovery Strategies","text":"Error Type Strategy Configuration error Fail fast (startup) Input read error Log warning, fill with zeros Output write error Retry 3 times, then fail Network error Exponential backoff retry"},{"location":"architecture/system-design/#performance-optimizations","title":"Performance Optimizations","text":""},{"location":"architecture/system-design/#avoiding-copies","title":"Avoiding Copies","text":"<ul> <li>Use <code>memoryview</code> for byte slicing</li> <li>Reuse buffers where possible</li> <li>Pack structs directly to output</li> </ul>"},{"location":"architecture/system-design/#caching","title":"Caching","text":"<ul> <li>Cache FIG bytes (many don't change frame-to-frame)</li> <li>Cache CRC tables (GF polynomial division)</li> <li>Cache character set mappings</li> </ul>"},{"location":"architecture/system-design/#batch-processing","title":"Batch Processing","text":"<ul> <li>Read multiple frames from inputs when available</li> <li>Write buffered output</li> </ul>"},{"location":"architecture/system-design/#extension-points","title":"Extension Points","text":""},{"location":"architecture/system-design/#adding-new-input-types","title":"Adding New Input Types","text":"<ol> <li>Subclass <code>InputBase</code></li> <li>Implement <code>_do_open()</code>, <code>read()</code>, <code>_do_close()</code></li> <li>Register in input factory</li> </ol>"},{"location":"architecture/system-design/#adding-new-fig-types","title":"Adding New FIG Types","text":"<ol> <li>Create class inheriting from FIG generator</li> <li>Implement <code>generate()</code> method</li> <li>Add to FIG carousel configuration</li> </ol>"},{"location":"architecture/system-design/#adding-new-output-formats","title":"Adding New Output Formats","text":"<ol> <li>Subclass <code>DabOutput</code></li> <li>Implement <code>write()</code> method</li> <li>Handle format-specific serialization</li> </ol>"},{"location":"architecture/system-design/#testing-strategy","title":"Testing Strategy","text":""},{"location":"architecture/system-design/#unit-tests","title":"Unit Tests","text":"<ul> <li>Each module tested independently</li> <li>Mock external dependencies</li> <li>389 tests, 71% coverage</li> </ul>"},{"location":"architecture/system-design/#integration-tests","title":"Integration Tests","text":"<ul> <li>End-to-end configuration \u2192 output</li> <li>Verify ETI frame correctness</li> <li>Check CRC values</li> </ul>"},{"location":"architecture/system-design/#performance-tests","title":"Performance Tests","text":"<ul> <li>Frame generation rate</li> <li>Memory usage</li> <li>CPU utilization</li> </ul>"},{"location":"architecture/system-design/#see-also","title":"See Also","text":"<ul> <li>ETI Frame Structure: Detailed frame layout</li> <li>Data Flow: Complete processing pipeline</li> <li>Module Breakdown: Per-module descriptions</li> <li>API Reference: Code documentation</li> </ul>"},{"location":"getting-started/","title":"Getting Started with python-dabmux","text":"<p>Welcome! This guide will help you get python-dabmux installed and create your first DAB multiplex in under 15 minutes.</p>"},{"location":"getting-started/#what-youll-learn","title":"What You'll Learn","text":"<p>This getting started guide covers:</p> <ol> <li>Installation: Install python-dabmux and its dependencies</li> <li>Your First Multiplex: Create and run a basic DAB ensemble</li> <li>Basic Concepts: Understand DAB terminology and architecture</li> </ol>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, make sure you have:</p> <ul> <li>Python 3.11 or later: python-dabmux requires Python 3.11+</li> <li>Basic command-line knowledge: You'll run commands in a terminal</li> <li>Audio files: MPEG Layer II files for testing (optional - we provide examples)</li> </ul>"},{"location":"getting-started/#what-is-a-dab-multiplexer","title":"What is a DAB Multiplexer?","text":"<p>A DAB multiplexer combines multiple audio streams (radio stations) into a single DAB ensemble for transmission. Think of it like this:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Radio One   \u2502\u2500\u2510\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502 Radio Two   \u2502\u2500\u253c\u2500\u2192 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502   \u2502 Multiplexer  \u2502\u2500\u2500\u2500\u2500\u2500\u2192\u2502 ETI Output \u2502\n\u2502 Radio Three \u2502\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  Audio Streams        Combines into          DAB Signal\n                       DAB Ensemble\n</code></pre> <p>The multiplexer:</p> <ul> <li>Reads audio from multiple sources (files, network streams)</li> <li>Adds metadata (station names, programme types, etc.)</li> <li>Generates Fast Information Groups (FIGs) with service information</li> <li>Combines everything into ETI (Ensemble Transport Interface) frames</li> <li>Outputs ETI files or EDI network streams for transmission</li> </ul>"},{"location":"getting-started/#quick-start-path","title":"Quick Start Path","text":"<p>Follow this path to get up and running:</p> <ol> <li>Install python-dabmux (5 minutes)</li> <li>Set up a Python virtual environment</li> <li>Install python-dabmux with pip</li> <li> <p>Verify the installation</p> </li> <li> <p>Create Your First Multiplex (10 minutes)</p> </li> <li>Write a simple configuration file</li> <li>Run the multiplexer</li> <li> <p>Verify the output</p> </li> <li> <p>Learn Basic Concepts (optional reading)</p> </li> <li>Understand DAB terminology</li> <li>Learn about ensembles, services, and subchannels</li> <li>Explore the configuration hierarchy</li> </ol>"},{"location":"getting-started/#after-getting-started","title":"After Getting Started","text":"<p>Once you've completed this guide, explore:</p> <ul> <li>Configuration Reference: Learn all configuration options</li> <li>Tutorials: Hands-on guides for specific scenarios</li> <li>Architecture: Understand how python-dabmux works internally</li> </ul>"},{"location":"getting-started/#need-help","title":"Need Help?","text":"<p>If you run into issues:</p> <ul> <li>Check the Troubleshooting Guide for common errors</li> <li>Read the FAQ for frequently asked questions</li> <li>Report bugs on GitHub Issues</li> </ul> <p>Ready? Let's start with Installation \u2192</p>"},{"location":"getting-started/basic-concepts/","title":"Basic Concepts","text":"<p>This guide explains fundamental DAB concepts and terminology used throughout python-dabmux.</p>"},{"location":"getting-started/basic-concepts/#dab-overview","title":"DAB Overview","text":"<p>DAB (Digital Audio Broadcasting) is a digital radio standard for broadcasting multiple audio channels over terrestrial radio. Think of it like this:</p> <ul> <li>Analog FM: One station per frequency</li> <li>DAB: Multiple stations (ensemble) on one frequency</li> </ul>"},{"location":"getting-started/basic-concepts/#core-concepts","title":"Core Concepts","text":""},{"location":"getting-started/basic-concepts/#ensemble","title":"Ensemble","text":"<p>An ensemble is a collection of radio stations (services) transmitted together on a single frequency. It's like a \"bundle\" of stations.</p> <p>Key properties:</p> <ul> <li>Ensemble ID (<code>0xCE15</code>): Unique 16-bit identifier</li> <li>Label: Name visible to listeners (e.g., \"BBC Ensemble\")</li> <li>ECC: Extended Country Code (e.g., <code>0xE1</code> for Germany)</li> <li>Transmission Mode: RF characteristics (Mode I, II, III, or IV)</li> </ul> <p>Example: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Ensemble: \"BBC DAB\"        \u2502\n\u2502      ID: 0xCE15                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \ud83d\udcfb BBC Radio 1                 \u2502\n\u2502  \ud83d\udcfb BBC Radio 2                 \u2502\n\u2502  \ud83d\udcfb BBC Radio 3                 \u2502\n\u2502  \ud83d\udcfb BBC Radio 4                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#service","title":"Service","text":"<p>A service is a radio station or program stream. Each service has:</p> <ul> <li>Service ID (<code>0x5001</code>): Unique identifier within the ensemble</li> <li>Label: Station name (e.g., \"BBC Radio 1\")</li> <li>Short Label: Abbreviated name (e.g., \"BBC R1\")</li> <li>PTY: Programme Type (News, Rock, Classical, etc.)</li> <li>Language: Language code</li> </ul> <p>Example: <pre><code>services:\n  - uid: 'bbc_radio1'\n    id: '0x5001'\n    label:\n      text: 'BBC Radio 1'\n      short: 'BBC R1'\n    pty: 10                   # Pop Music\n    language: 9               # English\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#component","title":"Component","text":"<p>A component links a service to a subchannel. Services can have multiple components (e.g., primary audio + data).</p> <ul> <li>Service ID: Which service this belongs to</li> <li>Subchannel ID: Which subchannel carries the data</li> <li>Type: Audio (0), Data (various)</li> </ul> <p>Example: <pre><code>components:\n  - uid: 'comp1'\n    service_id: '0x5001'      # BBC Radio 1\n    subchannel_id: 0          # Uses subchannel 0\n    type: 0                   # Audio component\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#subchannel","title":"Subchannel","text":"<p>A subchannel is the actual data stream carrying audio or data. It defines:</p> <ul> <li>Bitrate: Data rate (e.g., 128 kbps)</li> <li>Protection Level: Error correction strength (0-4)</li> <li>Start Address: Position in the transmission frame</li> <li>Input Source: Where the data comes from</li> </ul> <p>Example: <pre><code>subchannels:\n  - uid: 'audio1'\n    id: 0\n    type: 'audio'             # MPEG Layer II\n    bitrate: 128              # 128 kbps\n    start_address: 0          # Start position\n    protection:\n      level: 2                # Moderate protection\n      shortform: true\n    input: 'file://audio.mp2'\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<p>The relationship between these elements:</p> <pre><code>Ensemble\n  \u2502\n  \u251c\u2500\u25ba Service 1 \u2500\u2500\u25ba Component 1 \u2500\u2500\u25ba Subchannel 1 \u2500\u2500\u25ba Input 1\n  \u2502                                      \u2193\n  \u2502                                  Protection\n  \u2502                                   Bitrate\n  \u2502\n  \u251c\u2500\u25ba Service 2 \u2500\u2500\u25ba Component 2 \u2500\u2500\u25ba Subchannel 2 \u2500\u2500\u25ba Input 2\n  \u2502\n  \u2514\u2500\u25ba Service 3 \u2500\u2500\u25ba Component 3 \u2500\u2500\u25ba Subchannel 3 \u2500\u2500\u25ba Input 3\n</code></pre> <p>Key insights:</p> <ol> <li>Services are what listeners see (station names)</li> <li>Components link services to data streams</li> <li>Subchannels carry the actual data</li> <li>Inputs provide the data to subchannels</li> </ol>"},{"location":"getting-started/basic-concepts/#eti-and-edi","title":"ETI and EDI","text":""},{"location":"getting-started/basic-concepts/#eti-ensemble-transport-interface","title":"ETI (Ensemble Transport Interface)","text":"<p>ETI is the frame format that python-dabmux generates. Each ETI frame contains:</p> <ul> <li>Header: Frame characteristics, subchannel info</li> <li>FIC: Fast Information Channel (metadata, FIGs)</li> <li>MST: Main Service Transport (audio data)</li> <li>Footer: CRC and timestamp</li> </ul> <p>ETI frame structure: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SYNC (4) \u2502 FC  \u2502 STC (4) \u2502 EOH   \u2502 FIC    \u2502 MST  \u2502 EOF  \u2502\n\u2502          \u2502 (4) \u2502 \u00d7N subs \u2502 (4)   \u2502 (96)   \u2502 (var)\u2502 (4)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502                \u2502\n                              Metadata           Audio Data\n</code></pre></p> <p>ETI file formats:</p> <ul> <li>Raw ETI: Just the frames, no timing</li> <li>Streamed ETI: Frames with timestamps</li> <li>Framed ETI: Aligned frames with delimiters</li> </ul>"},{"location":"getting-started/basic-concepts/#edi-ensemble-data-interface","title":"EDI (Ensemble Data Interface)","text":"<p>EDI is a network protocol for transmitting ETI over IP networks. It adds:</p> <ul> <li>TAG Items: Structured data packets (*ptr, deti, estN)</li> <li>AF Packets: Application Framing with CRC</li> <li>PFT: Optional fragmentation and FEC</li> </ul> <p>EDI protocol stack: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   ETI Frame     \u2502  Application data\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   TAG Items     \u2502  Structured encoding\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   AF Packet     \u2502  Framing + CRC\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   PFT (opt)     \u2502  Fragmentation + FEC\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   UDP/TCP/IP    \u2502  Network transport\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#fig-fast-information-group","title":"FIG (Fast Information Group)","text":"<p>FIGs are metadata packets that describe the ensemble. They tell receivers:</p> <ul> <li>What services are available</li> <li>How subchannels are organized</li> <li>Service labels and information</li> </ul> <p>Common FIG types:</p> <ul> <li>FIG 0/0: Ensemble information (ID, country)</li> <li>FIG 0/1: Subchannel organization (bitrates, addresses)</li> <li>FIG 0/2: Service organization (links services to components)</li> <li>FIG 1/0: Ensemble label</li> <li>FIG 1/1: Service labels</li> </ul> <p>FIG Carousel:</p> <p>FIGs are transmitted repeatedly in a rotating schedule:</p> <pre><code>Frame 1:  FIG 0/0, FIG 0/1, FIG 0/2\nFrame 2:  FIG 1/0, FIG 1/1\nFrame 3:  FIG 0/0, FIG 0/1, FIG 0/2\nFrame 4:  FIG 1/0, FIG 1/1\n...\n</code></pre> <p>Frequent FIGs (like 0/0) repeat every 96ms. Others every second or more.</p>"},{"location":"getting-started/basic-concepts/#audio-formats","title":"Audio Formats","text":""},{"location":"getting-started/basic-concepts/#dab-mpeg-layer-ii","title":"DAB (MPEG Layer II)","text":"<p>Traditional DAB uses MPEG-1 Audio Layer II:</p> <ul> <li>Bitrates: 32-384 kbps (typical: 128-192 kbps)</li> <li>Good quality at medium bitrates</li> <li>Well-established standard</li> </ul>"},{"location":"getting-started/basic-concepts/#dab-he-aac-v2","title":"DAB+ (HE-AAC v2)","text":"<p>Modern DAB+ uses HE-AAC v2 (High-Efficiency AAC):</p> <ul> <li>Bitrates: 32-192 kbps (typical: 48-72 kbps)</li> <li>Better quality at lower bitrates</li> <li>More efficient than MPEG Layer II</li> <li>Uses \"superframes\" for packaging</li> </ul>"},{"location":"getting-started/basic-concepts/#protection-levels","title":"Protection Levels","text":"<p>DAB uses UEP (Unequal Error Protection) to protect audio from transmission errors:</p> Level Protection Use Case 0 Weakest Strong signal, high bitrate 1 Weak Good signal 2 Moderate Normal conditions (recommended) 3 Strong Weak signal, lower bitrate 4 Strongest Very weak signal <p>Trade-off: Higher protection = more redundancy = lower useful bitrate</p> <p>Example: <pre><code>protection:\n  level: 2                    # Moderate protection\n  shortform: true             # Use short form table\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#capacity-units-cu","title":"Capacity Units (CU)","text":"<p>The Main Service Transport (MST) is divided into Capacity Units. Each subchannel occupies a contiguous range of CUs.</p> <p>Calculation: - Higher bitrates = more CUs - Higher protection = more CUs</p> <p>Example allocation: <pre><code>Mode I MST: 864 Capacity Units\n\nSubchannel 1: Start 0,   Length 84 CUs  (128 kbps, level 2)\nSubchannel 2: Start 84,  Length 84 CUs  (128 kbps, level 2)\nSubchannel 3: Start 168, Length 42 CUs  (64 kbps, level 2)\n</code></pre></p> <p>Important: python-dabmux automatically calculates CU allocation. You don't need to manually specify lengths.</p>"},{"location":"getting-started/basic-concepts/#transmission-modes","title":"Transmission Modes","text":"<p>DAB defines four transmission modes:</p> Mode Bandwidth Frame Duration OFDM Carriers Use Case I 1.536 MHz 96 ms 1536 Most common II 384 kHz 24 ms 384 Local/indoor III 192 kHz 24 ms 192 Cable/satellite IV 768 kHz 48 ms 768 Regional <p>Mode I is by far the most common for terrestrial DAB broadcasting.</p>"},{"location":"getting-started/basic-concepts/#timestamps","title":"Timestamps","text":""},{"location":"getting-started/basic-concepts/#tist-time-stamp","title":"TIST (Time-Stamp)","text":"<p>The TIST field in ETI frames provides frame timestamps:</p> <ul> <li>Milliseconds since \"EDI epoch\" (January 1, 2000, 00:00:00 UTC)</li> <li>Used for synchronization between multiple transmitters</li> <li>Optional but recommended for network transmission</li> </ul>"},{"location":"getting-started/basic-concepts/#frame-timing","title":"Frame Timing","text":"<ul> <li>Mode I: 96 ms per frame (10.41... frames/second)</li> <li>Mode II: 24 ms per frame</li> <li>Mode III: 24 ms per frame</li> <li>Mode IV: 48 ms per frame</li> </ul>"},{"location":"getting-started/basic-concepts/#input-sources","title":"Input Sources","text":"<p>python-dabmux supports multiple input types:</p>"},{"location":"getting-started/basic-concepts/#file-inputs","title":"File Inputs","text":"<ul> <li>file://: Local file path</li> <li>Supported formats: MPEG Layer II, DAB+ superframes, raw audio</li> </ul> <p>Example: <pre><code>input: 'file://audio.mp2'\ninput: 'file:///absolute/path/audio.mp2'\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#network-inputs","title":"Network Inputs","text":"<ul> <li>udp://: UDP unicast or multicast</li> <li>tcp://: TCP client connection</li> </ul> <p>Example: <pre><code>input: 'udp://239.1.2.3:5001'\ninput: 'tcp://192.168.1.100:5001'\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#output-formats","title":"Output Formats","text":""},{"location":"getting-started/basic-concepts/#eti-files","title":"ETI Files","text":"<ul> <li>Raw ETI: Binary ETI frames</li> <li>Streamed ETI: ETI with timing info</li> <li>Framed ETI: Aligned frames</li> </ul> <p>Example: <pre><code>python -m dabmux.cli -c config.yaml -o output.eti\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#edi-network","title":"EDI Network","text":"<ul> <li>UDP: Connectionless, multicast support</li> <li>TCP: Reliable, connection-oriented</li> <li>PFT: Optional fragmentation and FEC</li> </ul> <p>Example: <pre><code>python -m dabmux.cli -c config.yaml --edi udp://239.1.2.3:12000\npython -m dabmux.cli -c config.yaml --edi tcp://192.168.1.100:12000 --pft\n</code></pre></p>"},{"location":"getting-started/basic-concepts/#common-terminology","title":"Common Terminology","text":"Term Meaning CIF Common Interleaved Frame - the audio/data portion of an ETI frame CRC Cyclic Redundancy Check - error detection code ECC Extended Country Code - identifies the country FEC Forward Error Correction - redundancy for error recovery FIC Fast Information Channel - carries FIGs FIG Fast Information Group - metadata packet MSC Main Service Channel - carries audio/data streams MST Main Service Transport - multiplexed audio data PTY Programme Type - station genre/category PFT Protection, Fragmentation and Transport - EDI layer RS Reed-Solomon - type of FEC STC Stream Characterization - subchannel header info UEP Unequal Error Protection - variable protection scheme"},{"location":"getting-started/basic-concepts/#key-takeaways","title":"Key Takeaways","text":"<ol> <li>Ensemble = Collection of stations on one frequency</li> <li>Service = A single radio station</li> <li>Subchannel = Data stream carrying audio</li> <li>Component = Links services to subchannels</li> <li>ETI = Frame format containing everything</li> <li>EDI = Network protocol for transmitting ETI</li> <li>FIG = Metadata describing the ensemble</li> <li>Protection = Error correction strength</li> </ol>"},{"location":"getting-started/basic-concepts/#next-steps","title":"Next Steps","text":"<p>Now that you understand the basics:</p> <ul> <li>Configuration Reference: Learn all configuration options</li> <li>Architecture: See system design with diagrams</li> <li>Tutorials: Hands-on guides for specific scenarios</li> <li>Glossary: Complete DAB terminology reference</li> </ul>"},{"location":"getting-started/basic-concepts/#see-also","title":"See Also","text":"<ul> <li>ETI Frame Structure: Detailed frame layout with diagram</li> <li>FIG Types: Complete FIG specification</li> <li>Transmission Modes: Deep dive into RF characteristics</li> <li>Standards References: ETSI specifications</li> </ul>"},{"location":"getting-started/first-multiplex/","title":"Your First Multiplex","text":"<p>In this tutorial, you'll create your first DAB ensemble and generate ETI output. We'll start simple with a single radio station.</p>"},{"location":"getting-started/first-multiplex/#what-well-build","title":"What We'll Build","text":"<p>A basic DAB ensemble with:</p> <ul> <li>One radio station: \"Radio One\"</li> <li>128 kbps MPEG Layer II audio</li> <li>ETI file output</li> </ul>"},{"location":"getting-started/first-multiplex/#step-1-prepare-audio-input","title":"Step 1: Prepare Audio Input","text":"<p>python-dabmux needs MPEG Layer II audio files as input. For this tutorial, you can either:</p> <ol> <li>Use your own MPEG Layer II files (<code>.mp2</code> extension)</li> <li>Or create a test file from any audio using ffmpeg:</li> </ol> <pre><code># Install ffmpeg if needed\n# macOS: brew install ffmpeg\n# Linux: sudo apt install ffmpeg\n# Windows: Download from ffmpeg.org\n\n# Convert any audio file to MPEG Layer II\nffmpeg -i input.wav -codec:a mp2 -b:a 128k audio.mp2\n</code></pre> <p>Place your <code>audio.mp2</code> file in a directory where you'll run python-dabmux.</p>"},{"location":"getting-started/first-multiplex/#step-2-create-configuration-file","title":"Step 2: Create Configuration File","text":"<p>Create a file named <code>config.yaml</code> with the following content:</p> <pre><code># Basic DAB Multiplex Configuration\n\nensemble:\n  # Ensemble ID - a unique 16-bit identifier\n  id: '0xCE15'\n\n  # Extended Country Code - 0xE1 for Germany\n  ecc: '0xE1'\n\n  # Transmission mode - I is most common (1536 kHz bandwidth)\n  transmission_mode: 'I'\n\n  # Ensemble label (visible to listeners)\n  label:\n    text: 'My First DAB'\n    short: 'DAB'\n\n  # Automatic local time offset\n  lto_auto: true\n\n# Subchannels define the audio streams\nsubchannels:\n  - uid: 'audio1'              # Unique identifier\n    id: 0                      # Subchannel ID (0-63)\n    type: 'audio'              # Type: audio, dabplus, packet, data\n    bitrate: 128               # 128 kbps\n    start_address: 0           # Start position in Capacity Units\n    protection:\n      level: 2                 # Protection level (0=weakest, 4=strongest)\n      shortform: true          # Use short form protection table\n    input: 'file://audio.mp2'  # Path to input file\n\n# Services define the radio stations\nservices:\n  - uid: 'service1'\n    id: '0x5001'               # Service ID (unique 16-bit hex)\n    label:\n      text: 'Radio One'        # Station name (max 16 characters)\n      short: 'Radio1'          # Short name (max 8 characters)\n    pty: 1                     # Programme Type (1=News)\n    language: 9                # Language code (9=English)\n\n# Components link services to subchannels\ncomponents:\n  - uid: 'comp1'\n    service_id: '0x5001'       # Must match a service ID above\n    subchannel_id: 0           # Must match a subchannel ID above\n    type: 0                    # Component type (0=Audio)\n</code></pre>"},{"location":"getting-started/first-multiplex/#step-3-run-the-multiplexer","title":"Step 3: Run the Multiplexer","text":"<p>Now run python-dabmux with your configuration:</p> <pre><code>python -m dabmux.cli -c config.yaml -o output.eti\n</code></pre> <p>You should see output like:</p> <pre><code>INFO: Loading configuration from config.yaml\nINFO: Created ensemble 'My First DAB' (0xCE15)\nINFO: Added service 'Radio One' (0x5001)\nINFO: Added subchannel 0: audio, 128 kbps, protection level 2\nINFO: Starting multiplexer\nINFO: Generated 1000 ETI frames\nINFO: Output written to output.eti\nINFO: Multiplexing complete\n</code></pre>"},{"location":"getting-started/first-multiplex/#step-4-verify-the-output","title":"Step 4: Verify the Output","text":"<p>Check that the ETI file was created:</p> <pre><code># Check file size (should be around 6 MB for 1000 frames)\nls -lh output.eti\n\n# File info\nfile output.eti\n</code></pre>"},{"location":"getting-started/first-multiplex/#understanding-what-just-happened","title":"Understanding What Just Happened","text":"<p>Let's break down what python-dabmux did:</p> <ol> <li>Loaded Configuration: Read <code>config.yaml</code> and validated all parameters</li> <li>Created Ensemble: Set up a DAB ensemble with ID 0xCE15</li> <li>Added Service: Created \"Radio One\" service with label and metadata</li> <li>Configured Subchannel: Allocated bandwidth for 128 kbps audio with protection level 2</li> <li>Opened Input: Connected to <code>audio.mp2</code> file</li> <li>Generated FIGs: Created Fast Information Groups with ensemble and service information</li> <li>Multiplexed Frames: Combined audio data with FIGs into ETI frames</li> <li>Wrote Output: Saved ETI frames to <code>output.eti</code></li> </ol>"},{"location":"getting-started/first-multiplex/#step-5-explore-configuration-options","title":"Step 5: Explore Configuration Options","text":""},{"location":"getting-started/first-multiplex/#change-the-station-name","title":"Change the Station Name","text":"<p>Edit the service label in <code>config.yaml</code>:</p> <pre><code>services:\n  - uid: 'service1'\n    id: '0x5001'\n    label:\n      text: 'My Cool Radio'    # Changed!\n      short: 'MyCool'          # Changed!\n</code></pre>"},{"location":"getting-started/first-multiplex/#adjust-audio-bitrate","title":"Adjust Audio Bitrate","text":"<p>Change the subchannel bitrate:</p> <pre><code>subchannels:\n  - uid: 'audio1'\n    bitrate: 192               # Higher quality (was 128)\n</code></pre>"},{"location":"getting-started/first-multiplex/#use-a-different-input-file","title":"Use a Different Input File","text":"<p>Point to another audio file:</p> <pre><code>subchannels:\n  - uid: 'audio1'\n    input: 'file:///path/to/other/audio.mp2'  # Full path\n</code></pre>"},{"location":"getting-started/first-multiplex/#common-configuration-mistakes","title":"Common Configuration Mistakes","text":""},{"location":"getting-started/first-multiplex/#wrong-input-path","title":"Wrong Input Path","text":"<p>\u274c Wrong: <pre><code>input: 'audio.mp2'  # Missing file:// prefix\n</code></pre></p> <p>\u2705 Correct: <pre><code>input: 'file://audio.mp2'  # With prefix\n</code></pre></p>"},{"location":"getting-started/first-multiplex/#mismatched-ids","title":"Mismatched IDs","text":"<p>\u274c Wrong: <pre><code>components:\n  - service_id: '0x5001'      # Service ID\n    subchannel_id: 1          # But subchannel has id: 0\n</code></pre></p> <p>\u2705 Correct: <pre><code>components:\n  - service_id: '0x5001'      # Matches service above\n    subchannel_id: 0          # Matches subchannel above\n</code></pre></p>"},{"location":"getting-started/first-multiplex/#invalid-bitrate","title":"Invalid Bitrate","text":"<p>\u274c Wrong: <pre><code>bitrate: 150  # Not a standard DAB bitrate\n</code></pre></p> <p>\u2705 Correct: <pre><code>bitrate: 128  # Valid: 32, 48, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384\n</code></pre></p>"},{"location":"getting-started/first-multiplex/#next-steps","title":"Next Steps","text":"<p>Now that you've created a basic multiplex, try:</p>"},{"location":"getting-started/first-multiplex/#add-more-stations","title":"Add More Stations","text":"<p>See Multi-Service Ensemble Tutorial to add multiple radio stations.</p>"},{"location":"getting-started/first-multiplex/#network-output","title":"Network Output","text":"<p>Instead of files, output EDI over the network:</p> <pre><code>python -m dabmux.cli -c config.yaml --edi udp://239.1.2.3:12000\n</code></pre> <p>See Network Streaming Tutorial.</p>"},{"location":"getting-started/first-multiplex/#continuous-operation","title":"Continuous Operation","text":"<p>Loop the input file for continuous transmission:</p> <pre><code>python -m dabmux.cli -c config.yaml -o output.eti --continuous\n</code></pre>"},{"location":"getting-started/first-multiplex/#dab-he-aac-v2","title":"DAB+ (HE-AAC v2)","text":"<p>Use DAB+ for better audio quality at lower bitrates:</p> <p>See DAB+ Setup Tutorial.</p>"},{"location":"getting-started/first-multiplex/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/first-multiplex/#input-file-not-found","title":"Input File Not Found","text":"<pre><code>ERROR: Input file not found: audio.mp2\n</code></pre> <p>Solution: Check the file path. Use absolute paths if needed:</p> <pre><code>input: 'file:///home/user/audio.mp2'  # Linux/macOS\ninput: 'file://C:/Users/user/audio.mp2'  # Windows\n</code></pre>"},{"location":"getting-started/first-multiplex/#invalid-frame-size","title":"Invalid Frame Size","text":"<pre><code>ERROR: Invalid MPEG frame header\n</code></pre> <p>Solution: Ensure your input file is MPEG Layer II format:</p> <pre><code>ffmpeg -i input.wav -codec:a mp2 -b:a 128k audio.mp2\n</code></pre>"},{"location":"getting-started/first-multiplex/#configuration-errors","title":"Configuration Errors","text":"<pre><code>ERROR: Invalid configuration: Unknown key 'labeltext'\n</code></pre> <p>Solution: Check YAML syntax. Common issues: - Incorrect indentation (use spaces, not tabs) - Typos in key names - Missing quotes around hex values</p>"},{"location":"getting-started/first-multiplex/#learn-more","title":"Learn More","text":"<ul> <li>Basic Concepts: Understand DAB terminology</li> <li>Configuration Reference: All configuration options</li> <li>CLI Reference: All command-line options</li> <li>Tutorials: More hands-on guides</li> </ul>"},{"location":"getting-started/first-multiplex/#summary","title":"Summary","text":"<p>Congratulations! You've created your first DAB multiplex. You learned how to:</p> <ul> <li>\u2705 Create a YAML configuration file</li> <li>\u2705 Define ensemble, services, and subchannels</li> <li>\u2705 Run the multiplexer with CLI</li> <li>\u2705 Generate ETI output files</li> </ul> <p>Continue to Basic Concepts to deepen your understanding, or jump into Tutorials for more advanced scenarios.</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers installing python-dabmux on your system.</p>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11 or later: python-dabmux uses modern Python features</li> <li>pip: Python package installer (usually comes with Python)</li> <li>Virtual environment (recommended): Keeps dependencies isolated</li> </ul>"},{"location":"getting-started/installation/#installation-methods","title":"Installation Methods","text":""},{"location":"getting-started/installation/#method-1-install-from-pypi-recommended","title":"Method 1: Install from PyPI (Recommended)","text":"<p>Once python-dabmux is published to PyPI, you can install it directly:</p> <pre><code># Create and activate a virtual environment\npython -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install python-dabmux\npip install python-dabmux\n</code></pre>"},{"location":"getting-started/installation/#method-2-install-from-source","title":"Method 2: Install from Source","text":"<p>For development or to use the latest code:</p> <pre><code># Clone the repository\ngit clone https://github.com/python-dabmux/python-dabmux.git\ncd python-dabmux\n\n# Create and activate a virtual environment\npython -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install in development mode\npip install -e .\n</code></pre>"},{"location":"getting-started/installation/#method-3-install-with-development-tools","title":"Method 3: Install with Development Tools","text":"<p>If you plan to contribute or run tests:</p> <pre><code># Clone and navigate to the repository\ngit clone https://github.com/python-dabmux/python-dabmux.git\ncd python-dabmux\n\n# Create and activate a virtual environment\npython -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install with development dependencies\npip install -e \".[dev]\"\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>After installation, verify that python-dabmux is working:</p> <pre><code># Check the CLI is accessible\npython -m dabmux.cli --help\n</code></pre> <p>You should see the help message with available options:</p> <pre><code>usage: python -m dabmux.cli [-h] [-c CONFIG] [-o OUTPUT] [--edi EDI]\n                            [--pft] [--continuous] [--version]\n\nDAB/DAB+ Multiplexer\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -c CONFIG, --config CONFIG\n                        Path to configuration file (YAML)\n  -o OUTPUT, --output OUTPUT\n                        Output file path (ETI format)\n  --edi EDI             EDI output (udp://host:port or tcp://host:port)\n  --pft                 Enable PFT (Protection, Fragmentation, Transport)\n  --continuous          Run continuously (loop inputs)\n  --version             Show version and exit\n</code></pre>"},{"location":"getting-started/installation/#platform-specific-notes","title":"Platform-Specific Notes","text":""},{"location":"getting-started/installation/#linux","title":"Linux","text":"<p>python-dabmux works on all major Linux distributions:</p> <pre><code># Debian/Ubuntu\nsudo apt update\nsudo apt install python3.11 python3.11-venv python3-pip\n\n# Fedora/RHEL\nsudo dnf install python3.11 python3-pip\n\n# Arch Linux\nsudo pacman -S python python-pip\n</code></pre>"},{"location":"getting-started/installation/#macos","title":"macOS","text":"<p>Python 3.11+ is available via Homebrew:</p> <pre><code># Install Homebrew if needed\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n\n# Install Python\nbrew install python@3.11\n</code></pre>"},{"location":"getting-started/installation/#windows","title":"Windows","text":"<ol> <li>Download Python 3.11+ from python.org</li> <li>Run the installer</li> <li>Check \"Add Python to PATH\" during installation</li> <li>Open Command Prompt or PowerShell and verify:</li> </ol> <pre><code>python --version\n</code></pre>"},{"location":"getting-started/installation/#dependencies","title":"Dependencies","text":"<p>python-dabmux has minimal dependencies:</p> <ul> <li>structlog: Structured logging (automatically installed)</li> </ul>"},{"location":"getting-started/installation/#optional-dependencies","title":"Optional Dependencies","text":"<p>For documentation (developers only):</p> <pre><code>pip install -e \".[docs]\"\n</code></pre> <p>This installs: - mkdocs - mkdocs-material - mkdocs-mermaid2-plugin - pymdown-extensions</p>"},{"location":"getting-started/installation/#troubleshooting-installation","title":"Troubleshooting Installation","text":""},{"location":"getting-started/installation/#python-version-issues","title":"Python Version Issues","text":"<p>If you see \"Python 3.11 or later is required\":</p> <pre><code># Check your Python version\npython --version\n\n# If you have multiple Python versions, use:\npython3.11 -m venv venv\n</code></pre>"},{"location":"getting-started/installation/#permission-errors","title":"Permission Errors","text":"<p>On Linux/macOS, if you see permission errors:</p> <pre><code># Don't use sudo with pip in a virtual environment\n# Instead, ensure you've activated the venv:\nsource venv/bin/activate\n</code></pre>"},{"location":"getting-started/installation/#windows-path-issues","title":"Windows Path Issues","text":"<p>If <code>python</code> command is not found:</p> <ol> <li>Reinstall Python with \"Add to PATH\" checked</li> <li>Or manually add Python to your PATH</li> <li>Or use the full path to python.exe</li> </ol>"},{"location":"getting-started/installation/#pip-not-found","title":"pip Not Found","text":"<pre><code># Linux/macOS\npython -m ensurepip --upgrade\n\n# Or install pip separately\ncurl https://bootstrap.pypa.io/get-pip.py -o get-pip.py\npython get-pip.py\n</code></pre>"},{"location":"getting-started/installation/#upgrading","title":"Upgrading","text":"<p>To upgrade python-dabmux to the latest version:</p> <pre><code># From PyPI\npip install --upgrade python-dabmux\n\n# From source (in the repository directory)\ngit pull\npip install -e .\n</code></pre>"},{"location":"getting-started/installation/#uninstallation","title":"Uninstallation","text":"<p>To remove python-dabmux:</p> <pre><code>pip uninstall python-dabmux\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>Now that python-dabmux is installed, let's create your first multiplex:</p> <p>Your First Multiplex \u2192</p>"},{"location":"getting-started/installation/#see-also","title":"See Also","text":"<ul> <li>Basic Concepts: Learn DAB terminology</li> <li>CLI Reference: Complete CLI documentation</li> <li>Configuration Reference: All configuration options</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>Having problems with python-dabmux? This section will help you diagnose and fix common issues.</p>"},{"location":"troubleshooting/#quick-troubleshooting","title":"Quick Troubleshooting","text":""},{"location":"troubleshooting/#check-these-first","title":"Check These First","text":"<ol> <li> <p>Python version: Requires Python 3.11+    <pre><code>python --version\n</code></pre></p> </li> <li> <p>Installation: Verify python-dabmux is installed    <pre><code>python -m dabmux.cli --help\n</code></pre></p> </li> <li> <p>Configuration: Validate your YAML file    <pre><code># Try with verbose logging\ndabmux -c config.yaml -o test.eti -n 1 -vvv\n</code></pre></p> </li> <li> <p>Input files: Check files exist and are correct format    <pre><code>ls -l audio.mp2\nfile audio.mp2\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#troubleshooting-guides","title":"Troubleshooting Guides","text":""},{"location":"troubleshooting/#common-errors","title":"Common Errors","text":"<p>25+ most common errors with solutions:</p> <ul> <li>Configuration file errors (missing sections, invalid YAML, hex values)</li> <li>Input errors (file not found, invalid format, network issues)</li> <li>Output errors (permissions, network unreachable, EDI problems)</li> <li>Runtime errors (memory, interrupts, capacity exceeded)</li> </ul> <p>Read Common Errors \u2192</p>"},{"location":"troubleshooting/#input-issues","title":"Input Issues","text":"<p>Problems with audio inputs:</p> <ul> <li>File input errors (formats, paths, permissions)</li> <li>Network input issues (UDP/TCP, multicast, buffering)</li> <li>Audio format problems (MPEG vs AAC, bitrates, sample rates)</li> </ul> <p>Read Input Issues \u2192</p>"},{"location":"troubleshooting/#output-issues","title":"Output Issues","text":"<p>Problems with ETI/EDI output:</p> <ul> <li>File output errors (permissions, disk space, formats)</li> <li>EDI network issues (connectivity, protocols, addressing)</li> <li>PFT problems (fragmentation, FEC, MTU)</li> </ul> <p>Read Output Issues \u2192</p>"},{"location":"troubleshooting/#network-issues","title":"Network Issues","text":"<p>Network-specific problems:</p> <ul> <li>Multicast configuration</li> <li>Firewall and routing</li> <li>UDP vs TCP considerations</li> <li>Performance tuning</li> </ul> <p>Read Network Issues \u2192</p>"},{"location":"troubleshooting/#debugging","title":"Debugging","text":"<p>Advanced debugging techniques:</p> <ul> <li>Enabling debug logging</li> <li>Analyzing ETI frames</li> <li>Using network monitoring tools</li> <li>Profiling performance</li> </ul> <p>Read Debugging Guide \u2192</p>"},{"location":"troubleshooting/#common-problem-categories","title":"Common Problem Categories","text":""},{"location":"troubleshooting/#configuration-problems","title":"Configuration Problems","text":"<p>Symptoms: - Error on startup - \"Invalid configuration\" messages - YAML parse errors</p> <p>First steps: 1. Check YAML syntax (indentation, colons, quotes) 2. Verify all IDs are quoted (<code>'0xCE15'</code>) 3. Ensure service_id and subchannel_id match</p> <p>See: Common Errors - Configuration</p>"},{"location":"troubleshooting/#input-problems","title":"Input Problems","text":"<p>Symptoms: - \"File not found\" errors - \"Invalid frame header\" messages - Buffer underruns</p> <p>First steps: 1. Verify file paths (use <code>file://</code> prefix) 2. Check audio format (MPEG Layer II for DAB) 3. Test with a known-good audio file</p> <p>See: Input Issues</p>"},{"location":"troubleshooting/#output-problems","title":"Output Problems","text":"<p>Symptoms: - Can't write output file - Network unreachable - Missing or corrupted frames</p> <p>First steps: 1. Check file permissions 2. Verify network connectivity 3. Test with file output first, then network</p> <p>See: Output Issues</p>"},{"location":"troubleshooting/#network-problems","title":"Network Problems","text":"<p>Symptoms: - \"Connection refused\" - Multicast not working - Packet loss</p> <p>First steps: 1. Check firewall settings 2. Verify multicast routing 3. Test with unicast first</p> <p>See: Network Issues</p>"},{"location":"troubleshooting/#debug-workflow","title":"Debug Workflow","text":"<p>Follow this workflow to diagnose problems:</p>"},{"location":"troubleshooting/#1-start-simple","title":"1. Start Simple","text":"<p>Test with minimal configuration:</p> <pre><code># Single service, file input, file output\ndabmux -c basic_config.yaml -o test.eti -n 10\n</code></pre>"},{"location":"troubleshooting/#2-enable-verbose-logging","title":"2. Enable Verbose Logging","text":"<p>Get detailed information:</p> <pre><code># Maximum verbosity\ndabmux -c config.yaml -o output.eti -n 10 -vvv\n</code></pre>"},{"location":"troubleshooting/#3-verify-configuration","title":"3. Verify Configuration","text":"<p>Check that configuration is valid:</p> <pre><code># Test with 1 frame\ndabmux -c config.yaml -o test.eti -n 1 -vvv\n</code></pre>"},{"location":"troubleshooting/#4-test-components-individually","title":"4. Test Components Individually","text":"<ul> <li>Test each input file separately</li> <li>Test file output before network output</li> <li>Test UDP before adding PFT</li> </ul>"},{"location":"troubleshooting/#5-check-external-tools","title":"5. Check External Tools","text":"<p>Use system tools to verify:</p> <pre><code># Check files\nfile audio.mp2\nffprobe audio.mp2\n\n# Check network\nnetstat -rn | grep 239  # Multicast routes\ntcpdump -i eth0 udp port 12000  # Network traffic\n\n# Check ETI output\nhexdump -C output.eti | head\n</code></pre>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":""},{"location":"troubleshooting/#self-help-resources","title":"Self-Help Resources","text":"<ol> <li>FAQ: Frequently asked questions</li> <li>Configuration Reference: Valid options</li> <li>Examples: Working configurations</li> </ol>"},{"location":"troubleshooting/#community-help","title":"Community Help","text":"<ol> <li>GitHub Issues: Report bugs</li> <li>Discussions: Ask questions</li> <li>Documentation: You're reading it!</li> </ol>"},{"location":"troubleshooting/#reporting-bugs","title":"Reporting Bugs","text":"<p>When reporting bugs, include:</p> <ol> <li>Python version: <code>python --version</code></li> <li>python-dabmux version: <code>dabmux --version</code></li> <li>Operating system: Linux, macOS, Windows + version</li> <li>Configuration file (remove sensitive data)</li> <li>Complete error message</li> <li>Debug output: Run with <code>-vvv</code> and include output</li> <li>Steps to reproduce</li> </ol> <p>Example bug report:</p> <pre><code>## Environment\n- Python 3.11.5\n- python-dabmux 0.6.0\n- Ubuntu 22.04 LTS\n\n## Problem\nGetting \"Invalid MPEG frame header\" when using UDP input\n\n## Configuration\n[paste relevant config sections]\n\n## Steps to Reproduce\n1. Start UDP streaming with: nc -u 239.1.2.3 5001 &lt; audio.mp2\n2. Run: dabmux -c config.yaml -o output.eti -vvv\n3. Error occurs immediately\n\n## Debug Output\n[paste output with -vvv]\n\n## Expected Behavior\nShould multiplex UDP input without errors\n\n## Actual Behavior\nCrashes with \"Invalid MPEG frame header\"\n</code></pre>"},{"location":"troubleshooting/#quick-reference","title":"Quick Reference","text":""},{"location":"troubleshooting/#error-message-keywords","title":"Error Message Keywords","text":"Keyword Section \"Configuration\" Common Errors \"File not found\" Input Issues \"Invalid frame\" Input Issues \"Permission denied\" Output Issues \"Network unreachable\" Network Issues \"Connection refused\" Network Issues"},{"location":"troubleshooting/#common-solutions","title":"Common Solutions","text":"Problem Quick Fix Config not found Use absolute path: <code>-c /full/path/config.yaml</code> Input not found Check <code>file://</code> prefix and path Invalid hex value Add quotes and <code>0x</code>: <code>id: '0xCE15'</code> YAML error Check indentation (spaces, not tabs) Network error Test with file output first Permission error Check file/directory permissions"},{"location":"troubleshooting/#see-also","title":"See Also","text":"<ul> <li>User Guide: Complete usage documentation</li> <li>CLI Reference: Command-line options</li> <li>Architecture: How python-dabmux works</li> <li>FAQ: Frequently asked questions</li> </ul>"},{"location":"troubleshooting/common-errors/","title":"Common Errors","text":"<p>This guide covers the most common errors you'll encounter with python-dabmux and how to solve them.</p>"},{"location":"troubleshooting/common-errors/#configuration-errors","title":"Configuration Errors","text":""},{"location":"troubleshooting/common-errors/#1-configuration-file-not-found","title":"1. Configuration File Not Found","text":"<p>Error: <pre><code>ERROR: Configuration file not found: config.yaml\n</code></pre></p> <p>Cause: The configuration file doesn't exist or the path is wrong.</p> <p>Solutions: <pre><code># Check if file exists\nls -l config.yaml\n\n# Use absolute path\ndabmux -c /full/path/to/config.yaml -o output.eti\n\n# Check current directory\npwd\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#2-missing-ensemble-section","title":"2. Missing Ensemble Section","text":"<p>Error: <pre><code>ERROR: Missing 'ensemble' section in configuration\n</code></pre></p> <p>Cause: Configuration file doesn't have required <code>ensemble:</code> section.</p> <p>Solution: <pre><code># Add ensemble section at the top\nensemble:\n  id: '0xCE15'\n  ecc: '0xE1'\n  transmission_mode: 'I'\n  label:\n    text: 'My Ensemble'\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#3-invalid-hex-value-format","title":"3. Invalid Hex Value Format","text":"<p>Error: <pre><code>ERROR: Invalid value for ensemble ID: CE15\n</code></pre></p> <p>Cause: Hex values must be quoted and start with <code>0x</code>.</p> <p>Wrong: <pre><code>ensemble:\n  id: CE15          # Missing 0x prefix and quotes\n  ecc: E1           # Missing 0x prefix and quotes\n</code></pre></p> <p>Correct: <pre><code>ensemble:\n  id: '0xCE15'      # Quoted with 0x prefix\n  ecc: '0xE1'       # Quoted with 0x prefix\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#4-yaml-indentation-error","title":"4. YAML Indentation Error","text":"<p>Error: <pre><code>ERROR: YAML parse error: mapping values are not allowed here\n</code></pre></p> <p>Cause: Incorrect indentation (tabs vs spaces, wrong number of spaces).</p> <p>Wrong: <pre><code>ensemble:\n id: '0xCE15'       # 1 space (inconsistent)\n  ecc: '0xE1'       # 2 spaces\n    label:          # 4 spaces (should be 2)\n    text: 'DAB'     # 4 spaces (should be 4)\n</code></pre></p> <p>Correct: <pre><code>ensemble:\n  id: '0xCE15'      # 2 spaces\n  ecc: '0xE1'       # 2 spaces\n  label:            # 2 spaces\n    text: 'DAB'     # 4 spaces (nested)\n</code></pre></p> <p>Tip: Use spaces, not tabs. Most editors have \"Convert tabs to spaces\" option.</p>"},{"location":"troubleshooting/common-errors/#5-mismatched-service-id","title":"5. Mismatched Service ID","text":"<p>Error: <pre><code>ERROR: Component references unknown service_id: 0x5999\n</code></pre></p> <p>Cause: Component <code>service_id</code> doesn't match any service <code>id</code>.</p> <p>Wrong: <pre><code>services:\n  - id: '0x5001'    # Service ID is 0x5001\ncomponents:\n  - service_id: '0x5999'  # References non-existent service!\n</code></pre></p> <p>Correct: <pre><code>services:\n  - id: '0x5001'\ncomponents:\n  - service_id: '0x5001'  # Matches service above\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#6-mismatched-subchannel-id","title":"6. Mismatched Subchannel ID","text":"<p>Error: <pre><code>ERROR: Component references unknown subchannel_id: 5\n</code></pre></p> <p>Cause: Component <code>subchannel_id</code> doesn't match any subchannel <code>id</code>.</p> <p>Wrong: <pre><code>subchannels:\n  - id: 0           # Subchannel ID is 0\ncomponents:\n  - subchannel_id: 5  # References non-existent subchannel!\n</code></pre></p> <p>Correct: <pre><code>subchannels:\n  - id: 0\ncomponents:\n  - subchannel_id: 0  # Matches subchannel above\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#7-invalid-bitrate","title":"7. Invalid Bitrate","text":"<p>Error: <pre><code>ERROR: Invalid bitrate: 150 (not a standard DAB bitrate)\n</code></pre></p> <p>Cause: Bitrate is not a standard DAB value.</p> <p>Standard DAB bitrates: 32, 48, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384</p> <p>Wrong: <pre><code>bitrate: 150      # Not standard\n</code></pre></p> <p>Correct: <pre><code>bitrate: 160      # Standard DAB bitrate\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#8-invalid-protection-level","title":"8. Invalid Protection Level","text":"<p>Error: <pre><code>ERROR: Protection level must be 0-4, got: 5\n</code></pre></p> <p>Cause: Protection level out of valid range.</p> <p>Valid range: 0 (weakest) to 4 (strongest)</p> <p>Wrong: <pre><code>protection:\n  level: 5        # Too high\n</code></pre></p> <p>Correct: <pre><code>protection:\n  level: 2        # Valid (0-4)\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#input-errors","title":"Input Errors","text":""},{"location":"troubleshooting/common-errors/#9-input-file-not-found","title":"9. Input File Not Found","text":"<p>Error: <pre><code>ERROR: Input file not found: audio.mp2\n</code></pre></p> <p>Cause: Audio file doesn't exist or path is wrong.</p> <p>Solutions: <pre><code># Check if file exists\nls -l audio.mp2\n\n# Use absolute path in config\n</code></pre></p> <pre><code># Relative path (from current directory)\ninput: 'file://audio.mp2'\n\n# Absolute path (recommended for production)\ninput: 'file:///absolute/path/to/audio.mp2'\n</code></pre>"},{"location":"troubleshooting/common-errors/#10-missing-file-prefix","title":"10. Missing file:// Prefix","text":"<p>Error: <pre><code>ERROR: Invalid input URI: audio.mp2\n</code></pre></p> <p>Cause: Input path must start with <code>file://</code>, <code>udp://</code>, or <code>tcp://</code>.</p> <p>Wrong: <pre><code>input: 'audio.mp2'          # Missing protocol\ninput: '/path/to/audio.mp2' # Missing protocol\n</code></pre></p> <p>Correct: <pre><code>input: 'file://audio.mp2'            # Relative path\ninput: 'file:///path/to/audio.mp2'   # Absolute path\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#11-invalid-mpeg-frame-header","title":"11. Invalid MPEG Frame Header","text":"<p>Error: <pre><code>ERROR: Invalid MPEG frame header in file: audio.mp2\n</code></pre></p> <p>Cause: Input file is not valid MPEG Layer II audio.</p> <p>Solutions:</p> <ol> <li> <p>Verify file format: <pre><code>file audio.mp2\nffprobe audio.mp2\n</code></pre></p> </li> <li> <p>Convert to MPEG Layer II: <pre><code>ffmpeg -i input.wav -codec:a mp2 -b:a 128k audio.mp2\n</code></pre></p> </li> <li> <p>Check encoding parameters:</p> </li> <li>Must be MPEG-1 Audio Layer II</li> <li>Bitrate must match configuration</li> <li>Sample rate: 24000, 32000, or 48000 Hz</li> </ol>"},{"location":"troubleshooting/common-errors/#12-network-input-connection-failed","title":"12. Network Input Connection Failed","text":"<p>Error: <pre><code>ERROR: Failed to connect to UDP source: 239.1.2.3:5001\n</code></pre></p> <p>Causes: - Network interface not configured for multicast - Firewall blocking UDP traffic - Wrong IP address or port</p> <p>Solutions:</p> <ol> <li> <p>Test network connectivity: <pre><code># Test UDP port is open\nnc -u -l 5001\n\n# Check multicast routes\nnetstat -rn | grep 239\n</code></pre></p> </li> <li> <p>Configure multicast (Linux): <pre><code># Add multicast route\nsudo route add -net 224.0.0.0 netmask 240.0.0.0 dev eth0\n</code></pre></p> </li> <li> <p>Check firewall: <pre><code># Linux (ufw)\nsudo ufw allow 5001/udp\n\n# Linux (iptables)\nsudo iptables -A INPUT -p udp --dport 5001 -j ACCEPT\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/common-errors/#13-input-buffer-underrun","title":"13. Input Buffer Underrun","text":"<p>Error: <pre><code>WARNING: Input buffer underrun on subchannel 0\n</code></pre></p> <p>Cause: Input source can't provide data fast enough.</p> <p>Solutions:</p> <ol> <li>For file inputs:</li> <li>Check file is not corrupted</li> <li>Ensure disk I/O is fast enough</li> <li> <p>Use local storage, not network drives</p> </li> <li> <p>For network inputs:</p> </li> <li>Check network bandwidth</li> <li>Reduce network congestion</li> <li>Use wired instead of wireless</li> <li> <p>Increase buffer size (if supported)</p> </li> <li> <p>For continuous operation: <pre><code># Use --continuous to loop inputs\ndabmux -c config.yaml -o output.eti --continuous\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/common-errors/#14-wrong-audio-format-dab-vs-dab","title":"14. Wrong Audio Format (DAB vs DAB+)","text":"<p>Error: <pre><code>ERROR: Expected DAB+ superframe, got MPEG frame\n</code></pre></p> <p>Cause: Subchannel type doesn't match input audio format.</p> <p>Wrong: <pre><code>subchannels:\n  - type: 'dabplus'            # DAB+ type\n    input: 'file://audio.mp2'  # But input is MPEG (DAB)\n</code></pre></p> <p>Correct: <pre><code># For MPEG Layer II files\nsubchannels:\n  - type: 'audio'              # DAB type\n    input: 'file://audio.mp2'\n\n# For HE-AAC files\nsubchannels:\n  - type: 'dabplus'            # DAB+ type\n    input: 'file://audio.aac'\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#output-errors","title":"Output Errors","text":""},{"location":"troubleshooting/common-errors/#15-cannot-write-output-file","title":"15. Cannot Write Output File","text":"<p>Error: <pre><code>ERROR: Permission denied: output.eti\n</code></pre></p> <p>Causes: - No write permission in directory - File already exists and is read-only - Disk full</p> <p>Solutions:</p> <ol> <li> <p>Check permissions: <pre><code># Check directory permissions\nls -ld .\n\n# Fix permissions\nchmod 755 .\nchmod 644 output.eti\n</code></pre></p> </li> <li> <p>Check disk space: <pre><code>df -h .\n</code></pre></p> </li> <li> <p>Use different output location: <pre><code>dabmux -c config.yaml -o /tmp/output.eti\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/common-errors/#16-invalid-edi-url","title":"16. Invalid EDI URL","text":"<p>Error: <pre><code>ERROR: Invalid EDI URL: 239.1.2.3:12000 (must start with udp:// or tcp://)\n</code></pre></p> <p>Cause: EDI URL missing protocol prefix.</p> <p>Wrong: <pre><code>dabmux -c config.yaml --edi 239.1.2.3:12000\n</code></pre></p> <p>Correct: <pre><code># UDP\ndabmux -c config.yaml --edi udp://239.1.2.3:12000\n\n# TCP\ndabmux -c config.yaml --edi tcp://192.168.1.100:12000\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#17-network-unreachable","title":"17. Network Unreachable","text":"<p>Error: <pre><code>ERROR: Network unreachable: 239.1.2.3:12000\n</code></pre></p> <p>Causes: - Wrong network interface - Multicast routing not configured - Network disconnected</p> <p>Solutions:</p> <ol> <li> <p>Check network interface: <pre><code>ip addr show\nifconfig\n</code></pre></p> </li> <li> <p>Configure multicast routing (Linux): <pre><code># Add route for multicast\nsudo route add -net 224.0.0.0 netmask 240.0.0.0 dev eth0\n\n# Or use ip command\nsudo ip route add 224.0.0.0/4 dev eth0\n</code></pre></p> </li> <li> <p>Test connectivity: <pre><code># Ping multicast address (may not work for all multicast addresses)\nping 239.1.2.3\n\n# Use netcat to test UDP\nnc -u 239.1.2.3 12000\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/common-errors/#18-pft-requires-pft-flag","title":"18. PFT Requires --pft Flag","text":"<p>Error: <pre><code>ERROR: --pft-fec requires --pft to be enabled\n</code></pre></p> <p>Cause: Trying to use PFT options without enabling PFT.</p> <p>Wrong: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft-fec\n</code></pre></p> <p>Correct: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --pft-fec\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#runtime-errors","title":"Runtime Errors","text":""},{"location":"troubleshooting/common-errors/#19-interrupted-by-user","title":"19. Interrupted by User","text":"<p>Message: <pre><code>INFO: Received interrupt signal, shutting down...\n</code></pre></p> <p>Cause: User pressed Ctrl+C (this is normal, not an error).</p> <p>Graceful shutdown: python-dabmux closes files and network connections cleanly.</p> <p>To stop: - Press <code>Ctrl+C</code> once - Wait for shutdown message - Don't press Ctrl+C multiple times</p>"},{"location":"troubleshooting/common-errors/#20-out-of-memory","title":"20. Out of Memory","text":"<p>Error: <pre><code>ERROR: MemoryError: Unable to allocate array\n</code></pre></p> <p>Causes: - Generating too many frames at once - Memory leak (rare) - Insufficient system memory</p> <p>Solutions:</p> <ol> <li> <p>Generate frames in batches: <pre><code># Instead of generating millions of frames at once\ndabmux -c config.yaml -o output.eti -n 10000  # Smaller batch\n</code></pre></p> </li> <li> <p>Use continuous mode with file output: <pre><code># Continuously append to file (uses constant memory)\ndabmux -c config.yaml -o output.eti --continuous\n</code></pre></p> </li> <li> <p>Check system memory: <pre><code>free -h        # Linux\nvm_stat        # macOS\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/common-errors/#21-python-version-too-old","title":"21. Python Version Too Old","text":"<p>Error: <pre><code>ERROR: Python 3.11 or later is required\n</code></pre></p> <p>Cause: python-dabmux requires Python 3.11+.</p> <p>Solutions:</p> <ol> <li> <p>Check Python version: <pre><code>python --version\npython3 --version\n</code></pre></p> </li> <li> <p>Install Python 3.11+: <pre><code># Ubuntu/Debian\nsudo apt install python3.11\n\n# macOS (Homebrew)\nbrew install python@3.11\n\n# Or download from python.org\n</code></pre></p> </li> <li> <p>Use specific Python version: <pre><code>python3.11 -m dabmux.cli -c config.yaml -o output.eti\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/common-errors/#22-module-not-found","title":"22. Module Not Found","text":"<p>Error: <pre><code>ERROR: ModuleNotFoundError: No module named 'dabmux'\n</code></pre></p> <p>Cause: python-dabmux not installed or virtual environment not activated.</p> <p>Solutions:</p> <ol> <li> <p>Check installation: <pre><code>pip list | grep dabmux\n</code></pre></p> </li> <li> <p>Install python-dabmux: <pre><code>pip install python-dabmux\n# Or for development:\npip install -e .\n</code></pre></p> </li> <li> <p>Activate virtual environment: <pre><code>source venv/bin/activate  # Linux/macOS\nvenv\\Scripts\\activate     # Windows\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/common-errors/#23-label-too-long","title":"23. Label Too Long","text":"<p>Error: <pre><code>ERROR: Label text exceeds 16 characters: \"This is a very long label\"\n</code></pre></p> <p>Cause: DAB labels limited to 16 characters, short labels to 8.</p> <p>Wrong: <pre><code>label:\n  text: 'This is a very long label'  # 25 characters!\n  short: 'Long Label'                # 10 characters!\n</code></pre></p> <p>Correct: <pre><code>label:\n  text: 'Long Label'       # 10 characters (max 16)\n  short: 'LongLbl'         # 7 characters (max 8)\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#24-capacity-exceeded","title":"24. Capacity Exceeded","text":"<p>Error: <pre><code>ERROR: Total subchannel capacity exceeds available CUs for Mode I\n</code></pre></p> <p>Cause: Sum of all subchannel bitrates (with protection) exceeds available bandwidth.</p> <p>Mode I capacity: 864 Capacity Units (CU)</p> <p>Solutions:</p> <ol> <li> <p>Reduce bitrates: <pre><code>subchannels:\n  - bitrate: 128  # Reduce from 192\n</code></pre></p> </li> <li> <p>Lower protection levels: <pre><code>protection:\n  level: 2       # Reduce from 3 (uses fewer CUs)\n</code></pre></p> </li> <li> <p>Remove services:</p> </li> <li> <p>Fewer services = more bandwidth per service</p> </li> <li> <p>Use DAB+ instead of DAB:</p> </li> <li>DAB+: 48-96 kbps (good quality)</li> <li>DAB: 128-192 kbps (similar quality)</li> </ol>"},{"location":"troubleshooting/common-errors/#25-duplicate-ids","title":"25. Duplicate IDs","text":"<p>Error: <pre><code>ERROR: Duplicate service ID: 0x5001\n</code></pre></p> <p>Cause: Multiple services or subchannels with same ID.</p> <p>Wrong: <pre><code>services:\n  - id: '0x5001'\n    label:\n      text: 'Service 1'\n  - id: '0x5001'     # Duplicate!\n    label:\n      text: 'Service 2'\n</code></pre></p> <p>Correct: <pre><code>services:\n  - id: '0x5001'\n    label:\n      text: 'Service 1'\n  - id: '0x5002'     # Unique ID\n    label:\n      text: 'Service 2'\n</code></pre></p>"},{"location":"troubleshooting/common-errors/#getting-more-help","title":"Getting More Help","text":"<p>If your error isn't listed here:</p> <ol> <li>Check specific troubleshooting guides:</li> <li>Input Issues</li> <li>Output Issues</li> <li> <p>Network Issues</p> </li> <li> <p>Enable debug logging: <pre><code>dabmux -c config.yaml -o output.eti -vvv\n</code></pre></p> </li> <li> <p>Check the FAQ:</p> </li> <li> <p>FAQ</p> </li> <li> <p>Search GitHub Issues:</p> </li> <li> <p>github.com/python-dabmux/python-dabmux/issues</p> </li> <li> <p>Report a bug:</p> </li> <li>Include your configuration file</li> <li>Include the complete error message</li> <li>Include debug output (<code>-vvv</code>)</li> <li>Include your Python version and OS</li> </ol>"},{"location":"troubleshooting/common-errors/#see-also","title":"See Also","text":"<ul> <li>Debugging Guide: Advanced debugging techniques</li> <li>Configuration Reference: Valid configuration options</li> <li>CLI Reference: Command-line options</li> </ul>"},{"location":"user-guide/","title":"User Guide","text":"<p>Complete guide to using python-dabmux for DAB/DAB+ multiplexing.</p>"},{"location":"user-guide/#overview","title":"Overview","text":"<p>This user guide covers everything you need to operate python-dabmux effectively:</p> <ul> <li>CLI Reference: Complete command-line interface documentation</li> <li>Configuration: YAML configuration file reference</li> <li>Inputs: File and network input sources</li> <li>Outputs: ETI files and EDI network output</li> </ul>"},{"location":"user-guide/#quick-navigation","title":"Quick Navigation","text":""},{"location":"user-guide/#configuration","title":"Configuration","text":"<ul> <li>Configuration Overview</li> <li>Ensemble Parameters</li> <li>Services</li> <li>Subchannels</li> <li>Protection Levels</li> <li>Configuration Examples</li> </ul>"},{"location":"user-guide/#inputs","title":"Inputs","text":"<ul> <li>Input Overview</li> <li>File Inputs</li> <li>Network Inputs</li> <li>Audio Formats</li> </ul>"},{"location":"user-guide/#outputs","title":"Outputs","text":"<ul> <li>Output Overview</li> <li>ETI Files</li> <li>EDI Network</li> <li>PFT Fragmentation</li> </ul>"},{"location":"user-guide/#common-tasks","title":"Common Tasks","text":""},{"location":"user-guide/#creating-a-multiplex","title":"Creating a Multiplex","text":"<ol> <li>Write a configuration file</li> <li>Prepare audio inputs</li> <li>Run the multiplexer</li> <li>Verify the output</li> </ol>"},{"location":"user-guide/#streaming-over-network","title":"Streaming Over Network","text":"<ol> <li>Configure network inputs</li> <li>Enable EDI output</li> <li>Add PFT for reliability</li> <li>Run continuously</li> </ol>"},{"location":"user-guide/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Common Errors</li> <li>Input Issues</li> <li>Output Issues</li> <li>Network Issues</li> </ul>"},{"location":"user-guide/#see-also","title":"See Also","text":"<ul> <li>Getting Started: Installation and first multiplex</li> <li>Tutorials: Hands-on guides</li> <li>Architecture: System design</li> <li>API Reference: Python API documentation</li> </ul>"},{"location":"user-guide/cli-reference/","title":"CLI Reference","text":"<p>Complete command-line interface reference for python-dabmux.</p>"},{"location":"user-guide/cli-reference/#synopsis","title":"Synopsis","text":"<pre><code>python -m dabmux.cli [OPTIONS]\n</code></pre> <p>Or if installed globally:</p> <pre><code>dabmux [OPTIONS]\n</code></pre>"},{"location":"user-guide/cli-reference/#required-arguments","title":"Required Arguments","text":""},{"location":"user-guide/cli-reference/#-c-config-file","title":"<code>-c, --config FILE</code>","text":"<p>Path to the configuration file (YAML format).</p> <p>Example: <pre><code>dabmux -c config.yaml -o output.eti\ndabmux --config /path/to/config.yaml -o output.eti\n</code></pre></p> <p>See also: Configuration Reference</p>"},{"location":"user-guide/cli-reference/#output-options","title":"Output Options","text":"<p>You must specify one output option (file or EDI network).</p>"},{"location":"user-guide/cli-reference/#-o-output-file","title":"<code>-o, --output FILE</code>","text":"<p>Write ETI frames to a file.</p> <p>Example: <pre><code>dabmux -c config.yaml -o output.eti\ndabmux -c config.yaml --output /path/to/output.eti\n</code></pre></p> <p>File formats: - Raw ETI (<code>.eti</code>) - Streamed ETI (with timestamps) - Framed ETI (aligned frames)</p> <p>See also: ETI Files</p>"},{"location":"user-guide/cli-reference/#-edi-url","title":"<code>--edi URL</code>","text":"<p>Send EDI output over the network (UDP or TCP).</p> <p>Format: <code>udp://host:port</code> or <code>tcp://host:port</code></p> <p>Example: <pre><code># UDP unicast\ndabmux -c config.yaml --edi udp://192.168.1.100:12000\n\n# UDP multicast\ndabmux -c config.yaml --edi udp://239.1.2.3:12000\n\n# TCP\ndabmux -c config.yaml --edi tcp://192.168.1.100:12000\n</code></pre></p> <p>See also: EDI Network</p>"},{"location":"user-guide/cli-reference/#eti-file-format-options","title":"ETI File Format Options","text":""},{"location":"user-guide/cli-reference/#-f-format-rawstreamedframed","title":"<code>-f, --format {raw,streamed,framed}</code>","text":"<p>ETI file output format. Only used with <code>-o/--output</code>.</p> <p>Default: <code>framed</code></p> <p>Options:</p> <ul> <li><code>raw</code>: Plain ETI frames with no additional structure</li> <li>Smallest file size</li> <li>No timing information</li> <li> <p>Compatible with most tools</p> </li> <li> <p><code>streamed</code>: ETI frames with timing information</p> </li> <li>Includes timestamps</li> <li> <p>Useful for synchronized playback</p> </li> <li> <p><code>framed</code>: Aligned ETI frames with delimiters</p> </li> <li>8-byte aligned</li> <li>Frame boundaries marked</li> <li>Easiest to parse</li> </ul> <p>Example: <pre><code># Raw ETI\ndabmux -c config.yaml -o output.eti -f raw\n\n# Streamed ETI (with timestamps)\ndabmux -c config.yaml -o output.eti -f streamed\n\n# Framed ETI (default)\ndabmux -c config.yaml -o output.eti -f framed\n</code></pre></p>"},{"location":"user-guide/cli-reference/#pft-options","title":"PFT Options","text":"<p>PFT (Protection, Fragmentation and Transport) options. Only used with <code>--edi</code>.</p>"},{"location":"user-guide/cli-reference/#-pft","title":"<code>--pft</code>","text":"<p>Enable PFT for EDI output.</p> <p>Benefits: - Fragments large packets to fit MTU - Adds sequence numbers - Enables optional FEC</p> <p>Example: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft\n</code></pre></p> <p>See also: PFT Fragmentation</p>"},{"location":"user-guide/cli-reference/#-pft-fec","title":"<code>--pft-fec</code>","text":"<p>Enable Forward Error Correction (FEC) for PFT.</p> <p>Requires: <code>--pft</code></p> <p>Benefits: - Recovers lost packets - Uses Reed-Solomon encoding - Increases bandwidth usage</p> <p>Example: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --pft-fec\n</code></pre></p> <p>See also: Reed-Solomon FEC</p>"},{"location":"user-guide/cli-reference/#-pft-fec-m-m","title":"<code>--pft-fec-m M</code>","text":"<p>Maximum number of recoverable fragments for PFT FEC.</p> <p>Requires: <code>--pft</code> and <code>--pft-fec</code></p> <p>Default: <code>2</code></p> <p>Range: 1-20 (higher values = more recovery capability but more bandwidth)</p> <p>Example: <pre><code># Can recover up to 5 lost fragments\ndabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --pft-fec --pft-fec-m 5\n</code></pre></p> <p>Trade-off: Higher M = better error recovery but higher bandwidth usage.</p>"},{"location":"user-guide/cli-reference/#-pft-fragment-size-size","title":"<code>--pft-fragment-size SIZE</code>","text":"<p>Maximum fragment size in bytes for PFT.</p> <p>Requires: <code>--pft</code></p> <p>Default: <code>1400</code></p> <p>Typical values: - <code>1400</code>: Safe for standard Ethernet (1500 MTU) - <code>1200</code>: Conservative for networks with overhead - <code>8000</code>: Jumbo frames (if supported)</p> <p>Example: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --pft-fragment-size 1200\n</code></pre></p> <p>Note: Must be smaller than network MTU to avoid IP fragmentation.</p>"},{"location":"user-guide/cli-reference/#frame-generation-options","title":"Frame Generation Options","text":""},{"location":"user-guide/cli-reference/#-n-num-frames-n","title":"<code>-n, --num-frames N</code>","text":"<p>Number of ETI frames to generate.</p> <p>Default: <code>1</code></p> <p>Example: <pre><code># Generate 100 frames\ndabmux -c config.yaml -o output.eti -n 100\n\n# Generate 10,000 frames (about 16 minutes of Mode I)\ndabmux -c config.yaml -o output.eti --num-frames 10000\n</code></pre></p> <p>Calculation: - Mode I: 96 ms per frame (625 frames \u2248 1 minute) - Mode II: 24 ms per frame (2500 frames \u2248 1 minute)</p>"},{"location":"user-guide/cli-reference/#-continuous","title":"<code>--continuous</code>","text":"<p>Generate frames continuously until interrupted (Ctrl+C).</p> <p>Behavior: - Loops input files when they reach the end - Runs indefinitely until stopped - Useful for live transmission</p> <p>Example: <pre><code># Run until stopped\ndabmux -c config.yaml -o output.eti --continuous\n\n# Stream EDI continuously\ndabmux -c config.yaml --edi udp://239.1.2.3:12000 --continuous\n</code></pre></p> <p>Stop: Press <code>Ctrl+C</code> to gracefully stop.</p>"},{"location":"user-guide/cli-reference/#timestamp-options","title":"Timestamp Options","text":""},{"location":"user-guide/cli-reference/#-tist","title":"<code>--tist</code>","text":"<p>Enable TIST (Time-Stamp) field in ETI frames.</p> <p>Use cases: - Synchronized multi-transmitter networks (SFN) - Timed playback - Precise frame timing</p> <p>Example: <pre><code>dabmux -c config.yaml -o output.eti --tist\n</code></pre></p> <p>See also: Timestamps &amp; Sync</p>"},{"location":"user-guide/cli-reference/#-tist-offset-ms","title":"<code>--tist-offset MS</code>","text":"<p>TIST offset in milliseconds.</p> <p>Requires: <code>--tist</code></p> <p>Default: <code>0.0</code></p> <p>Use cases: - Compensate for processing delays - Align multiple multiplexers - Add fixed delay</p> <p>Example: <pre><code># Add 100ms offset\ndabmux -c config.yaml -o output.eti --tist --tist-offset 100.0\n\n# Negative offset (advance)\ndabmux -c config.yaml -o output.eti --tist --tist-offset -50.0\n</code></pre></p>"},{"location":"user-guide/cli-reference/#logging-options","title":"Logging Options","text":""},{"location":"user-guide/cli-reference/#-v-verbose","title":"<code>-v, --verbose</code>","text":"<p>Increase verbosity level. Can be repeated.</p> <p>Levels: - No <code>-v</code>: Warnings and errors only - <code>-v</code>: Warnings, errors - <code>-vv</code>: Info, warnings, errors - <code>-vvv</code>: Debug, info, warnings, errors</p> <p>Example: <pre><code># Normal verbosity\ndabmux -c config.yaml -o output.eti\n\n# Info messages\ndabmux -c config.yaml -o output.eti -vv\n\n# Debug messages\ndabmux -c config.yaml -o output.eti -vvv\n</code></pre></p>"},{"location":"user-guide/cli-reference/#-q-quiet","title":"<code>-q, --quiet</code>","text":"<p>Quiet mode (errors only).</p> <p>Use case: When you only want to see errors, no progress or status messages.</p> <p>Example: <pre><code>dabmux -c config.yaml -o output.eti -q\n</code></pre></p> <p>Note: Mutually exclusive with <code>-v</code>.</p>"},{"location":"user-guide/cli-reference/#version-and-help","title":"Version and Help","text":""},{"location":"user-guide/cli-reference/#-version","title":"<code>--version</code>","text":"<p>Show version and exit.</p> <p>Example: <pre><code>dabmux --version\n</code></pre></p> <p>Output: <pre><code>python-dabmux 0.6.0\n</code></pre></p>"},{"location":"user-guide/cli-reference/#-h-help","title":"<code>-h, --help</code>","text":"<p>Show help message and exit.</p> <p>Example: <pre><code>dabmux --help\n</code></pre></p>"},{"location":"user-guide/cli-reference/#complete-examples","title":"Complete Examples","text":""},{"location":"user-guide/cli-reference/#basic-single-service","title":"Basic Single Service","text":"<p>Generate 1000 frames from a single audio service:</p> <pre><code>dabmux -c basic_config.yaml -o output.eti -n 1000\n</code></pre>"},{"location":"user-guide/cli-reference/#multi-service-ensemble","title":"Multi-Service Ensemble","text":"<p>Generate a multi-service ensemble with debug logging:</p> <pre><code>dabmux -c multi_service.yaml -o output.eti -n 5000 -vvv\n</code></pre>"},{"location":"user-guide/cli-reference/#network-streaming-with-pft","title":"Network Streaming with PFT","text":"<p>Stream EDI over UDP multicast with PFT and FEC:</p> <pre><code>dabmux -c config.yaml \\\n  --edi udp://239.1.2.3:12000 \\\n  --pft \\\n  --pft-fec \\\n  --pft-fec-m 3 \\\n  --continuous\n</code></pre>"},{"location":"user-guide/cli-reference/#live-transmission","title":"Live Transmission","text":"<p>Continuous operation with timestamps:</p> <pre><code>dabmux -c live_config.yaml \\\n  --edi udp://239.1.2.3:12000 \\\n  --pft \\\n  --tist \\\n  --continuous \\\n  -vv\n</code></pre>"},{"location":"user-guide/cli-reference/#timed-recording","title":"Timed Recording","text":"<p>Generate exactly 10 minutes of Mode I frames (6250 frames):</p> <pre><code>dabmux -c config.yaml \\\n  -o recording.eti \\\n  -n 6250 \\\n  -f framed \\\n  --tist\n</code></pre>"},{"location":"user-guide/cli-reference/#development-testing","title":"Development Testing","text":"<p>Quick test with raw ETI output:</p> <pre><code>dabmux -c test_config.yaml -o test.eti -f raw -n 10 -q\n</code></pre>"},{"location":"user-guide/cli-reference/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> Success <code>1</code> Configuration file not found <code>1</code> Configuration error (invalid YAML, validation failed) <code>1</code> Output error (can't write file, network unreachable) <code>1</code> Unexpected error"},{"location":"user-guide/cli-reference/#common-usage-patterns","title":"Common Usage Patterns","text":""},{"location":"user-guide/cli-reference/#file-output-workflow","title":"File Output Workflow","text":"<ol> <li>Create configuration: <code>config.yaml</code></li> <li>Test with a few frames: <pre><code>dabmux -c config.yaml -o test.eti -n 10\n</code></pre></li> <li>Generate full output: <pre><code>dabmux -c config.yaml -o output.eti -n 10000\n</code></pre></li> </ol>"},{"location":"user-guide/cli-reference/#network-streaming-workflow","title":"Network Streaming Workflow","text":"<ol> <li>Test configuration: <pre><code>dabmux -c config.yaml -o test.eti -n 1\n</code></pre></li> <li>Start streaming: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --continuous\n</code></pre></li> <li>Monitor logs: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --continuous -vv\n</code></pre></li> </ol>"},{"location":"user-guide/cli-reference/#debugging-workflow","title":"Debugging Workflow","text":"<ol> <li>Enable debug logging: <pre><code>dabmux -c config.yaml -o debug.eti -n 10 -vvv\n</code></pre></li> <li>Check frame generation: <pre><code>hexdump -C debug.eti | head\n</code></pre></li> <li>Verify configuration: <pre><code>dabmux -c config.yaml --help\n</code></pre></li> </ol>"},{"location":"user-guide/cli-reference/#environment-variables","title":"Environment Variables","text":"<p>python-dabmux respects standard Python environment variables:</p> <ul> <li><code>PYTHONPATH</code>: Additional module search paths</li> <li><code>PYTHONUNBUFFERED</code>: Unbuffered output (useful for logging)</li> </ul> <p>Example: <pre><code>PYTHONUNBUFFERED=1 dabmux -c config.yaml -o output.eti --continuous\n</code></pre></p>"},{"location":"user-guide/cli-reference/#configuration-file-format","title":"Configuration File Format","text":"<p>See Configuration Reference for complete YAML configuration format.</p>"},{"location":"user-guide/cli-reference/#performance-tips","title":"Performance Tips","text":"<ol> <li> <p>Use raw format for large files: Smallest file size    <pre><code>dabmux -c config.yaml -o output.eti -f raw\n</code></pre></p> </li> <li> <p>Disable logging for production: Use <code>-q</code> for minimal overhead    <pre><code>dabmux -c config.yaml -o output.eti -q --continuous\n</code></pre></p> </li> <li> <p>Adjust PFT fragment size: Match your network MTU    <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000 --pft --pft-fragment-size 1400\n</code></pre></p> </li> <li> <p>Use TCP for reliable delivery: When packet loss is unacceptable    <pre><code>dabmux -c config.yaml --edi tcp://192.168.1.100:12000\n</code></pre></p> </li> </ol>"},{"location":"user-guide/cli-reference/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/cli-reference/#configuration-not-found","title":"Configuration Not Found","text":"<pre><code>ERROR: Configuration file not found: config.yaml\n</code></pre> <p>Solution: Check file path and current directory: <pre><code>ls -l config.yaml\ndabmux -c /absolute/path/to/config.yaml -o output.eti\n</code></pre></p>"},{"location":"user-guide/cli-reference/#invalid-edi-url","title":"Invalid EDI URL","text":"<pre><code>ERROR: Invalid EDI URL: 239.1.2.3:12000 (must start with udp:// or tcp://)\n</code></pre> <p>Solution: Add protocol prefix: <pre><code>dabmux -c config.yaml --edi udp://239.1.2.3:12000\n</code></pre></p>"},{"location":"user-guide/cli-reference/#permission-denied","title":"Permission Denied","text":"<pre><code>ERROR: Permission denied: output.eti\n</code></pre> <p>Solution: Check file permissions or write to a different location: <pre><code>chmod 644 output.eti  # Fix permissions\n# Or write elsewhere\ndabmux -c config.yaml -o /tmp/output.eti\n</code></pre></p>"},{"location":"user-guide/cli-reference/#network-unreachable","title":"Network Unreachable","text":"<pre><code>ERROR: Network unreachable: 239.1.2.3:12000\n</code></pre> <p>Solution: Check network configuration: <pre><code># Test connectivity\nping 239.1.2.3\n# Check multicast routes\nnetstat -rn | grep 239\n</code></pre></p>"},{"location":"user-guide/cli-reference/#see-also","title":"See Also","text":"<ul> <li>Configuration Reference: Complete YAML configuration</li> <li>ETI Files: ETI file format details</li> <li>EDI Network: EDI network output</li> <li>Troubleshooting: Common errors and solutions</li> <li>Examples: Configuration examples</li> </ul>"},{"location":"user-guide/configuration/","title":"Configuration Reference","text":"<p>Complete reference for python-dabmux YAML configuration files.</p>"},{"location":"user-guide/configuration/#overview","title":"Overview","text":"<p>python-dabmux uses YAML configuration files to define the structure of a DAB ensemble. The configuration includes:</p> <ul> <li>Ensemble: Top-level container with ID, country code, and transmission parameters</li> <li>Subchannels: Audio/data streams with bitrates and protection levels</li> <li>Services: Radio stations with labels and metadata</li> <li>Components: Links between services and subchannels</li> </ul>"},{"location":"user-guide/configuration/#configuration-structure","title":"Configuration Structure","text":"<pre><code>ensemble:\n  # Ensemble-level parameters\n\nsubchannels:\n  # List of audio/data streams\n\nservices:\n  # List of radio stations\n\ncomponents:\n  # Links between services and subchannels\n</code></pre>"},{"location":"user-guide/configuration/#quick-example","title":"Quick Example","text":"<pre><code>ensemble:\n  id: '0xCE15'\n  ecc: '0xE1'\n  transmission_mode: 'I'\n  label:\n    text: 'My DAB'\n    short: 'DAB'\n\nsubchannels:\n  - uid: 'audio1'\n    id: 0\n    type: 'audio'\n    bitrate: 128\n    protection:\n      level: 2\n    input: 'file://audio.mp2'\n\nservices:\n  - uid: 'service1'\n    id: '0x5001'\n    label:\n      text: 'Radio One'\n      short: 'Radio1'\n    pty: 1\n    language: 9\n\ncomponents:\n  - uid: 'comp1'\n    service_id: '0x5001'\n    subchannel_id: 0\n    type: 0\n</code></pre>"},{"location":"user-guide/configuration/#section-reference","title":"Section Reference","text":""},{"location":"user-guide/configuration/#ensemble-parameters","title":"Ensemble Parameters","text":"<p>Top-level ensemble configuration including:</p> <ul> <li>Ensemble ID and Extended Country Code (ECC)</li> <li>Transmission mode (I, II, III, IV)</li> <li>Ensemble label</li> <li>Local Time Offset (LTO)</li> </ul> <p>Read more \u2192</p>"},{"location":"user-guide/configuration/#services","title":"Services","text":"<p>Service (radio station) configuration including:</p> <ul> <li>Service ID and labels</li> <li>Programme Type (PTY)</li> <li>Language code</li> </ul> <p>Read more \u2192</p>"},{"location":"user-guide/configuration/#subchannels","title":"Subchannels","text":"<p>Subchannel (data stream) configuration including:</p> <ul> <li>Subchannel type (DAB, DAB+, packet, data)</li> <li>Bitrate and start address</li> <li>Input source (file or network)</li> <li>Protection settings</li> </ul> <p>Read more \u2192</p>"},{"location":"user-guide/configuration/#protection-levels","title":"Protection Levels","text":"<p>Error protection configuration including:</p> <ul> <li>UEP (Unequal Error Protection) levels (0-4)</li> <li>Short form vs long form protection</li> <li>Trade-offs and recommendations</li> </ul> <p>Read more \u2192</p>"},{"location":"user-guide/configuration/#configuration-examples","title":"Configuration Examples","text":"<p>Complete working examples including:</p> <ul> <li>Single service configuration</li> <li>Multi-service ensemble</li> <li>DAB+ configuration</li> <li>Network input configuration</li> </ul> <p>Read more \u2192</p>"},{"location":"user-guide/configuration/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<p>The relationship between configuration elements:</p> <pre><code>Ensemble (0xCE15 \"My DAB\")\n  \u2502\n  \u251c\u2500\u25ba Service 1 (0x5001 \"Radio One\")\n  \u2502     \u2514\u2500\u25ba Component 1\n  \u2502           \u2514\u2500\u25ba Subchannel 0 (128 kbps, audio)\n  \u2502                 \u2514\u2500\u25ba Input: file://audio1.mp2\n  \u2502\n  \u251c\u2500\u25ba Service 2 (0x5002 \"Radio Two\")\n  \u2502     \u2514\u2500\u25ba Component 2\n  \u2502           \u2514\u2500\u25ba Subchannel 1 (128 kbps, audio)\n  \u2502                 \u2514\u2500\u25ba Input: udp://239.1.2.3:5001\n  \u2502\n  \u2514\u2500\u25ba Service 3 (0x5003 \"Radio Three\")\n        \u2514\u2500\u25ba Component 3\n              \u2514\u2500\u25ba Subchannel 2 (96 kbps, dabplus)\n                    \u2514\u2500\u25ba Input: file://audio3.aac\n</code></pre> <p>Key points:</p> <ol> <li>Ensemble contains all services</li> <li>Services are what listeners see</li> <li>Components link services to subchannels</li> <li>Subchannels carry the actual audio data</li> <li>Inputs provide data to subchannels</li> </ol>"},{"location":"user-guide/configuration/#yaml-syntax","title":"YAML Syntax","text":""},{"location":"user-guide/configuration/#basic-types","title":"Basic Types","text":"<pre><code># Strings (quotes optional unless they contain special characters)\ntext: 'Hello World'\ntext: Hello World\n\n# Numbers\nnumber: 42\nhex: '0xCE15'  # Hex values must be quoted\n\n# Booleans\nenabled: true\ndisabled: false\n\n# Lists\nitems:\n  - item1\n  - item2\n  - item3\n</code></pre>"},{"location":"user-guide/configuration/#indentation","title":"Indentation","text":"<p>YAML uses spaces for indentation (not tabs):</p> <pre><code>ensemble:\n  id: '0xCE15'          # 2 spaces\n  label:\n    text: 'My DAB'      # 4 spaces\n    short: 'DAB'        # 4 spaces\n</code></pre>"},{"location":"user-guide/configuration/#comments","title":"Comments","text":"<pre><code># This is a comment\nensemble:\n  id: '0xCE15'          # Inline comment\n  # Another comment\n  ecc: '0xE1'\n</code></pre>"},{"location":"user-guide/configuration/#validation","title":"Validation","text":"<p>python-dabmux validates configuration files and reports errors:</p>"},{"location":"user-guide/configuration/#missing-required-fields","title":"Missing Required Fields","text":"<pre><code>ERROR: Missing 'ensemble' section in configuration\n</code></pre> <p>Solution: Add <code>ensemble:</code> section</p>"},{"location":"user-guide/configuration/#invalid-hex-values","title":"Invalid Hex Values","text":"<pre><code>ERROR: Invalid ensemble ID: CE15\n</code></pre> <p>Solution: Add <code>0x</code> prefix: <code>id: '0xCE15'</code></p>"},{"location":"user-guide/configuration/#mismatched-ids","title":"Mismatched IDs","text":"<pre><code>ERROR: Component references unknown service_id: 0x5999\n</code></pre> <p>Solution: Ensure <code>service_id</code> in components matches a service <code>id</code></p>"},{"location":"user-guide/configuration/#invalid-bitrate","title":"Invalid Bitrate","text":"<pre><code>ERROR: Invalid bitrate: 150 (not a standard DAB bitrate)\n</code></pre> <p>Solution: Use standard bitrates: 32, 48, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384</p>"},{"location":"user-guide/configuration/#common-patterns","title":"Common Patterns","text":""},{"location":"user-guide/configuration/#single-service","title":"Single Service","text":"<p>Simplest configuration with one radio station:</p> <pre><code>ensemble:\n  id: '0xCE15'\n  ecc: '0xE1'\n  transmission_mode: 'I'\n  label:\n    text: 'Single Service'\n    short: 'Single'\n\nsubchannels:\n  - uid: 'audio1'\n    id: 0\n    type: 'audio'\n    bitrate: 128\n    protection:\n      level: 2\n    input: 'file://audio.mp2'\n\nservices:\n  - uid: 'service1'\n    id: '0x5001'\n    label:\n      text: 'My Station'\n\ncomponents:\n  - uid: 'comp1'\n    service_id: '0x5001'\n    subchannel_id: 0\n</code></pre>"},{"location":"user-guide/configuration/#multiple-services","title":"Multiple Services","text":"<p>Ensemble with multiple stations:</p> <pre><code>ensemble:\n  id: '0xCE15'\n  ecc: '0xE1'\n  transmission_mode: 'I'\n  label:\n    text: 'Multi Service'\n    short: 'Multi'\n\nsubchannels:\n  - uid: 'audio1'\n    id: 0\n    bitrate: 128\n    input: 'file://audio1.mp2'\n  - uid: 'audio2'\n    id: 1\n    bitrate: 128\n    input: 'file://audio2.mp2'\n\nservices:\n  - uid: 'service1'\n    id: '0x5001'\n    label:\n      text: 'Station 1'\n  - uid: 'service2'\n    id: '0x5002'\n    label:\n      text: 'Station 2'\n\ncomponents:\n  - uid: 'comp1'\n    service_id: '0x5001'\n    subchannel_id: 0\n  - uid: 'comp2'\n    service_id: '0x5002'\n    subchannel_id: 1\n</code></pre>"},{"location":"user-guide/configuration/#network-input","title":"Network Input","text":"<p>Using UDP/TCP network inputs:</p> <pre><code>subchannels:\n  # UDP unicast\n  - uid: 'audio1'\n    id: 0\n    input: 'udp://192.168.1.100:5001'\n\n  # UDP multicast\n  - uid: 'audio2'\n    id: 1\n    input: 'udp://239.1.2.3:5002'\n\n  # TCP\n  - uid: 'audio3'\n    id: 2\n    input: 'tcp://192.168.1.100:5003'\n</code></pre>"},{"location":"user-guide/configuration/#dab-configuration","title":"DAB+ Configuration","text":"<p>Using DAB+ (HE-AAC) instead of MPEG Layer II:</p> <pre><code>subchannels:\n  - uid: 'dabplus1'\n    id: 0\n    type: 'dabplus'          # DAB+ type\n    bitrate: 72              # Lower bitrate possible\n    input: 'file://audio.aac'  # AAC input file\n</code></pre>"},{"location":"user-guide/configuration/#best-practices","title":"Best Practices","text":""},{"location":"user-guide/configuration/#use-meaningful-uids","title":"Use Meaningful UIDs","text":"<pre><code># Good\nservices:\n  - uid: 'bbc_radio1'\n    id: '0x5001'\n\n# Bad\nservices:\n  - uid: 'svc1'\n    id: '0x5001'\n</code></pre>"},{"location":"user-guide/configuration/#choose-appropriate-bitrates","title":"Choose Appropriate Bitrates","text":"<ul> <li>128 kbps: Standard for music (DAB MPEG Layer II)</li> <li>192 kbps: High-quality music (DAB)</li> <li>64-80 kbps: Speech/talk radio (DAB+)</li> <li>48-72 kbps: Music (DAB+)</li> </ul>"},{"location":"user-guide/configuration/#select-protection-levels","title":"Select Protection Levels","text":"<ul> <li>Level 2: Default, good for most conditions</li> <li>Level 3: Weak signal areas</li> <li>Level 4: Very weak signal, data services</li> </ul>"},{"location":"user-guide/configuration/#use-absolute-paths-for-production","title":"Use Absolute Paths for Production","text":"<pre><code># Development\ninput: 'file://audio.mp2'\n\n# Production\ninput: 'file:///var/dabmux/audio.mp2'\n</code></pre>"},{"location":"user-guide/configuration/#document-your-configuration","title":"Document Your Configuration","text":"<pre><code>ensemble:\n  # Production ensemble for City Radio\n  id: '0xCE15'\n  # Germany\n  ecc: '0xE1'\n  # Mode I (standard terrestrial)\n  transmission_mode: 'I'\n</code></pre>"},{"location":"user-guide/configuration/#loading-configuration","title":"Loading Configuration","text":""},{"location":"user-guide/configuration/#from-python","title":"From Python","text":"<pre><code>from dabmux.config import load_config\n\nensemble = load_config('config.yaml')\n</code></pre>"},{"location":"user-guide/configuration/#from-cli","title":"From CLI","text":"<pre><code>dabmux -c config.yaml -o output.eti\n</code></pre>"},{"location":"user-guide/configuration/#see-also","title":"See Also","text":"<ul> <li>Ensemble Parameters: Detailed ensemble configuration</li> <li>Services: Service configuration reference</li> <li>Subchannels: Subchannel configuration reference</li> <li>Protection Levels: Error protection details</li> <li>Examples: Complete working examples</li> <li>CLI Reference: Command-line options</li> <li>Basic Concepts: DAB terminology</li> </ul>"}]}